{"ast":null,"code":"import _objectSpread from \"/var/www/www-root/data/www/knigavl.ru/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";\nimport _objectWithoutProperties from \"/var/www/www-root/data/www/knigavl.ru/node_modules/@babel/runtime/helpers/esm/objectWithoutProperties.js\";\nconst _excluded = [\"enabled\", \"children\"];\nimport { jsx } from \"react/jsx-runtime\";\nimport { createContext, useState, useMemo, useRef, useContext, useEffect } from \"react\";\nconst selectionContext = createContext(null);\nfunction Selection(_ref) {\n  let {\n    children,\n    enabled = true\n  } = _ref;\n  const [selected, select] = useState([]);\n  const value = useMemo(() => ({\n    selected,\n    select,\n    enabled\n  }), [selected, select, enabled]);\n  return /* @__PURE__ */jsx(selectionContext.Provider, {\n    value,\n    children\n  });\n}\nfunction Select(_ref2) {\n  let {\n      enabled = false,\n      children\n    } = _ref2,\n    props = _objectWithoutProperties(_ref2, _excluded);\n  const group = useRef(null);\n  const api = useContext(selectionContext);\n  useEffect(() => {\n    if (api && enabled) {\n      let changed = false;\n      const current = [];\n      group.current.traverse(o => {\n        o.type === \"Mesh\" && current.push(o);\n        if (api.selected.indexOf(o) === -1) changed = true;\n      });\n      if (changed) {\n        api.select(state => [...state, ...current]);\n        return () => {\n          api.select(state => state.filter(selected => !current.includes(selected)));\n        };\n      }\n    }\n  }, [enabled, children, api]);\n  return /* @__PURE__ */jsx(\"group\", _objectSpread(_objectSpread({\n    ref: group\n  }, props), {}, {\n    children\n  }));\n}\nexport { Select, Selection, selectionContext };","map":{"version":3,"names":["selectionContext","createContext","Selection","_ref","children","enabled","selected","select","useState","value","useMemo","jsx","Provider","Select","_ref2","props","_objectWithoutProperties","_excluded","group","useRef","api","useContext","useEffect","changed","current","traverse","o","type","push","indexOf","state","filter","includes","_objectSpread","ref"],"sources":["/var/www/www-root/data/www/knigavl.ru/node_modules/@react-three/postprocessing/src/Selection.tsx"],"sourcesContent":["import * as THREE from 'three'\nimport React, { createContext, useState, useContext, useEffect, useRef, useMemo } from 'react'\n\nexport type Api = {\n  selected: THREE.Object3D[]\n  select: React.Dispatch<React.SetStateAction<THREE.Object3D[]>>\n  enabled: boolean\n}\nexport type SelectApi = JSX.IntrinsicElements['group'] & {\n  enabled?: boolean\n}\n\nexport const selectionContext = createContext<Api | null>(null)\n\nexport function Selection({ children, enabled = true }: { enabled?: boolean; children: React.ReactNode }) {\n  const [selected, select] = useState<THREE.Object3D[]>([])\n  const value = useMemo(() => ({ selected, select, enabled }), [selected, select, enabled])\n  return <selectionContext.Provider value={value}>{children}</selectionContext.Provider>\n}\n\nexport function Select({ enabled = false, children, ...props }: SelectApi) {\n  const group = useRef<THREE.Group>(null!)\n  const api = useContext(selectionContext)\n  useEffect(() => {\n    if (api && enabled) {\n      let changed = false\n      const current: THREE.Object3D<THREE.Event>[] = []\n      group.current.traverse((o) => {\n        o.type === 'Mesh' && current.push(o)\n        if (api.selected.indexOf(o) === -1) changed = true\n      })\n      if (changed) {\n        api.select((state) => [...state, ...current])\n        return () => {\n          api.select((state) => state.filter((selected) => !current.includes(selected)))\n        }\n      }\n    }\n  }, [enabled, children, api])\n  return (\n    <group ref={group} {...props}>\n      {children}\n    </group>\n  )\n}\n"],"mappings":";;;;;AAYa,MAAAA,gBAAA,GAAmBC,aAAA,CAA0B,IAAI;AAEvD,SAASC,UAAAC,IAAA,EAA0F;EAAA,IAAhF;IAAEC,QAAA;IAAUC,OAAA,GAAU;EAAA,IAAAF,IAAA;EAC9C,MAAM,CAACG,QAAA,EAAUC,MAAM,IAAIC,QAAA,CAA2B,EAAE;EACxD,MAAMC,KAAA,GAAQC,OAAA,CAAQ,OAAO;IAAEJ,QAAA;IAAUC,MAAA;IAAQF;EAAQ,IAAI,CAACC,QAAA,EAAUC,MAAA,EAAQF,OAAO,CAAC;EACxF,OAAQ,eAAAM,GAAA,CAAAX,gBAAA,CAAiBY,QAAA,EAAjB;IAA0BH,KAAA;IAAeL;EAAS;AAC5D;AAEO,SAASS,OAAAC,KAAA,EAA2D;EAAA,IAApD;MAAET,OAAA,GAAU;MAAOD;IAAa,IAAAU,KAAA;IAAAC,KAAA,GAAAC,wBAAA,CAAAF,KAAA,EAAAG,SAAA;EAC/C,MAAAC,KAAA,GAAQC,MAAA,CAAoB,IAAK;EACjC,MAAAC,GAAA,GAAMC,UAAA,CAAWrB,gBAAgB;EACvCsB,SAAA,CAAU,MAAM;IACd,IAAIF,GAAA,IAAOf,OAAA,EAAS;MAClB,IAAIkB,OAAA,GAAU;MACd,MAAMC,OAAA,GAAyC;MACzCN,KAAA,CAAAM,OAAA,CAAQC,QAAA,CAAUC,CAAA,IAAM;QAC5BA,CAAA,CAAEC,IAAA,KAAS,UAAUH,OAAA,CAAQI,IAAA,CAAKF,CAAC;QACnC,IAAIN,GAAA,CAAId,QAAA,CAASuB,OAAA,CAAQH,CAAC,MAAM,IAAcH,OAAA;MAAA,CAC/C;MACD,IAAIA,OAAA,EAAS;QACPH,GAAA,CAAAb,MAAA,CAAQuB,KAAA,IAAU,CAAC,GAAGA,KAAA,EAAO,GAAGN,OAAO,CAAC;QAC5C,OAAO,MAAM;UACXJ,GAAA,CAAIb,MAAA,CAAQuB,KAAA,IAAUA,KAAA,CAAMC,MAAA,CAAQzB,QAAA,IAAa,CAACkB,OAAA,CAAQQ,QAAA,CAAS1B,QAAQ,CAAC,CAAC;QAAA;MAEjF;IACF;EACC,IAACD,OAAA,EAASD,QAAA,EAAUgB,GAAG,CAAC;EAC3B,sBAAAT,GAAA,CACG,SAAAsB,aAAA,CAAAA,aAAA;IAAMC,GAAA,EAAKhB;EAAA,GAAWH,KAAA;IACpBX;EAAA,EACH;AAEJ","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}