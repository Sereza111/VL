{"ast":null,"code":"// Подключение к MongoDB через API запросы\nimport config from'../config';import{getTelegramInitData}from'./telegram';// URL для API\nconst API_URL=config.api.baseUrl;/**\r\n * Выполняет запрос к API сервера\r\n * @param {string} endpoint - Конечная точка API\r\n * @param {string} method - HTTP метод\r\n * @param {object} body - Тело запроса\r\n * @returns {Promise} - Результат запроса\r\n */export const executeApiRequest=async function(endpoint){let method=arguments.length>1&&arguments[1]!==undefined?arguments[1]:'GET';let body=arguments.length>2&&arguments[2]!==undefined?arguments[2]:null;try{const options={method,headers:{'Content-Type':'application/json'}};if(body){options.body=JSON.stringify(body);}// Attach Telegram WebApp init data for auth (if available)\nconst initData=(getTelegramInitData===null||getTelegramInitData===void 0?void 0:getTelegramInitData())||null;if(initData){options.headers['x-telegram-init-data']=initData;}console.log(\"\\u0412\\u044B\\u043F\\u043E\\u043B\\u043D\\u0435\\u043D\\u0438\\u0435 API \\u0437\\u0430\\u043F\\u0440\\u043E\\u0441\\u0430: \".concat(API_URL).concat(endpoint),options);// Таймаут, чтобы не зависать бесконечно\nconst controller=new AbortController();const timeoutId=setTimeout(()=>controller.abort(),10000);options.signal=controller.signal;// Для реальных запросов к API\nconst response=await fetch(\"\".concat(API_URL).concat(endpoint),options).catch(e=>{console.error('Сетевой сбой при запросе к API:',e);throw e;});clearTimeout(timeoutId);if(!response.ok){const text=await response.text().catch(()=>'');throw new Error(\"API request failed: \".concat(response.status,\" \").concat(text));}return await response.json();}catch(error){console.error('Ошибка при выполнении API запроса:',error);throw error;}};/**\r\n * Получает все данные пользователей из базы данных\r\n * @returns {Promise<Array>} - Массив пользователей\r\n */export const getAllUsersData=async()=>{try{const users=await executeApiRequest('/users');console.log('Все пользователи в базе данных:',users);return users;}catch(error){console.error('Ошибка при получении данных пользователей:',error);return[];}};/**\r\n * Отправляет запрос в друзья\r\n * @param {string} fromUserId - ID отправителя запроса\r\n * @param {string} toUserId - ID получателя запроса\r\n * @returns {Promise<Object>} - Результат операции\r\n */export const sendFriendRequest=async(fromUserId,toUserId)=>{try{console.log(\"\\u041E\\u0442\\u043F\\u0440\\u0430\\u0432\\u043A\\u0430 \\u0437\\u0430\\u043F\\u0440\\u043E\\u0441\\u0430 \\u0432 \\u0434\\u0440\\u0443\\u0437\\u044C\\u044F \\u043E\\u0442 \".concat(fromUserId,\" \\u043A \").concat(toUserId));const result=await executeApiRequest('/friends/request','POST',{fromUserId,toUserId});return result;}catch(error){console.error('Ошибка при отправке запроса в друзья:',error);return{success:false,error:error.message};}};/**\r\n * Получает все запросы в друзья для пользователя\r\n * @param {string} userId - ID пользователя\r\n * @returns {Promise<Array>} - Массив запросов в друзья\r\n */export const getFriendRequests=async userId=>{try{console.log(\"\\u041F\\u043E\\u043B\\u0443\\u0447\\u0435\\u043D\\u0438\\u0435 \\u0437\\u0430\\u043F\\u0440\\u043E\\u0441\\u043E\\u0432 \\u0432 \\u0434\\u0440\\u0443\\u0437\\u044C\\u044F \\u0434\\u043B\\u044F \\u043F\\u043E\\u043B\\u044C\\u0437\\u043E\\u0432\\u0430\\u0442\\u0435\\u043B\\u044F \".concat(userId));return await executeApiRequest(\"/friends/requests/telegram/\".concat(userId));}catch(error){console.error('Ошибка при получении запросов в друзья:',error);return[];}};/**\r\n * Принимает запрос в друзья\r\n * @param {string} userId - ID пользователя, принимающего запрос\r\n * @param {string} friendId - ID пользователя, отправившего запрос\r\n * @returns {Promise<Object>} - Результат операции\r\n */export const acceptFriendRequest=async(userId,friendId)=>{try{console.log(\"\\u041F\\u0440\\u0438\\u043D\\u044F\\u0442\\u0438\\u0435 \\u0437\\u0430\\u043F\\u0440\\u043E\\u0441\\u0430 \\u0432 \\u0434\\u0440\\u0443\\u0437\\u044C\\u044F \\u043E\\u0442 \".concat(friendId,\" \\u0434\\u043B\\u044F \").concat(userId));const result=await executeApiRequest('/friends/accept','POST',{userId,friendId});return result;}catch(error){console.error('Ошибка при принятии запроса в друзья:',error);return{success:false,error:error.message};}};/**\r\n * Отклоняет запрос в друзья\r\n * @param {string} userId - ID пользователя, отклоняющего запрос\r\n * @param {string} friendId - ID пользователя, отправившего запрос\r\n * @returns {Promise<Object>} - Результат операции\r\n */export const rejectFriendRequest=async(userId,friendId)=>{try{console.log(\"\\u041E\\u0442\\u043A\\u043B\\u043E\\u043D\\u0435\\u043D\\u0438\\u0435 \\u0437\\u0430\\u043F\\u0440\\u043E\\u0441\\u0430 \\u0432 \\u0434\\u0440\\u0443\\u0437\\u044C\\u044F \\u043E\\u0442 \".concat(friendId,\" \\u0434\\u043B\\u044F \").concat(userId));const result=await executeApiRequest('/friends/reject','POST',{userId,friendId});return result;}catch(error){console.error('Ошибка при отклонении запроса в друзья:',error);return{success:false,error:error.message};}};/**\r\n * Получает список друзей пользователя\r\n * @param {string} userId - ID пользователя\r\n * @returns {Promise<Array>} - Массив друзей\r\n */export const getFriends=async userId=>{try{console.log(\"\\u041F\\u043E\\u043B\\u0443\\u0447\\u0435\\u043D\\u0438\\u0435 \\u0441\\u043F\\u0438\\u0441\\u043A\\u0430 \\u0434\\u0440\\u0443\\u0437\\u0435\\u0439 \\u0434\\u043B\\u044F \\u043F\\u043E\\u043B\\u044C\\u0437\\u043E\\u0432\\u0430\\u0442\\u0435\\u043B\\u044F \".concat(userId));return await executeApiRequest(\"/friends/telegram/\".concat(userId));}catch(error){console.error('Ошибка при получении друзей:',error);return[];}};","map":{"version":3,"names":["config","getTelegramInitData","API_URL","api","baseUrl","executeApiRequest","endpoint","method","arguments","length","undefined","body","options","headers","JSON","stringify","initData","console","log","concat","controller","AbortController","timeoutId","setTimeout","abort","signal","response","fetch","catch","e","error","clearTimeout","ok","text","Error","status","json","getAllUsersData","users","sendFriendRequest","fromUserId","toUserId","result","success","message","getFriendRequests","userId","acceptFriendRequest","friendId","rejectFriendRequest","getFriends"],"sources":["/var/www/www-root/data/www/knigavl.ru/src/services/database.js"],"sourcesContent":["// Подключение к MongoDB через API запросы\r\nimport config from '../config';\r\nimport { getTelegramInitData } from './telegram';\r\n\r\n// URL для API\r\nconst API_URL = config.api.baseUrl;\r\n\r\n/**\r\n * Выполняет запрос к API сервера\r\n * @param {string} endpoint - Конечная точка API\r\n * @param {string} method - HTTP метод\r\n * @param {object} body - Тело запроса\r\n * @returns {Promise} - Результат запроса\r\n */\r\nexport const executeApiRequest = async (endpoint, method = 'GET', body = null) => {\r\n  try {\r\n    const options = {\r\n      method,\r\n      headers: {\r\n        'Content-Type': 'application/json'\r\n      }\r\n    };\r\n\r\n    if (body) {\r\n      options.body = JSON.stringify(body);\r\n    }\r\n\r\n    // Attach Telegram WebApp init data for auth (if available)\r\n    const initData = getTelegramInitData?.() || null;\r\n    if (initData) {\r\n      options.headers['x-telegram-init-data'] = initData;\r\n    }\r\n\r\n    console.log(`Выполнение API запроса: ${API_URL}${endpoint}`, options);\r\n    \r\n    // Таймаут, чтобы не зависать бесконечно\r\n    const controller = new AbortController();\r\n    const timeoutId = setTimeout(() => controller.abort(), 10000);\r\n    options.signal = controller.signal;\r\n\r\n    // Для реальных запросов к API\r\n    const response = await fetch(`${API_URL}${endpoint}`, options).catch((e) => {\r\n      console.error('Сетевой сбой при запросе к API:', e);\r\n      throw e;\r\n    });\r\n    clearTimeout(timeoutId);\r\n    \r\n    if (!response.ok) {\r\n      const text = await response.text().catch(() => '');\r\n      throw new Error(`API request failed: ${response.status} ${text}`);\r\n    }\r\n    \r\n    return await response.json();\r\n  } catch (error) {\r\n    console.error('Ошибка при выполнении API запроса:', error);\r\n    throw error;\r\n  }\r\n};\r\n\r\n/**\r\n * Получает все данные пользователей из базы данных\r\n * @returns {Promise<Array>} - Массив пользователей\r\n */\r\nexport const getAllUsersData = async () => {\r\n  try {\r\n    const users = await executeApiRequest('/users');\r\n    console.log('Все пользователи в базе данных:', users);\r\n    return users;\r\n  } catch (error) {\r\n    console.error('Ошибка при получении данных пользователей:', error);\r\n    return [];\r\n  }\r\n};\r\n\r\n/**\r\n * Отправляет запрос в друзья\r\n * @param {string} fromUserId - ID отправителя запроса\r\n * @param {string} toUserId - ID получателя запроса\r\n * @returns {Promise<Object>} - Результат операции\r\n */\r\nexport const sendFriendRequest = async (fromUserId, toUserId) => {\r\n  try {\r\n    console.log(`Отправка запроса в друзья от ${fromUserId} к ${toUserId}`);\r\n    const result = await executeApiRequest('/friends/request', 'POST', { fromUserId, toUserId });\r\n    return result;\r\n  } catch (error) {\r\n    console.error('Ошибка при отправке запроса в друзья:', error);\r\n    return { success: false, error: error.message };\r\n  }\r\n};\r\n\r\n/**\r\n * Получает все запросы в друзья для пользователя\r\n * @param {string} userId - ID пользователя\r\n * @returns {Promise<Array>} - Массив запросов в друзья\r\n */\r\nexport const getFriendRequests = async (userId) => {\r\n  try {\r\n    console.log(`Получение запросов в друзья для пользователя ${userId}`);\r\n    return await executeApiRequest(`/friends/requests/telegram/${userId}`);\r\n  } catch (error) {\r\n    console.error('Ошибка при получении запросов в друзья:', error);\r\n    return [];\r\n  }\r\n};\r\n\r\n/**\r\n * Принимает запрос в друзья\r\n * @param {string} userId - ID пользователя, принимающего запрос\r\n * @param {string} friendId - ID пользователя, отправившего запрос\r\n * @returns {Promise<Object>} - Результат операции\r\n */\r\nexport const acceptFriendRequest = async (userId, friendId) => {\r\n  try {\r\n    console.log(`Принятие запроса в друзья от ${friendId} для ${userId}`);\r\n    const result = await executeApiRequest('/friends/accept', 'POST', { userId, friendId });\r\n    return result;\r\n  } catch (error) {\r\n    console.error('Ошибка при принятии запроса в друзья:', error);\r\n    return { success: false, error: error.message };\r\n  }\r\n};\r\n\r\n/**\r\n * Отклоняет запрос в друзья\r\n * @param {string} userId - ID пользователя, отклоняющего запрос\r\n * @param {string} friendId - ID пользователя, отправившего запрос\r\n * @returns {Promise<Object>} - Результат операции\r\n */\r\nexport const rejectFriendRequest = async (userId, friendId) => {\r\n  try {\r\n    console.log(`Отклонение запроса в друзья от ${friendId} для ${userId}`);\r\n    const result = await executeApiRequest('/friends/reject', 'POST', { userId, friendId });\r\n    return result;\r\n  } catch (error) {\r\n    console.error('Ошибка при отклонении запроса в друзья:', error);\r\n    return { success: false, error: error.message };\r\n  }\r\n};\r\n\r\n/**\r\n * Получает список друзей пользователя\r\n * @param {string} userId - ID пользователя\r\n * @returns {Promise<Array>} - Массив друзей\r\n */\r\nexport const getFriends = async (userId) => {\r\n  try {\r\n    console.log(`Получение списка друзей для пользователя ${userId}`);\r\n    return await executeApiRequest(`/friends/telegram/${userId}`);\r\n  } catch (error) {\r\n    console.error('Ошибка при получении друзей:', error);\r\n    return [];\r\n  }\r\n};"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}