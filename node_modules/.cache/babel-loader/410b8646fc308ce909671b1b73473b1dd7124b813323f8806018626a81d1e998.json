{"ast":null,"code":"import { last, flat_map } from './list.js';\nimport { range } from './index.js';\nimport { memo } from './memo.js';\nimport { by_charcode } from './transform.js';\nfunction Type(type, value) {\n  return {\n    type,\n    value\n  };\n}\nfunction get_tokens(input) {\n  let expr = String(input);\n  let tokens = [],\n    stack = [];\n  if (!expr.startsWith('[') || !expr.endsWith(']')) {\n    return tokens;\n  }\n  for (let i = 1; i < expr.length - 1; ++i) {\n    let c = expr[i];\n    if (c == '-' && expr[i - 1] == '-') {\n      continue;\n    }\n    if (c == '-') {\n      stack.push(c);\n      continue;\n    }\n    if (last(stack) == '-') {\n      stack.pop();\n      let from = stack.pop();\n      tokens.push(from ? Type('range', [from, c]) : Type('char', c));\n      continue;\n    }\n    if (stack.length) {\n      tokens.push(Type('char', stack.pop()));\n    }\n    stack.push(c);\n  }\n  if (stack.length) {\n    tokens.push(Type('char', stack.pop()));\n  }\n  return tokens;\n}\nconst build_range = memo('build_range', input => {\n  let tokens = get_tokens(input);\n  return flat_map(tokens, _ref => {\n    let {\n      type,\n      value\n    } = _ref;\n    if (type == 'char') return value;\n    let [from, to] = value;\n    let reverse = false;\n    if (from > to) {\n      [from, to] = [to, from];\n      reverse = true;\n    }\n    let result = by_charcode(range)(from, to);\n    if (reverse) result.reverse();\n    return result;\n  });\n});\nfunction expand(fn) {\n  return function () {\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n    return fn(...flat_map(args, n => String(n).startsWith('[') ? build_range(n) : n));\n  };\n}\nexport { expand };","map":{"version":3,"names":["last","flat_map","range","memo","by_charcode","Type","type","value","get_tokens","input","expr","String","tokens","stack","startsWith","endsWith","i","length","c","push","pop","from","build_range","_ref","to","reverse","result","expand","fn","_len","arguments","args","Array","_key","n"],"sources":["/var/www/www-root/data/www/knigavl.ru/node_modules/css-doodle/src/utils/expand.js"],"sourcesContent":["import { last, flat_map } from './list.js';\n\nimport { range } from './index.js';\nimport { memo } from './memo.js';\nimport { by_charcode } from './transform.js';\n\nfunction Type(type, value) {\n  return { type, value };\n}\n\nfunction get_tokens(input) {\n  let expr = String(input);\n  let tokens = [], stack = [];\n  if (!expr.startsWith('[') || !expr.endsWith(']')) {\n    return tokens;\n  }\n\n  for (let i = 1; i < expr.length - 1; ++i) {\n    let c = expr[i];\n    if (c == '-' && expr[i - 1] == '-') {\n      continue;\n    }\n    if (c == '-') {\n      stack.push(c);\n      continue;\n    }\n    if (last(stack) == '-') {\n      stack.pop();\n      let from = stack.pop();\n      tokens.push(from\n        ? Type('range', [ from, c ])\n        : Type('char', c)\n      );\n      continue;\n    }\n    if (stack.length) {\n      tokens.push(Type('char', stack.pop()));\n    }\n    stack.push(c);\n  }\n  if (stack.length) {\n    tokens.push(Type('char', stack.pop()));\n  }\n  return tokens;\n}\n\nconst build_range = memo('build_range', (input) => {\n  let tokens = get_tokens(input);\n  return flat_map(tokens, ({ type, value }) => {\n    if (type == 'char') return value;\n    let [ from, to ] = value;\n    let reverse = false;\n    if (from > to) {\n      [from, to] = [ to, from ];\n      reverse = true;\n    }\n    let result = by_charcode(range)(from, to);\n    if (reverse) result.reverse();\n    return result;\n  });\n});\n\nfunction expand(fn) {\n  return (...args) => fn(...flat_map(args, n =>\n    String(n).startsWith('[') ? build_range(n) : n\n  ));\n}\n\nexport {\n  expand,\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}