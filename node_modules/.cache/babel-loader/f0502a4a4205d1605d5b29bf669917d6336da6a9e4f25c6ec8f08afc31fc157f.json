{"ast":null,"code":"import _objectSpread from\"/var/www/www-root/data/www/knigavl.ru/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useEffect,useMemo,useCallback,useRef,useState}from'react';import{saveUserData,loadUserData}from'./services/storage';import{initTelegramApp}from'./services/telegram';import{createMainMenuButtons,sendWelcomeMessage,openSupportBot}from'./services/telegram';import{createOrUpdateUser,getUserByTelegramId,updateUserBalance}from'./services/userService';import HomeScreen from'./screens/HomeScreen';import EarnScreen from'./screens/EarnScreen';import FarmScreen from'./screens/FarmScreen';import TasksScreen from'./screens/TasksScreen';import ProfileScreen from'./screens/ProfileScreen';import ShopScreen from'./screens/ShopScreen';import FriendsScreen from'./screens/FriendsScreen';import FunScreen from'./screens/FunScreen';import ArtifactsScreen from'./screens/ArtifactsScreen';import NavBar from'./components/NavBar';import{getAllUsersData,sendFriendRequest,getFriendRequests,acceptFriendRequest as acceptFriendRequestDb,rejectFriendRequest as rejectFriendRequestDb,getFriends,executeApiRequest}from'./services/database';import{getUserItems}from'./services/userService';import config from'./config';import'./App.css';import MagicalBackground from'./components/MagicalBackground';import QuillTextEffect from'./components/QuillTextEffect';import GothicBalance from'./components/GothicBalance';import MusicControl from'./components/MusicControl';import anime from'animejs/lib/anime.js';import MagicCircleVFX from'./components/MagicCircleVFX';// Цветовая палитра из требований\nimport{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";const COLOR_PALETTE={darkPurple:'#3C2F4F',// Тёмно-фиолетовый — основной фон\nbeigeParchment:'#E8D3A9',// Бежево-пергаментный — текст, акценты\ndarkTurquoise:'#1A3C34',// Тёмный бирюзовый — светлячки, свечение\ninkyBlue:'#1B263B',// Чернильный синий — тени, контуры\nmoonBlue:'#A8C7FA'// Голубоватый оттенок луны\n};function App(){// State management\nconst[userData,setUserData]=React.useState({});const[currentScreen,setCurrentScreen]=React.useState('home');const[balance,setBalance]=React.useState(0);const[exp,setExp]=React.useState(0);const[level,setLevel]=React.useState(1);const[items,setItems]=React.useState([]);const[friends,setFriends]=React.useState([]);const[friendRequests,setFriendRequests]=React.useState([]);const[loading,setLoading]=React.useState(true);const[dailyIncome,setDailyIncome]=React.useState(2058.00);const[dbUser,setDbUser]=React.useState(null);const[friendsLoaded,setFriendsLoaded]=React.useState(false);const[playingGuitar,setPlayingGuitar]=useState(false);const[balanceChange,setBalanceChange]=useState(null);const[showBalanceDetails,setShowBalanceDetails]=useState(false);const[soundEnabled,setSoundEnabled]=useState(false);const[visualTheme,setVisualTheme]=useState('mystical');// Performance tracking ref\nconst performanceTrackingRef=useRef({loadStartTime:performance.now(),renderCount:0});// Ref для отслеживания первой загрузки\nconst isInitializedRef=useRef(false);// Audio refs\nconst guitarAudioRef=useRef(null);// Функция для сохранения данных пользователя\nconst saveData=async()=>{if(!userData.userId)return;// Фильтруем предметы, оставляя только те, что имеют числовые ID (из базы данных)\nconst filteredItems=items.filter(item=>typeof item.id==='number'||typeof item.id==='string'&&!isNaN(parseInt(item.id)));// Если есть данные пользователя из БД, используем баланс из БД\nlet savedBalance=balance;if(dbUser){try{// Получаем актуальные данные пользователя из БД\nconst updatedUser=await getUserByTelegramId(userData.userId);if(updatedUser){savedBalance=parseFloat(updatedUser.balance||balance);console.log('Получен актуальный баланс из БД для сохранения:',savedBalance);}}catch(error){console.error('Ошибка при получении актуального баланса из БД:',error);}}const dataToSave={balance:savedBalance,exp,items:filteredItems,friends,friendRequests,dailyIncome,lastSave:new Date().toISOString()};saveUserData(userData.userId,dataToSave);console.log('Данные сохранены локально:',dataToSave);};// Memoized calculation functions\nconst calculateLevel=useCallback(exp=>{return Math.floor(Math.sqrt(exp/100))+1;},[]);const calculateNextLevelExp=useCallback(currentLevel=>{return currentLevel*currentLevel*100;},[]);// Загрузка друзей и запросов в друзья\nconst loadFriendsData=useCallback(async function(userId){let forceUpdate=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;try{if(!userId){console.error('Не указан ID пользователя для загрузки данных о друзьях');return;}// Проверяем, нужно ли загружать данные о друзьях\nif(friendsLoaded&&!forceUpdate){console.log('Данные о друзьях уже загружены, пропускаем запрос');return;}console.log(\"\\u0417\\u0430\\u0433\\u0440\\u0443\\u0437\\u043A\\u0430 \\u0434\\u0430\\u043D\\u043D\\u044B\\u0445 \\u043E \\u0434\\u0440\\u0443\\u0437\\u044C\\u044F\\u0445 \\u0434\\u043B\\u044F \\u043F\\u043E\\u043B\\u044C\\u0437\\u043E\\u0432\\u0430\\u0442\\u0435\\u043B\\u044F \".concat(userId));setFriendsLoaded(true);// Устанавливаем флаг загрузки перед запросами\ntry{// Используем переданный userId для запроса друзей\nconst friendsList=await getFriends(userId);console.log('Загружены друзья:',friendsList);setFriends(friendsList||[]);}catch(error){console.error('Ошибка при загрузке списка друзей:',error);// Не меняем текущее состояние друзей в случае ошибки\n}try{// Используем переданный userId для запроса запросов в друзья\nconst requests=await getFriendRequests(userId);console.log('Загружены запросы в друзья:',requests);setFriendRequests(requests||[]);}catch(error){console.error('Ошибка при загрузке запросов в друзья:',error);// Не меняем текущее состояние запросов в случае ошибки\n}}catch(error){console.error('Общая ошибка при загрузке данных о друзьях:',error);}},[]);// Инициализация и загрузка данных\nuseEffect(()=>{const loadApp=async()=>{try{setLoading(true);const tgData=initTelegramApp();console.log('Telegram data:',tgData);if(!tgData||!tgData.userId){console.error('Не удалось получить данные пользователя Telegram');setLoading(false);return;}setUserData(tgData);// Загружаем данные из локального хранилища\nconst savedData=await loadUserData(tgData.userId);console.log('Локальные данные:',savedData);// Загружаем данные пользователя из БД (только внутри Telegram)\nlet dbUserData=null;try{if(tgData.isTelegram){dbUserData=await getUserByTelegramId(tgData.userId);console.log('Данные пользователя из БД:',dbUserData);}if(dbUserData){setDbUser(dbUserData);// Если пользователь найден в БД, загружаем его друзей и запросы\n// Используем telegram_id вместо внутреннего id\nawait loadFriendsData(tgData.userId);// Загружаем предметы пользователя из БД\ntry{const userItems=await getUserItems(dbUserData.id);console.log('Предметы пользователя из БД:',userItems);if(userItems&&userItems.length>0){// Преобразуем формат предметов из БД в формат, используемый в приложении\nconst formattedItems=userItems.map(userItem=>{const item=userItem.item;return{id:item.id,name:item.name,description:item.description,price:item.price,income_per_hour:item.income_per_hour,image_url:item.image_url,type:item.type,quantity:userItem.quantity};});// Обновляем список предметов, заменяя все предметы из базы данных\nsetItems(formattedItems);// Рассчитываем доход от предметов\nconst totalIncome=formattedItems.reduce((sum,item)=>{console.log(\"\\u041F\\u0440\\u0435\\u0434\\u043C\\u0435\\u0442: \".concat(item.name,\", \\u0434\\u043E\\u0445\\u043E\\u0434: \").concat(item.income_per_hour,\", \\u043A\\u043E\\u043B\\u0438\\u0447\\u0435\\u0441\\u0442\\u0432\\u043E: \").concat(item.quantity));return sum+parseFloat(item.income_per_hour||0)*(item.quantity||1);},0);// Обновляем дневной доход\nif(totalIncome>0){setDailyIncome(totalIncome);// Устанавливаем почасовой доход\nconsole.log(\"\\u0423\\u0441\\u0442\\u0430\\u043D\\u043E\\u0432\\u043B\\u0435\\u043D \\u043F\\u043E\\u0447\\u0430\\u0441\\u043E\\u0432\\u043E\\u0439 \\u0434\\u043E\\u0445\\u043E\\u0434 \\u0438\\u0437 \\u043F\\u0440\\u0435\\u0434\\u043C\\u0435\\u0442\\u043E\\u0432: \".concat(totalIncome,\" VL/\\u0447\\u0430\\u0441 (\").concat(totalIncome*24,\" VL/\\u0434\\u0435\\u043D\\u044C)\"));}}}catch(itemsError){console.error('Ошибка при загрузке предметов пользователя:',itemsError);// Если не удалось загрузить предметы из БД, используем локальные данные\nif(savedData){setItems(savedData.items||[]);setDailyIncome(savedData.dailyIncome||2058.00);}}}else if(tgData.isTelegram){console.log('Пользователь не найден в БД, создаем нового');const newUser=await createOrUpdateUser({telegram_id:tgData.userId,username:tgData.username||\"user_\".concat(tgData.userId),first_name:tgData.firstName||'',last_name:tgData.lastName||'',balance:savedData?savedData.balance:100,exp:savedData?savedData.exp:0});console.log('Создан новый пользователь:',newUser);setDbUser(newUser);dbUserData=newUser;}}catch(error){console.error('Ошибка при загрузке данных пользователя из БД:',error);}// Устанавливаем начальные значения, приоритет у данных из БД\nif(dbUserData){// Используем баланс из БД, если он доступен\nsetBalance(parseFloat(dbUserData.balance||100));setExp(parseFloat(dbUserData.exp||0));const calculatedLevel=calculateLevel(parseFloat(dbUserData.exp||0));setLevel(calculatedLevel);// Игнорируем баланс из локального хранилища, всегда используем баланс из БД\nif(savedData){// Обновляем локальное хранилище с актуальным балансом из БД\nsavedData.balance=parseFloat(dbUserData.balance||100);saveUserData(tgData.userId,savedData);console.log('Локальное хранилище обновлено с балансом из БД:',parseFloat(dbUserData.balance||100));}}else if(savedData){// Если нет данных из БД, используем локальные данные\nsetBalance(savedData.balance||100);setExp(savedData.exp||0);const calculatedLevel=calculateLevel(savedData.exp||0);setLevel(calculatedLevel);}else{// Значения по умолчанию для нового пользователя\nsetBalance(100);setExp(0);setLevel(1);}// Загружаем остальные данные из локального хранилища\nif(savedData){// Предметы загружаются из БД, но если их нет, используем локальные\nif(!items||items.length===0){setItems(savedData.items||[]);setDailyIncome(savedData.dailyIncome||2058.00);}setFriends(savedData.friends||[]);setFriendRequests(savedData.friendRequests||[]);}else{// Значения по умолчанию для нового пользователя\nif(!items||items.length===0){setItems([]);setDailyIncome(2058.00);}setFriends([]);setFriendRequests([]);}// Создаем криптидов в фоне\nsetTimeout(()=>{createCryptids();},2000);// Загружаем аудио\nguitarAudioRef.current=new Audio('/guitar-riff.mp3');guitarAudioRef.current.volume=0.5;}catch(error){console.error('Ошибка при загрузке приложения:',error);}finally{// Завершаем загрузку\nsetLoading(false);// Замеряем время загрузки\nconst loadTime=performance.now()-performanceTrackingRef.current.loadStartTime;console.log(\"\\u041F\\u0440\\u0438\\u043B\\u043E\\u0436\\u0435\\u043D\\u0438\\u0435 \\u0437\\u0430\\u0433\\u0440\\u0443\\u0436\\u0435\\u043D\\u043E \\u0437\\u0430 \".concat(loadTime.toFixed(2),\"\\u043C\\u0441\"));}};if(!isInitializedRef.current){loadApp();isInitializedRef.current=true;}},[calculateLevel,loadFriendsData]);// Сохраняем данные при изменении состояния\nuseEffect(()=>{if(!userData.userId||loading)return;// Сохраняем данные с задержкой\nconst saveTimeout=setTimeout(async()=>{await saveData();},500);return()=>clearTimeout(saveTimeout);},[balance,dailyIncome,exp,friendRequests,friends,items,loading,userData.userId]);// Обновление баланса и опыта\nconst updateBalance=async function(amount){let expReward=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;try{// Ensure amount is a valid number\nconst numericAmount=parseFloat(amount)||0;const numericExpReward=parseFloat(expReward)||0;// Ensure current balance is a valid number\nconst currentBalance=parseFloat(balance)||0;const currentExp=parseFloat(exp)||0;// Show balance change animation if positive\nif(numericAmount>0){setBalanceChange(\"+\".concat(numericAmount.toFixed(2)));// Reset balance change after animation\nsetTimeout(()=>{setBalanceChange(null);},1500);}// Обновляем баланс в интерфейсе сразу для лучшего UX\nconst newBalance=Math.max(0,currentBalance+numericAmount);setBalance(newBalance);// Обновляем опыт и уровень\nconst newExp=currentExp+numericExpReward;setExp(newExp);const newLevel=calculateLevel(newExp);if(newLevel!==level){setLevel(newLevel);// Можно добавить уведомление о новом уровне\n}// Добавляем 2% дохода друзьям\nif(numericAmount>0){const friendBonus=numericAmount*0.02;// 2% от дохода\n// Распределяем бонус между друзьями\nif(friends.length>0){const bonusPerFriend=friendBonus/friends.length;console.log(\"\\u0420\\u0430\\u0441\\u043F\\u0440\\u0435\\u0434\\u0435\\u043B\\u044F\\u0435\\u043C \\u0431\\u043E\\u043D\\u0443\\u0441 \".concat(bonusPerFriend,\" \\u043C\\u0435\\u0436\\u0434\\u0443 \").concat(friends.length,\" \\u0434\\u0440\\u0443\\u0437\\u044C\\u044F\\u043C\\u0438\"));// Здесь можно добавить логику обновления баланса друзей\n}}// Сохраняем данные локально\nsetTimeout(()=>{saveData();},100);// Обновляем баланс в БД\nif(dbUser&&dbUser.id){try{console.log(\"\\u041E\\u0442\\u043F\\u0440\\u0430\\u0432\\u043A\\u0430 \\u0437\\u0430\\u043F\\u0440\\u043E\\u0441\\u0430 \\u043D\\u0430 \\u043E\\u0431\\u043D\\u043E\\u0432\\u043B\\u0435\\u043D\\u0438\\u0435 \\u0431\\u0430\\u043B\\u0430\\u043D\\u0441\\u0430 \\u0434\\u043B\\u044F \\u043F\\u043E\\u043B\\u044C\\u0437\\u043E\\u0432\\u0430\\u0442\\u0435\\u043B\\u044F \".concat(dbUser.id,\", \\u043D\\u043E\\u0432\\u044B\\u0439 \\u0431\\u0430\\u043B\\u0430\\u043D\\u0441: \").concat(newBalance.toFixed(2)));// Проверяем, что баланс - это действительное число\nif(isNaN(newBalance)){console.error('Ошибка: Баланс не является числом',newBalance);return{success:false,error:'Некорректное значение баланса'};}// Используем updateUserBalance из userService.js\nconst updatedUser=await updateUserBalance(dbUser.id,newBalance.toFixed(2));if(updatedUser){setDbUser(updatedUser);console.log('Баланс успешно обновлен в БД:',updatedUser.balance);}else{console.warn('Не удалось обновить баланс в БД, но локальные данные сохранены');}}catch(error){console.error('Ошибка при обновлении баланса в БД:',error);// Continue execution even if DB update fails\n}}return{success:true};}catch(error){console.error('Ошибка при обновлении баланса:',error);return{success:false,error:error.message};}};// Покупка предмета\nconst buyItem=async item=>{try{console.log('Попытка покупки предмета:',item);// Получаем актуальный баланс из базы данных перед покупкой\nlet currentBalance=balance;if(dbUser&&dbUser.id){try{const updatedUser=await getUserByTelegramId(userData.userId);if(updatedUser){currentBalance=parseFloat(updatedUser.balance||balance);console.log('Получен актуальный баланс из БД перед покупкой:',currentBalance);// Обновляем локальный баланс\nsetBalance(currentBalance);}}catch(error){console.error('Ошибка при получении актуального баланса из БД:',error);}}if(currentBalance<item.price){console.log('Недостаточно средств для покупки');return{success:false,error:'Недостаточно средств'};}// Списываем средства\nconst newBalance=currentBalance-item.price;setBalance(newBalance);console.log(\"\\u0411\\u0430\\u043B\\u0430\\u043D\\u0441 \\u043F\\u043E\\u0441\\u043B\\u0435 \\u043F\\u043E\\u043A\\u0443\\u043F\\u043A\\u0438: \".concat(newBalance));// Нормализуем ID предмета (может быть строкой или числом)\nconst itemId=typeof item.id==='string'&&!isNaN(parseInt(item.id))?parseInt(item.id):item.id;// Проверяем, есть ли уже такой предмет (проверяем оба варианта ID)\nconst existingItemIndex=items.findIndex(i=>i.id===itemId||typeof i.id==='string'&&typeof itemId==='number'&&parseInt(i.id)===itemId||typeof i.id==='number'&&typeof itemId==='string'&&i.id===parseInt(itemId));console.log(\"\\u0421\\u0443\\u0449\\u0435\\u0441\\u0442\\u0432\\u0443\\u044E\\u0449\\u0438\\u0439 \\u043F\\u0440\\u0435\\u0434\\u043C\\u0435\\u0442 \\u0441 \\u0438\\u043D\\u0434\\u0435\\u043A\\u0441\\u043E\\u043C: \".concat(existingItemIndex));if(existingItemIndex!==-1){// Если предмет уже есть, увеличиваем его количество\nconst updatedItems=[...items];updatedItems[existingItemIndex]=_objectSpread(_objectSpread({},updatedItems[existingItemIndex]),{},{quantity:(updatedItems[existingItemIndex].quantity||1)+1});setItems(updatedItems);console.log('Обновлен существующий предмет:',updatedItems[existingItemIndex]);}else{// Если предмета нет, добавляем его с количеством 1\nconst newItem=_objectSpread(_objectSpread({},item),{},{id:itemId,// Используем нормализованный ID\nquantity:1,// Убедимся, что у предмета есть поле income_per_hour для совместимости с БД\nincome_per_hour:item.income_per_hour||item.income||0});setItems([...items,newItem]);console.log('Добавлен новый предмет:',newItem);}// Пересчитываем доход\nconst newItems=existingItemIndex!==-1?[...items.slice(0,existingItemIndex),_objectSpread(_objectSpread({},items[existingItemIndex]),{},{quantity:(items[existingItemIndex].quantity||1)+1}),...items.slice(existingItemIndex+1)]:[...items,_objectSpread(_objectSpread({},item),{},{id:itemId,quantity:1,income_per_hour:item.income_per_hour||item.income||0})];const newIncome=newItems.reduce((sum,item)=>{return sum+parseFloat(item.income_per_hour||item.income||0)*(item.quantity||1);},0);setDailyIncome(newIncome);console.log(\"\\u041D\\u043E\\u0432\\u044B\\u0439 \\u043F\\u043E\\u0447\\u0430\\u0441\\u043E\\u0432\\u043E\\u0439 \\u0434\\u043E\\u0445\\u043E\\u0434: \".concat(newIncome,\" VL/\\u0447\\u0430\\u0441 (\").concat(newIncome*24,\" VL/\\u0434\\u0435\\u043D\\u044C)\"));// Сохраняем данные локально\nsetTimeout(async()=>{await saveData();},100);// Обновляем баланс и предметы в БД в одной операции (покупка)\nif(dbUser&&dbUser.id){try{const response=await executeApiRequest(\"/users/\".concat(dbUser.id,\"/purchase\"),'POST',{itemId:itemId,expectedPrice:item.price});if(response&&response.success){// Синхронизируем баланс и предметы с ответом сервера\nsetBalance(parseFloat(response.balance));if(Array.isArray(response.userItems)){const formattedItems=response.userItems.map(userItem=>{const item=userItem.item;return{id:item.id,name:item.name,description:item.description,price:item.price,income_per_hour:item.income_per_hour,image_url:item.image_url,type:item.type,quantity:userItem.quantity};});setItems(formattedItems);}}else{console.error('Ошибка покупки на сервере',response);return{success:false,error:(response===null||response===void 0?void 0:response.error)||'Ошибка покупки'};}}catch(error){console.error('Ошибка при покупке предмета на сервере:',error);return{success:false,error:error.message};}}return{success:true};}catch(error){console.error('Ошибка при покупке предмета:',error);return{success:false,error:error.message};}};// Отправка запроса в друзья\nconst sendFriendRequestHandler=async friendId=>{try{if(!dbUser||!userData||!userData.userId){return{success:false,error:'Нет данных пользователя'};}const response=await sendFriendRequest(userData.userId,friendId);if(response&&response.success){// Если запрос успешно отправлен, обновляем данные о друзьях\nconsole.log('Запрос в друзья успешно отправлен, обновляем данные о друзьях');// Загружаем данные о друзьях принудительно\ntry{// Загружаем список друзей\nconst friendsList=await getFriends(userData.userId);console.log('Загружены друзья после отправки запроса:',friendsList);setFriends(friendsList||[]);// Загружаем запросы в друзья\nconst requests=await getFriendRequests(userData.userId);console.log('Загружены запросы в друзья после отправки запроса:',requests);setFriendRequests(requests||[]);}catch(error){console.error('Ошибка при обновлении данных о друзьях после отправки запроса:',error);}}return response||{success:false,error:'Неизвестная ошибка'};}catch(error){return{success:false,error:error.message};}};// Принятие запроса в друзья\nconst acceptFriendRequest=async friendId=>{try{if(!dbUser||!userData||!userData.userId){return{success:false,error:'Нет данных пользователя'};}const response=await acceptFriendRequestDb(userData.userId,friendId);if(response&&response.success){// Если запрос успешно принят, обновляем данные о друзьях\nconsole.log('Запрос в друзья успешно принят, обновляем данные о друзьях');// Загружаем данные о друзьях принудительно\ntry{// Загружаем список друзей\nconst friendsList=await getFriends(userData.userId);console.log('Загружены друзья после принятия запроса:',friendsList);setFriends(friendsList||[]);// Загружаем запросы в друзья\nconst requests=await getFriendRequests(userData.userId);console.log('Загружены запросы в друзья после принятия запроса:',requests);setFriendRequests(requests||[]);}catch(error){console.error('Ошибка при обновлении данных о друзьях после принятия запроса:',error);}setTimeout(()=>{saveData();},100);await updateBalance(100,50);// 100 VL и 50 XP за нового друга\n}return response||{success:false,error:'Неизвестная ошибка'};}catch(error){return{success:false,error:error.message};}};// Отклонение запроса в друзья\nconst rejectFriendRequest=async friendId=>{try{if(!dbUser||!userData||!userData.userId){return{success:false,error:'Нет данных пользователя'};}const response=await rejectFriendRequestDb(userData.userId,friendId);if(response&&response.success){// Если запрос успешно отклонен, обновляем данные о друзьях\nconsole.log('Запрос в друзья успешно отклонен, обновляем данные о друзьях');// Загружаем данные о друзьях принудительно\ntry{// Загружаем список друзей\nconst friendsList=await getFriends(userData.userId);console.log('Загружены друзья после отклонения запроса:',friendsList);setFriends(friendsList||[]);// Загружаем запросы в друзья\nconst requests=await getFriendRequests(userData.userId);console.log('Загружены запросы в друзья после отклонения запроса:',requests);setFriendRequests(requests||[]);}catch(error){console.error('Ошибка при обновлении данных о друзьях после отклонения запроса:',error);}setTimeout(()=>{saveData();},100);}return response||{success:false,error:'Неизвестная ошибка'};}catch(error){return{success:false,error:error.message};}};// Обработка обновления профиля\nconst handleProfileUpdate=updates=>{setUserData(prev=>_objectSpread(_objectSpread({},prev),updates));// Сохраняем данные локально\nsetTimeout(()=>{saveData();},100);};// Performance logging effect\nuseEffect(()=>{performanceTrackingRef.current.renderCount++;if(performanceTrackingRef.current.renderCount%10===0){const renderTime=performance.now()-performanceTrackingRef.current.loadStartTime;console.group('App Performance');console.log(\"Total renders: \".concat(performanceTrackingRef.current.renderCount));console.log(\"Cumulative render time: \".concat(renderTime.toFixed(2),\"ms\"));console.groupEnd();}});// Функция для обновления друзей и запросов - вызывается только при переходе на экран друзей\nconst handleFriendsScreenLoad=useCallback(()=>{if(userData&&userData.userId&&currentScreen==='friends'){// Всегда загружаем данные о друзьях при переходе на экран друзей\nconsole.log('Загрузка данных о друзьях при переходе на экран друзей');loadFriendsData(userData.userId,true);// Принудительное обновление\n}},[userData,currentScreen,loadFriendsData]);// Эффект для одноразовой загрузки данных о друзьях при входе на экран друзей (без интервала)\nuseEffect(()=>{if(currentScreen==='friends'){handleFriendsScreenLoad();}},[currentScreen,handleFriendsScreenLoad]);// Обработчик использования артефакта\nconst handleUseArtifact=artifact=>{console.log('Использован артефакт:',artifact);// Здесь можно добавить логику эффектов артефактов\n// Например, временное увеличение дохода, бонус к опыту и т.д.\n// Пример: бонус к опыту\nif(artifact.effect&&artifact.effect.includes('опыт')){updateBalance(0,50);// Добавляем 50 опыта\n}// Пример: бонус к доходу\nif(artifact.effect&&artifact.effect.includes('доход')){updateBalance(100,0);// Добавляем 100 VL\n}};// Memoized screen rendering to prevent unnecessary re-renders\nconst renderScreen=useMemo(()=>{if(loading){return/*#__PURE__*/_jsx(\"div\",{children:\"Loading...\"});// Changed from LoadingSpinner to a simple div\n}const screenProps={home:{onTap:()=>updateBalance(0.01),balance,dailyIncome},earn:{onComplete:reward=>updateBalance(reward)},farm:{balance,updateBalance},tasks:{onComplete:reward=>updateBalance(reward)},shop:{balance,items,onBuy:buyItem},friends:{userData,friends,friendRequests,onSendRequest:sendFriendRequestHandler,onAcceptRequest:acceptFriendRequest,onRejectRequest:rejectFriendRequest,onLoadFriends:handleFriendsScreenLoad},profile:{userData,balance,exp,level,nextLevelExp:calculateNextLevelExp(level),items,onUpdate:handleProfileUpdate},fun:{balance,onPlay:amount=>updateBalance(amount)},artifacts:{items,balance,onUseArtifact:handleUseArtifact}};const screenComponents={home:HomeScreen,earn:EarnScreen,farm:FarmScreen,tasks:TasksScreen,shop:ShopScreen,friends:FriendsScreen,profile:ProfileScreen,fun:FunScreen,artifacts:ArtifactsScreen};const Screen=screenComponents[currentScreen]||HomeScreen;return/*#__PURE__*/_jsx(Screen,_objectSpread({},screenProps[currentScreen]));},[loading,currentScreen,balance,dailyIncome,items,friends,friendRequests,userData,exp,level,calculateNextLevelExp,handleFriendsScreenLoad,handleUseArtifact]);// Create cryptids in the background\nconst createCryptids=()=>{// Очищаем предыдущие криптиды, если они есть\nconst existingLayer=document.querySelector('.cryptid-layer');if(existingLayer){existingLayer.remove();}const cryptidLayer=document.createElement('div');cryptidLayer.className='cryptid-layer';document.body.appendChild(cryptidLayer);// Ограничиваем количество криптидов для улучшения производительности\nconst maxCryptids=window.innerWidth<768?3:5;for(let i=0;i<maxCryptids;i++){const cryptid=document.createElement('div');cryptid.className='cryptid';// Случайное положение\nconst posX=Math.random()*90+5;// 5-95%\nconst posY=Math.random()*80+10;// 10-90%\n// Случайная задержка появления\nconst delay=Math.random()*30000;// 0-30 секунд\n// Стили\nObject.assign(cryptid.style,{left:\"\".concat(posX,\"%\"),top:\"\".concat(posY,\"%\"),backgroundImage:\"url('/images/cryptid\".concat(i%3+1,\".png')\"),animationDelay:\"\".concat(delay,\"ms\")});cryptidLayer.appendChild(cryptid);// Автоматически удаляем криптида через 30 секунд для экономии памяти\nsetTimeout(()=>{if(cryptid.parentNode){cryptid.parentNode.removeChild(cryptid);}},30000+delay);}};// Play guitar sound\nconst playGuitar=()=>{if(guitarAudioRef.current){setPlayingGuitar(true);guitarAudioRef.current.currentTime=0;guitarAudioRef.current.play();setTimeout(()=>{setPlayingGuitar(false);},3000);}};// Toggle balance details\nconst toggleBalanceDetails=()=>{setShowBalanceDetails(!showBalanceDetails);};// Set current screen\nconst setScreen=screenId=>{// GSAP-like page transition via anime.js\nconst overlay=document.getElementById('page-transition');if(overlay){overlay.style.opacity=0;anime({targets:overlay,opacity:[0,1],duration:120,easing:'easeInQuad',complete:()=>{setCurrentScreen(screenId);anime({targets:overlay,opacity:[1,0],duration:200,easing:'easeOutQuad'});}});// Analytics\nif(window.gtag){window.gtag('event','screen_view',{screen_name:screenId});}return;}setCurrentScreen(screenId);// Track screen change\nif(window.gtag){window.gtag('event','screen_view',{screen_name:screenId});}};// Функция для начисления пассивного дохода\nconst applyPassiveIncome=useCallback(async()=>{try{console.log('Начисление пассивного дохода...');// Проверяем, есть ли доход для начисления\nif(!dailyIncome||dailyIncome<=0){console.log('Нет пассивного дохода для начисления');return;}// Проверяем, прошел ли час с последнего начисления\nconst lastIncomeTime=localStorage.getItem('lastIncomeTime');const now=Date.now();if(lastIncomeTime){const timeSinceLastIncome=now-parseInt(lastIncomeTime,10);const oneHour=60*60*1000;// 1 час в миллисекундах\nif(timeSinceLastIncome<oneHour){const minutesLeft=Math.ceil((oneHour-timeSinceLastIncome)/(60*1000));console.log(\"\\u0414\\u043E \\u0441\\u043B\\u0435\\u0434\\u0443\\u044E\\u0449\\u0435\\u0433\\u043E \\u043D\\u0430\\u0447\\u0438\\u0441\\u043B\\u0435\\u043D\\u0438\\u044F \\u043E\\u0441\\u0442\\u0430\\u043B\\u043E\\u0441\\u044C \".concat(minutesLeft,\" \\u043C\\u0438\\u043D\\u0443\\u0442\"));return{success:false,message:\"\\u0414\\u043E \\u0441\\u043B\\u0435\\u0434\\u0443\\u044E\\u0449\\u0435\\u0433\\u043E \\u043D\\u0430\\u0447\\u0438\\u0441\\u043B\\u0435\\u043D\\u0438\\u044F \\u043E\\u0441\\u0442\\u0430\\u043B\\u043E\\u0441\\u044C \".concat(minutesLeft,\" \\u043C\\u0438\\u043D\\u0443\\u0442\")};}}// Сначала получаем актуальный баланс пользователя из базы данных\nif(dbUser&&dbUser.id){try{// Запрашиваем актуальные данные пользователя из базы\nconst updatedUser=await getUserByTelegramId(userData.userId);if(updatedUser){// Обновляем локальный баланс из базы данных\nconst dbBalance=parseFloat(updatedUser.balance||0);setBalance(dbBalance);console.log(\"\\u0411\\u0430\\u043B\\u0430\\u043D\\u0441 \\u043E\\u0431\\u043D\\u043E\\u0432\\u043B\\u0435\\u043D \\u0438\\u0437 \\u0431\\u0430\\u0437\\u044B \\u0434\\u0430\\u043D\\u043D\\u044B\\u0445: \".concat(dbBalance.toFixed(2)));// Обновляем опыт и уровень, если они изменились\nif(updatedUser.exp!==undefined&&updatedUser.exp!==exp){const newExp=parseFloat(updatedUser.exp);setExp(newExp);const newLevel=calculateLevel(newExp);setLevel(newLevel);}}}catch(error){console.error('Ошибка при получении актуальных данных пользователя:',error);}}// Рассчитываем доход на основе предметов\nlet hourlyIncome=0;// Базовый доход\nconst baseIncome=5.0;// Доход от предметов\nif(items&&items.length>0){hourlyIncome=items.reduce((sum,item)=>{// Проверяем, есть ли у предмета свойство income_per_hour или income\nconst itemIncome=parseFloat(item.income_per_hour||item.income||0)*(item.quantity||1);console.log(\"\\u041F\\u0430\\u0441\\u0441\\u0438\\u0432\\u043D\\u044B\\u0439 \\u0434\\u043E\\u0445\\u043E\\u0434 \\u043E\\u0442 \\u043F\\u0440\\u0435\\u0434\\u043C\\u0435\\u0442\\u0430 \".concat(item.name,\": \").concat(itemIncome,\" VL/\\u0447\\u0430\\u0441 (\").concat(item.income_per_hour||item.income,\" \\xD7 \").concat(item.quantity||1,\")\"));return sum+itemIncome;},0);}// Если нет дохода от предметов, используем базовый\nif(hourlyIncome<=0){hourlyIncome=baseIncome;console.log(\"\\u0418\\u0441\\u043F\\u043E\\u043B\\u044C\\u0437\\u0443\\u0435\\u043C \\u0431\\u0430\\u0437\\u043E\\u0432\\u044B\\u0439 \\u0434\\u043E\\u0445\\u043E\\u0434: \".concat(baseIncome,\" VL/\\u0447\\u0430\\u0441\"));}else{console.log(\"\\u041E\\u0431\\u0449\\u0438\\u0439 \\u0434\\u043E\\u0445\\u043E\\u0434 \\u043E\\u0442 \\u043F\\u0440\\u0435\\u0434\\u043C\\u0435\\u0442\\u043E\\u0432: \".concat(hourlyIncome,\" VL/\\u0447\\u0430\\u0441\"));}// Добавляем доход от друзей: 2 VL за каждого друга\nif(friends&&friends.length>0){hourlyIncome+=friends.length*2.0;}// Добавляем доход за уровень: 1 VL за каждый уровень выше 1\nif(level>1){hourlyIncome+=(level-1)*1.0;}// Обновляем баланс\nconst newBalance=balance+hourlyIncome;setBalance(newBalance);// Показываем уведомление о начислении дохода\nsetBalanceChange(\"+\".concat(hourlyIncome.toFixed(2)));setTimeout(()=>{setBalanceChange(null);},3000);// Сохраняем время последнего начисления\nlocalStorage.setItem('lastIncomeTime',now.toString());// Обновляем баланс в базе данных\nif(dbUser&&dbUser.id){try{console.log(\"\\u041E\\u0431\\u043D\\u043E\\u0432\\u043B\\u0435\\u043D\\u0438\\u0435 \\u0431\\u0430\\u043B\\u0430\\u043D\\u0441\\u0430 \\u0432 \\u0411\\u0414: \".concat(balance,\" + \").concat(hourlyIncome,\" = \").concat(newBalance));const updatedUser=await updateUserBalance(dbUser.id,newBalance);if(updatedUser){setDbUser(updatedUser);console.log('Баланс успешно обновлен в БД после начисления дохода:',updatedUser.balance);}}catch(error){console.error('Ошибка при обновлении баланса в БД:',error);}}// Сохраняем обновленные данные локально\nsetTimeout(async()=>{await saveData();},100);return{success:true,hourlyIncome};}catch(error){console.error('Ошибка при начислении пассивного дохода:',error);return{success:false,error:error.message};}},[dailyIncome,dbUser,balance,items,friends,level,saveData,userData.userId,calculateLevel,exp]);// Запускаем начисление пассивного дохода при загрузке и каждый час\nuseEffect(()=>{if(loading||!userData.userId)return;console.log('Запуск системы пассивного дохода');// Начисляем доход при загрузке только если прошел час с последнего начисления\napplyPassiveIncome();// Устанавливаем интервал для проверки каждый час\nconst incomeInterval=setInterval(()=>{applyPassiveIncome();},60*60*1000);// 1 час\nreturn()=>clearInterval(incomeInterval);},[loading,userData.userId,applyPassiveIncome]);// Обработчик клика по карте Таро\nconst handleTarotCardClick=screenId=>{if(screenId){setScreen(screenId);}};// Обработчик переключения темы\nconst toggleTheme=()=>{const themes=['mystical','cosmic','ethereal'];const currentIndex=themes.indexOf(visualTheme);const nextIndex=(currentIndex+1)%themes.length;setVisualTheme(themes[nextIndex]);};// Обработчик переключения звука\nconst toggleSound=()=>{setSoundEnabled(!soundEnabled);};// High contrast toggle\nconst[highContrast,setHighContrast]=useState(false);useEffect(()=>{const root=document.documentElement;if(highContrast){root.classList.add('high-contrast');}else{root.classList.remove('high-contrast');}},[highContrast]);// Animate energy orb flying to the balance counter\nuseEffect(()=>{const handler=e=>{const layer=document.getElementById('energy-orb-layer');if(!layer)return;const{x,y}=e.detail||{};const orb=document.createElement('div');Object.assign(orb.style,{position:'fixed',left:x+'px',top:y+'px',width:'10px',height:'10px',borderRadius:'50%',background:'radial-gradient(circle, #A8C7FA, #1A3C34)',boxShadow:'0 0 15px rgba(168,199,250,0.8)'});layer.appendChild(orb);// Target roughly center of the balance control in header\nconst header=document.querySelector('.app-header');const targetRect=header?header.getBoundingClientRect():{left:window.innerWidth/2,top:20,width:100,height:40};const tx=targetRect.left+targetRect.width/2;const ty=targetRect.top+targetRect.height/2;anime({targets:orb,translateX:tx-x,translateY:ty-y,scale:[1,0.6],easing:'easeInOutQuad',duration:600,complete:()=>{if(orb&&orb.parentNode)orb.parentNode.removeChild(orb);}});};window.addEventListener('energy-collected',handler);return()=>window.removeEventListener('energy-collected',handler);},[]);// Show Magic Circle VFX when portal opens\nconst[showCircle,setShowCircle]=useState(false);useEffect(()=>{const portalOpenListener=()=>{setShowCircle(true);setTimeout(()=>setShowCircle(false),1100);};window.addEventListener('portal-opened',portalOpenListener);return()=>window.removeEventListener('portal-opened',portalOpenListener);},[]);return/*#__PURE__*/_jsxs(\"div\",{className:\"app-container\",children:[/*#__PURE__*/_jsx(\"div\",{id:\"energy-orb-layer\",style:{position:'fixed',inset:0,pointerEvents:'none',zIndex:5}}),/*#__PURE__*/_jsx(\"div\",{id:\"page-transition\",className:\"page-transition-overlay\"}),/*#__PURE__*/_jsx(MagicCircleVFX,{show:showCircle,color:\"#A8C7FA\"}),/*#__PURE__*/_jsx(MagicalBackground,{theme:visualTheme,soundEnabled:soundEnabled,currentScreen:currentScreen,onCardClick:handleTarotCardClick,paused:currentScreen==='farm'}),loading?/*#__PURE__*/_jsxs(\"div\",{className:\"loading-screen\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"forest-background\"}),/*#__PURE__*/_jsx(\"div\",{className:\"loader\"}),/*#__PURE__*/_jsx(QuillTextEffect,{text:\"\\u041E\\u0442\\u043A\\u0440\\u044B\\u0432\\u0430\\u0435\\u043C \\u043A\\u043D\\u0438\\u0433\\u0443 \\u043C\\u0438\\u0441\\u0442\\u0438\\u0447\\u0435\\u0441\\u043A\\u043E\\u0433\\u043E \\u043F\\u0440\\u043E\\u0441\\u0442\\u0440\\u0430\\u043D\\u0441\\u0442\\u0432\\u0430...\",fontSize:\"1.5rem\",speed:40,autoStart:true,style:{color:COLOR_PALETTE.beigeParchment,maxWidth:'80%',margin:'20px auto',textAlign:'center'}})]}):/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"div\",{className:\"forest-background\"}),/*#__PURE__*/_jsx(\"div\",{className:\"candle candle-left\"}),/*#__PURE__*/_jsx(\"div\",{className:\"candle candle-right\"}),/*#__PURE__*/_jsx(\"div\",{className:\"app-header\",style:{display:'flex',justifyContent:'center',alignItems:'center'},children:/*#__PURE__*/_jsx(GothicBalance,{balance:balance,incomePerHour:dailyIncome,change:balanceChange,onClick:toggleBalanceDetails,symbol:currentScreen==='farm'?'☽':currentScreen==='artifacts'?'♦':currentScreen==='shop'?'♱':'✦',progress:Math.min(1,(exp||0)/(calculateNextLevelExp(level)||1))})}),showBalanceDetails&&/*#__PURE__*/_jsx(\"div\",{className:\"modal-overlay\",onClick:()=>setShowBalanceDetails(false),children:/*#__PURE__*/_jsxs(\"div\",{className:\"modal-content\",onClick:e=>e.stopPropagation(),children:[/*#__PURE__*/_jsx(\"h3\",{children:\"\\u0412\\u0430\\u0448\\u0430 \\u044D\\u043D\\u0435\\u0440\\u0433\\u0438\\u044F\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"balance-details\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"balance-detail-item\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"detail-label\",children:\"\\u0422\\u0435\\u043A\\u0443\\u0449\\u0438\\u0439 \\u0431\\u0430\\u043B\\u0430\\u043D\\u0441:\"}),/*#__PURE__*/_jsxs(\"span\",{className:\"detail-value\",children:[balance.toFixed(2),\" \\u2726\"]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"balance-detail-item\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"detail-label\",children:\"\\u0415\\u0436\\u0435\\u0434\\u043D\\u0435\\u0432\\u043D\\u044B\\u0439 \\u0434\\u043E\\u0445\\u043E\\u0434:\"}),/*#__PURE__*/_jsxs(\"span\",{className:\"detail-value\",children:[(dailyIncome*24).toFixed(2),\" VL\"]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"balance-detail-item\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"detail-label\",children:\"\\u041F\\u043E\\u0447\\u0430\\u0441\\u043E\\u0432\\u043E\\u0439 \\u0434\\u043E\\u0445\\u043E\\u0434:\"}),/*#__PURE__*/_jsxs(\"span\",{className:\"detail-value\",children:[dailyIncome.toFixed(2),\" VL\"]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"balance-detail-item\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"detail-label\",children:\"\\u0423\\u0440\\u043E\\u0432\\u0435\\u043D\\u044C:\"}),/*#__PURE__*/_jsx(\"span\",{className:\"detail-value\",children:level})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"balance-detail-item\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"detail-label\",children:\"\\u0417\\u0430\\u0440\\u0430\\u0431\\u043E\\u0442\\u0430\\u043D\\u043E \\u043D\\u0430\\u0436\\u0430\\u0442\\u0438\\u044F\\u043C\\u0438:\"}),/*#__PURE__*/_jsx(\"span\",{className:\"detail-value\",children:\"0.01 \\u2726 / \\u043D\\u0430\\u0436\\u0430\\u0442\\u0438\\u0435\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"balance-detail-item\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"detail-label\",children:\"\\u041A\\u043E\\u043C\\u0431\\u043E \\u0431\\u043E\\u043D\\u0443\\u0441:\"}),/*#__PURE__*/_jsx(\"span\",{className:\"detail-value\",children:\"x2 \\u043F\\u043E\\u0441\\u043B\\u0435 5 \\u043D\\u0430\\u0436\\u0430\\u0442\\u0438\\u0439\"})]})]}),/*#__PURE__*/_jsx(\"button\",{className:\"btn btn-primary\",onClick:()=>setShowBalanceDetails(false),children:\"\\u0417\\u0430\\u043A\\u0440\\u044B\\u0442\\u044C\"})]})}),/*#__PURE__*/_jsx(\"div\",{className:\"app-main\",children:renderScreen}),/*#__PURE__*/_jsx(\"div\",{className:\"app-footer\",children:/*#__PURE__*/_jsx(NavBar,{currentScreen:currentScreen,setScreen:setScreen})}),/*#__PURE__*/_jsx(\"div\",{className:\"guitar-icon \".concat(playingGuitar?'playing':''),onClick:playGuitar,children:/*#__PURE__*/_jsx(\"div\",{className:\"guitar-strings\"})}),/*#__PURE__*/_jsx(\"div\",{className:\"settings-controls\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"settings-stack\",children:[/*#__PURE__*/_jsx(MusicControl,{soundEnabled:soundEnabled,onSoundToggle:setSoundEnabled,position:\"inline\",className:\"gothic-music-control\"}),/*#__PURE__*/_jsx(\"button\",{className:\"theme-toggle-btn\",onClick:toggleTheme,title:\"\\u0421\\u043C\\u0435\\u043D\\u0438\\u0442\\u044C \\u0432\\u0438\\u0437\\u0443\\u0430\\u043B\\u044C\\u043D\\u0443\\u044E \\u0442\\u0435\\u043C\\u0443\",children:visualTheme==='mystical'?'☽':visualTheme==='cosmic'?'✧':'⚝'}),/*#__PURE__*/_jsx(\"button\",{className:\"sound-toggle-btn\",onClick:toggleSound,title:soundEnabled?\"Выключить звук\":\"Включить звук\",children:soundEnabled?'♫':'♪'}),/*#__PURE__*/_jsx(\"button\",{className:\"contrast-toggle-btn\",onClick:()=>setHighContrast(v=>!v),title:highContrast?'Обычный контраст':'Высокий контраст',children:highContrast?'HC':'hc'})]})})]})]});}export default App;","map":{"version":3,"names":["React","useEffect","useMemo","useCallback","useRef","useState","saveUserData","loadUserData","initTelegramApp","createMainMenuButtons","sendWelcomeMessage","openSupportBot","createOrUpdateUser","getUserByTelegramId","updateUserBalance","HomeScreen","EarnScreen","FarmScreen","TasksScreen","ProfileScreen","ShopScreen","FriendsScreen","FunScreen","ArtifactsScreen","NavBar","getAllUsersData","sendFriendRequest","getFriendRequests","acceptFriendRequest","acceptFriendRequestDb","rejectFriendRequest","rejectFriendRequestDb","getFriends","executeApiRequest","getUserItems","config","MagicalBackground","QuillTextEffect","GothicBalance","MusicControl","anime","MagicCircleVFX","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","COLOR_PALETTE","darkPurple","beigeParchment","darkTurquoise","inkyBlue","moonBlue","App","userData","setUserData","currentScreen","setCurrentScreen","balance","setBalance","exp","setExp","level","setLevel","items","setItems","friends","setFriends","friendRequests","setFriendRequests","loading","setLoading","dailyIncome","setDailyIncome","dbUser","setDbUser","friendsLoaded","setFriendsLoaded","playingGuitar","setPlayingGuitar","balanceChange","setBalanceChange","showBalanceDetails","setShowBalanceDetails","soundEnabled","setSoundEnabled","visualTheme","setVisualTheme","performanceTrackingRef","loadStartTime","performance","now","renderCount","isInitializedRef","guitarAudioRef","saveData","userId","filteredItems","filter","item","id","isNaN","parseInt","savedBalance","updatedUser","parseFloat","console","log","error","dataToSave","lastSave","Date","toISOString","calculateLevel","Math","floor","sqrt","calculateNextLevelExp","currentLevel","loadFriendsData","forceUpdate","arguments","length","undefined","concat","friendsList","requests","loadApp","tgData","savedData","dbUserData","isTelegram","userItems","formattedItems","map","userItem","name","description","price","income_per_hour","image_url","type","quantity","totalIncome","reduce","sum","itemsError","newUser","telegram_id","username","first_name","firstName","last_name","lastName","calculatedLevel","setTimeout","createCryptids","current","Audio","volume","loadTime","toFixed","saveTimeout","clearTimeout","updateBalance","amount","expReward","numericAmount","numericExpReward","currentBalance","currentExp","newBalance","max","newExp","newLevel","friendBonus","bonusPerFriend","success","warn","message","buyItem","itemId","existingItemIndex","findIndex","i","updatedItems","_objectSpread","newItem","income","newItems","slice","newIncome","response","expectedPrice","Array","isArray","sendFriendRequestHandler","friendId","handleProfileUpdate","updates","prev","renderTime","group","groupEnd","handleFriendsScreenLoad","handleUseArtifact","artifact","effect","includes","renderScreen","children","screenProps","home","onTap","earn","onComplete","reward","farm","tasks","shop","onBuy","onSendRequest","onAcceptRequest","onRejectRequest","onLoadFriends","profile","nextLevelExp","onUpdate","fun","onPlay","artifacts","onUseArtifact","screenComponents","Screen","existingLayer","document","querySelector","remove","cryptidLayer","createElement","className","body","appendChild","maxCryptids","window","innerWidth","cryptid","posX","random","posY","delay","Object","assign","style","left","top","backgroundImage","animationDelay","parentNode","removeChild","playGuitar","currentTime","play","toggleBalanceDetails","setScreen","screenId","overlay","getElementById","opacity","targets","duration","easing","complete","gtag","screen_name","applyPassiveIncome","lastIncomeTime","localStorage","getItem","timeSinceLastIncome","oneHour","minutesLeft","ceil","dbBalance","hourlyIncome","baseIncome","itemIncome","setItem","toString","incomeInterval","setInterval","clearInterval","handleTarotCardClick","toggleTheme","themes","currentIndex","indexOf","nextIndex","toggleSound","highContrast","setHighContrast","root","documentElement","classList","add","handler","e","layer","x","y","detail","orb","position","width","height","borderRadius","background","boxShadow","header","targetRect","getBoundingClientRect","tx","ty","translateX","translateY","scale","addEventListener","removeEventListener","showCircle","setShowCircle","portalOpenListener","inset","pointerEvents","zIndex","show","color","theme","onCardClick","paused","text","fontSize","speed","autoStart","maxWidth","margin","textAlign","display","justifyContent","alignItems","incomePerHour","change","onClick","symbol","progress","min","stopPropagation","onSoundToggle","title","v"],"sources":["/var/www/www-root/data/www/knigavl.ru/src/App.js"],"sourcesContent":["import React, { useEffect, useMemo, useCallback, useRef, useState } from 'react';\r\nimport { saveUserData, loadUserData } from './services/storage';\r\nimport { initTelegramApp } from './services/telegram';\r\nimport { createMainMenuButtons, sendWelcomeMessage, openSupportBot } from './services/telegram';\r\nimport { createOrUpdateUser, getUserByTelegramId, updateUserBalance } from './services/userService';\r\nimport HomeScreen from './screens/HomeScreen';\r\nimport EarnScreen from './screens/EarnScreen';\r\nimport FarmScreen from './screens/FarmScreen';\r\nimport TasksScreen from './screens/TasksScreen';\r\nimport ProfileScreen from './screens/ProfileScreen';\r\nimport ShopScreen from './screens/ShopScreen';\r\nimport FriendsScreen from './screens/FriendsScreen';\r\nimport FunScreen from './screens/FunScreen';\r\nimport ArtifactsScreen from './screens/ArtifactsScreen';\r\nimport NavBar from './components/NavBar';\r\nimport { getAllUsersData, sendFriendRequest, getFriendRequests, acceptFriendRequest as acceptFriendRequestDb, rejectFriendRequest as rejectFriendRequestDb, getFriends, executeApiRequest } from './services/database';\r\nimport { getUserItems } from './services/userService';\r\nimport config from './config';\r\nimport './App.css';\r\nimport MagicalBackground from './components/MagicalBackground';\r\nimport QuillTextEffect from './components/QuillTextEffect';\r\nimport GothicBalance from './components/GothicBalance';\r\nimport MusicControl from './components/MusicControl';\r\nimport anime from 'animejs/lib/anime.js';\r\nimport MagicCircleVFX from './components/MagicCircleVFX';\r\n\r\n// Цветовая палитра из требований\r\nconst COLOR_PALETTE = {\r\n  darkPurple: '#3C2F4F',    // Тёмно-фиолетовый — основной фон\r\n  beigeParchment: '#E8D3A9', // Бежево-пергаментный — текст, акценты\r\n  darkTurquoise: '#1A3C34',  // Тёмный бирюзовый — светлячки, свечение\r\n  inkyBlue: '#1B263B',       // Чернильный синий — тени, контуры\r\n  moonBlue: '#A8C7FA',       // Голубоватый оттенок луны\r\n};\r\n\r\nfunction App() {\r\n  // State management\r\n  const [userData, setUserData] = React.useState({});\r\n  const [currentScreen, setCurrentScreen] = React.useState('home');\r\n  const [balance, setBalance] = React.useState(0);\r\n  const [exp, setExp] = React.useState(0);\r\n  const [level, setLevel] = React.useState(1);\r\n  const [items, setItems] = React.useState([]);\r\n  const [friends, setFriends] = React.useState([]);\r\n  const [friendRequests, setFriendRequests] = React.useState([]);\r\n  const [loading, setLoading] = React.useState(true);\r\n  const [dailyIncome, setDailyIncome] = React.useState(2058.00);\r\n  const [dbUser, setDbUser] = React.useState(null);\r\n  const [friendsLoaded, setFriendsLoaded] = React.useState(false);\r\n  const [playingGuitar, setPlayingGuitar] = useState(false);\r\n  const [balanceChange, setBalanceChange] = useState(null);\r\n  const [showBalanceDetails, setShowBalanceDetails] = useState(false);\r\n  const [soundEnabled, setSoundEnabled] = useState(false);\r\n  const [visualTheme, setVisualTheme] = useState('mystical');\r\n  \r\n  // Performance tracking ref\r\n  const performanceTrackingRef = useRef({\r\n    loadStartTime: performance.now(),\r\n    renderCount: 0\r\n  });\r\n\r\n  // Ref для отслеживания первой загрузки\r\n  const isInitializedRef = useRef(false);\r\n\r\n  // Audio refs\r\n  const guitarAudioRef = useRef(null);\r\n\r\n  // Функция для сохранения данных пользователя\r\n  const saveData = async () => {\r\n    if (!userData.userId) return;\r\n    \r\n    // Фильтруем предметы, оставляя только те, что имеют числовые ID (из базы данных)\r\n    const filteredItems = items.filter(item => \r\n      typeof item.id === 'number' || \r\n      (typeof item.id === 'string' && !isNaN(parseInt(item.id)))\r\n    );\r\n    \r\n    // Если есть данные пользователя из БД, используем баланс из БД\r\n    let savedBalance = balance;\r\n    if (dbUser) {\r\n      try {\r\n        // Получаем актуальные данные пользователя из БД\r\n        const updatedUser = await getUserByTelegramId(userData.userId);\r\n        if (updatedUser) {\r\n          savedBalance = parseFloat(updatedUser.balance || balance);\r\n          console.log('Получен актуальный баланс из БД для сохранения:', savedBalance);\r\n        }\r\n      } catch (error) {\r\n        console.error('Ошибка при получении актуального баланса из БД:', error);\r\n      }\r\n    }\r\n    \r\n    const dataToSave = {\r\n      balance: savedBalance,\r\n      exp,\r\n      items: filteredItems,\r\n      friends,\r\n      friendRequests,\r\n      dailyIncome,\r\n      lastSave: new Date().toISOString()\r\n    };\r\n    \r\n    saveUserData(userData.userId, dataToSave);\r\n    console.log('Данные сохранены локально:', dataToSave);\r\n  };\r\n\r\n  // Memoized calculation functions\r\n  const calculateLevel = useCallback((exp) => {\r\n    return Math.floor(Math.sqrt(exp / 100)) + 1;\r\n  }, []);\r\n\r\n  const calculateNextLevelExp = useCallback((currentLevel) => {\r\n    return (currentLevel * currentLevel) * 100;\r\n  }, []);\r\n\r\n  // Загрузка друзей и запросов в друзья\r\n  const loadFriendsData = useCallback(async (userId, forceUpdate = false) => {\r\n    try {\r\n      if (!userId) {\r\n        console.error('Не указан ID пользователя для загрузки данных о друзьях');\r\n        return;\r\n      }\r\n      \r\n      // Проверяем, нужно ли загружать данные о друзьях\r\n      if (friendsLoaded && !forceUpdate) {\r\n        console.log('Данные о друзьях уже загружены, пропускаем запрос');\r\n        return;\r\n      }\r\n      \r\n      console.log(`Загрузка данных о друзьях для пользователя ${userId}`);\r\n      setFriendsLoaded(true); // Устанавливаем флаг загрузки перед запросами\r\n      \r\n      try {\r\n        // Используем переданный userId для запроса друзей\r\n        const friendsList = await getFriends(userId);\r\n        console.log('Загружены друзья:', friendsList);\r\n        setFriends(friendsList || []);\r\n      } catch (error) {\r\n        console.error('Ошибка при загрузке списка друзей:', error);\r\n        // Не меняем текущее состояние друзей в случае ошибки\r\n      }\r\n      \r\n      try {\r\n        // Используем переданный userId для запроса запросов в друзья\r\n        const requests = await getFriendRequests(userId);\r\n        console.log('Загружены запросы в друзья:', requests);\r\n        setFriendRequests(requests || []);\r\n      } catch (error) {\r\n        console.error('Ошибка при загрузке запросов в друзья:', error);\r\n        // Не меняем текущее состояние запросов в случае ошибки\r\n      }\r\n    } catch (error) {\r\n      console.error('Общая ошибка при загрузке данных о друзьях:', error);\r\n    }\r\n  }, []);\r\n\r\n  // Инициализация и загрузка данных\r\n  useEffect(() => {\r\n    const loadApp = async () => {\r\n      try {\r\n        setLoading(true);\r\n        const tgData = initTelegramApp();\r\n        console.log('Telegram data:', tgData);\r\n        \r\n        if (!tgData || !tgData.userId) {\r\n          console.error('Не удалось получить данные пользователя Telegram');\r\n          setLoading(false);\r\n          return;\r\n        }\r\n        \r\n        setUserData(tgData);\r\n\r\n        // Загружаем данные из локального хранилища\r\n        const savedData = await loadUserData(tgData.userId);\r\n        console.log('Локальные данные:', savedData);\r\n\r\n        // Загружаем данные пользователя из БД (только внутри Telegram)\r\n        let dbUserData = null;\r\n        try {\r\n          if (tgData.isTelegram) {\r\n            dbUserData = await getUserByTelegramId(tgData.userId);\r\n            console.log('Данные пользователя из БД:', dbUserData);\r\n          }\r\n          if (dbUserData) {\r\n            setDbUser(dbUserData);\r\n            \r\n            // Если пользователь найден в БД, загружаем его друзей и запросы\r\n            // Используем telegram_id вместо внутреннего id\r\n            await loadFriendsData(tgData.userId);\r\n            \r\n            // Загружаем предметы пользователя из БД\r\n            try {\r\n              const userItems = await getUserItems(dbUserData.id);\r\n              console.log('Предметы пользователя из БД:', userItems);\r\n              \r\n              if (userItems && userItems.length > 0) {\r\n                // Преобразуем формат предметов из БД в формат, используемый в приложении\r\n                const formattedItems = userItems.map(userItem => {\r\n                  const item = userItem.item;\r\n                  return {\r\n                    id: item.id,\r\n                    name: item.name,\r\n                    description: item.description,\r\n                    price: item.price,\r\n                    income_per_hour: item.income_per_hour,\r\n                    image_url: item.image_url,\r\n                    type: item.type,\r\n                    quantity: userItem.quantity\r\n                  };\r\n                });\r\n                \r\n                // Обновляем список предметов, заменяя все предметы из базы данных\r\n                setItems(formattedItems);\r\n                \r\n                // Рассчитываем доход от предметов\r\n                const totalIncome = formattedItems.reduce((sum, item) => {\r\n                  console.log(`Предмет: ${item.name}, доход: ${item.income_per_hour}, количество: ${item.quantity}`);\r\n                  return sum + (parseFloat(item.income_per_hour || 0) * (item.quantity || 1));\r\n                }, 0);\r\n                \r\n                // Обновляем дневной доход\r\n                if (totalIncome > 0) {\r\n                  setDailyIncome(totalIncome); // Устанавливаем почасовой доход\r\n                  console.log(`Установлен почасовой доход из предметов: ${totalIncome} VL/час (${totalIncome * 24} VL/день)`);\r\n                }\r\n              }\r\n            } catch (itemsError) {\r\n              console.error('Ошибка при загрузке предметов пользователя:', itemsError);\r\n              // Если не удалось загрузить предметы из БД, используем локальные данные\r\n              if (savedData) {\r\n                setItems(savedData.items || []);\r\n                setDailyIncome(savedData.dailyIncome || 2058.00);\r\n              }\r\n            }\r\n          } else if (tgData.isTelegram) {\r\n            console.log('Пользователь не найден в БД, создаем нового');\r\n            const newUser = await createOrUpdateUser({\r\n              telegram_id: tgData.userId,\r\n              username: tgData.username || `user_${tgData.userId}`,\r\n              first_name: tgData.firstName || '',\r\n              last_name: tgData.lastName || '',\r\n              balance: savedData ? savedData.balance : 100,\r\n              exp: savedData ? savedData.exp : 0\r\n            });\r\n            \r\n            console.log('Создан новый пользователь:', newUser);\r\n            setDbUser(newUser);\r\n            dbUserData = newUser;\r\n          }\r\n        } catch (error) {\r\n          console.error('Ошибка при загрузке данных пользователя из БД:', error);\r\n        }\r\n\r\n        // Устанавливаем начальные значения, приоритет у данных из БД\r\n        if (dbUserData) {\r\n          // Используем баланс из БД, если он доступен\r\n          setBalance(parseFloat(dbUserData.balance || 100));\r\n          setExp(parseFloat(dbUserData.exp || 0));\r\n          const calculatedLevel = calculateLevel(parseFloat(dbUserData.exp || 0));\r\n          setLevel(calculatedLevel);\r\n          \r\n          // Игнорируем баланс из локального хранилища, всегда используем баланс из БД\r\n          if (savedData) {\r\n            // Обновляем локальное хранилище с актуальным балансом из БД\r\n            savedData.balance = parseFloat(dbUserData.balance || 100);\r\n            saveUserData(tgData.userId, savedData);\r\n            console.log('Локальное хранилище обновлено с балансом из БД:', parseFloat(dbUserData.balance || 100));\r\n          }\r\n        } else if (savedData) {\r\n          // Если нет данных из БД, используем локальные данные\r\n          setBalance(savedData.balance || 100);\r\n          setExp(savedData.exp || 0);\r\n          const calculatedLevel = calculateLevel(savedData.exp || 0);\r\n          setLevel(calculatedLevel);\r\n        } else {\r\n          // Значения по умолчанию для нового пользователя\r\n          setBalance(100);\r\n          setExp(0);\r\n          setLevel(1);\r\n        }\r\n\r\n        // Загружаем остальные данные из локального хранилища\r\n        if (savedData) {\r\n          // Предметы загружаются из БД, но если их нет, используем локальные\r\n          if (!items || items.length === 0) {\r\n            setItems(savedData.items || []);\r\n            setDailyIncome(savedData.dailyIncome || 2058.00);\r\n          }\r\n          \r\n          setFriends(savedData.friends || []);\r\n          setFriendRequests(savedData.friendRequests || []);\r\n        } else {\r\n          // Значения по умолчанию для нового пользователя\r\n          if (!items || items.length === 0) {\r\n            setItems([]);\r\n            setDailyIncome(2058.00);\r\n          }\r\n          \r\n          setFriends([]);\r\n          setFriendRequests([]);\r\n        }\r\n\r\n        // Создаем криптидов в фоне\r\n        setTimeout(() => {\r\n          createCryptids();\r\n        }, 2000);\r\n\r\n        // Загружаем аудио\r\n        guitarAudioRef.current = new Audio('/guitar-riff.mp3');\r\n        guitarAudioRef.current.volume = 0.5;\r\n\r\n      } catch (error) {\r\n        console.error('Ошибка при загрузке приложения:', error);\r\n      } finally {\r\n        // Завершаем загрузку\r\n        setLoading(false);\r\n        \r\n        // Замеряем время загрузки\r\n        const loadTime = performance.now() - performanceTrackingRef.current.loadStartTime;\r\n        console.log(`Приложение загружено за ${loadTime.toFixed(2)}мс`);\r\n      }\r\n    };\r\n\r\n    if (!isInitializedRef.current) {\r\n    loadApp();\r\n      isInitializedRef.current = true;\r\n    }\r\n  }, [calculateLevel, loadFriendsData]);\r\n\r\n  // Сохраняем данные при изменении состояния\r\n  useEffect(() => {\r\n    if (!userData.userId || loading) return;\r\n    \r\n    // Сохраняем данные с задержкой\r\n    const saveTimeout = setTimeout(async () => {\r\n      await saveData();\r\n    }, 500);\r\n    \r\n    return () => clearTimeout(saveTimeout);\r\n  }, [balance, dailyIncome, exp, friendRequests, friends, items, loading, userData.userId]);\r\n\r\n  // Обновление баланса и опыта\r\n  const updateBalance = async (amount, expReward = 0) => {\r\n    try {\r\n      // Ensure amount is a valid number\r\n      const numericAmount = parseFloat(amount) || 0;\r\n      const numericExpReward = parseFloat(expReward) || 0;\r\n      \r\n      // Ensure current balance is a valid number\r\n      const currentBalance = parseFloat(balance) || 0;\r\n      const currentExp = parseFloat(exp) || 0;\r\n      \r\n      // Show balance change animation if positive\r\n      if (numericAmount > 0) {\r\n        setBalanceChange(`+${numericAmount.toFixed(2)}`);\r\n        \r\n        // Reset balance change after animation\r\n        setTimeout(() => {\r\n          setBalanceChange(null);\r\n        }, 1500);\r\n      }\r\n      \r\n      // Обновляем баланс в интерфейсе сразу для лучшего UX\r\n      const newBalance = Math.max(0, currentBalance + numericAmount);\r\n      setBalance(newBalance);\r\n      \r\n      // Обновляем опыт и уровень\r\n      const newExp = currentExp + numericExpReward;\r\n      setExp(newExp);\r\n      \r\n      const newLevel = calculateLevel(newExp);\r\n      if (newLevel !== level) {\r\n        setLevel(newLevel);\r\n        // Можно добавить уведомление о новом уровне\r\n      }\r\n      \r\n      // Добавляем 2% дохода друзьям\r\n      if (numericAmount > 0) {\r\n        const friendBonus = numericAmount * 0.02; // 2% от дохода\r\n        \r\n        // Распределяем бонус между друзьями\r\n        if (friends.length > 0) {\r\n          const bonusPerFriend = friendBonus / friends.length;\r\n          console.log(`Распределяем бонус ${bonusPerFriend} между ${friends.length} друзьями`);\r\n          \r\n          // Здесь можно добавить логику обновления баланса друзей\r\n        }\r\n      }\r\n      \r\n      // Сохраняем данные локально\r\n      setTimeout(() => {\r\n        saveData();\r\n      }, 100);\r\n      \r\n      // Обновляем баланс в БД\r\n      if (dbUser && dbUser.id) {\r\n        try {\r\n          console.log(`Отправка запроса на обновление баланса для пользователя ${dbUser.id}, новый баланс: ${newBalance.toFixed(2)}`);\r\n          \r\n          // Проверяем, что баланс - это действительное число\r\n          if (isNaN(newBalance)) {\r\n            console.error('Ошибка: Баланс не является числом', newBalance);\r\n            return { success: false, error: 'Некорректное значение баланса' };\r\n          }\r\n          \r\n          // Используем updateUserBalance из userService.js\r\n          const updatedUser = await updateUserBalance(dbUser.id, newBalance.toFixed(2));\r\n          \r\n          if (updatedUser) {\r\n            setDbUser(updatedUser);\r\n            console.log('Баланс успешно обновлен в БД:', updatedUser.balance);\r\n          } else {\r\n            console.warn('Не удалось обновить баланс в БД, но локальные данные сохранены');\r\n          }\r\n        } catch (error) {\r\n          console.error('Ошибка при обновлении баланса в БД:', error);\r\n          // Continue execution even if DB update fails\r\n        }\r\n      }\r\n      \r\n      return { success: true };\r\n    } catch (error) {\r\n      console.error('Ошибка при обновлении баланса:', error);\r\n      return { success: false, error: error.message };\r\n    }\r\n  };\r\n\r\n  // Покупка предмета\r\n  const buyItem = async (item) => {\r\n    try {\r\n      console.log('Попытка покупки предмета:', item);\r\n      \r\n      // Получаем актуальный баланс из базы данных перед покупкой\r\n      let currentBalance = balance;\r\n      \r\n      if (dbUser && dbUser.id) {\r\n        try {\r\n          const updatedUser = await getUserByTelegramId(userData.userId);\r\n          if (updatedUser) {\r\n            currentBalance = parseFloat(updatedUser.balance || balance);\r\n            console.log('Получен актуальный баланс из БД перед покупкой:', currentBalance);\r\n            // Обновляем локальный баланс\r\n            setBalance(currentBalance);\r\n          }\r\n        } catch (error) {\r\n          console.error('Ошибка при получении актуального баланса из БД:', error);\r\n        }\r\n      }\r\n      \r\n      if (currentBalance < item.price) {\r\n        console.log('Недостаточно средств для покупки');\r\n        return { success: false, error: 'Недостаточно средств' };\r\n      }\r\n      \r\n      // Списываем средства\r\n      const newBalance = currentBalance - item.price;\r\n      setBalance(newBalance);\r\n      console.log(`Баланс после покупки: ${newBalance}`);\r\n      \r\n      // Нормализуем ID предмета (может быть строкой или числом)\r\n      const itemId = typeof item.id === 'string' && !isNaN(parseInt(item.id)) ? parseInt(item.id) : item.id;\r\n      \r\n      // Проверяем, есть ли уже такой предмет (проверяем оба варианта ID)\r\n      const existingItemIndex = items.findIndex(i => \r\n        i.id === itemId || \r\n        (typeof i.id === 'string' && typeof itemId === 'number' && parseInt(i.id) === itemId) ||\r\n        (typeof i.id === 'number' && typeof itemId === 'string' && i.id === parseInt(itemId))\r\n      );\r\n      console.log(`Существующий предмет с индексом: ${existingItemIndex}`);\r\n      \r\n      if (existingItemIndex !== -1) {\r\n        // Если предмет уже есть, увеличиваем его количество\r\n        const updatedItems = [...items];\r\n        updatedItems[existingItemIndex] = {\r\n          ...updatedItems[existingItemIndex],\r\n          quantity: (updatedItems[existingItemIndex].quantity || 1) + 1\r\n        };\r\n        setItems(updatedItems);\r\n        console.log('Обновлен существующий предмет:', updatedItems[existingItemIndex]);\r\n      } else {\r\n        // Если предмета нет, добавляем его с количеством 1\r\n        const newItem = { \r\n          ...item, \r\n          id: itemId, // Используем нормализованный ID\r\n          quantity: 1,\r\n          // Убедимся, что у предмета есть поле income_per_hour для совместимости с БД\r\n          income_per_hour: item.income_per_hour || item.income || 0\r\n        };\r\n        setItems([...items, newItem]);\r\n        console.log('Добавлен новый предмет:', newItem);\r\n      }\r\n      \r\n      // Пересчитываем доход\r\n      const newItems = existingItemIndex !== -1 \r\n        ? [...items.slice(0, existingItemIndex), \r\n           {...items[existingItemIndex], quantity: (items[existingItemIndex].quantity || 1) + 1}, \r\n           ...items.slice(existingItemIndex + 1)]\r\n        : [...items, { \r\n            ...item, \r\n            id: itemId, \r\n            quantity: 1,\r\n            income_per_hour: item.income_per_hour || item.income || 0\r\n          }];\r\n        \r\n      const newIncome = newItems.reduce((sum, item) => {\r\n        return sum + (parseFloat(item.income_per_hour || item.income || 0) * (item.quantity || 1));\r\n      }, 0);\r\n      \r\n      setDailyIncome(newIncome);\r\n      console.log(`Новый почасовой доход: ${newIncome} VL/час (${newIncome * 24} VL/день)`);\r\n      \r\n      // Сохраняем данные локально\r\n      setTimeout(async () => {\r\n        await saveData();\r\n      }, 100);\r\n      \r\n      // Обновляем баланс и предметы в БД в одной операции (покупка)\r\n      if (dbUser && dbUser.id) {\r\n        try {\r\n          const response = await executeApiRequest(`/users/${dbUser.id}/purchase`, 'POST', {\r\n            itemId: itemId,\r\n            expectedPrice: item.price\r\n          });\r\n          if (response && response.success) {\r\n            // Синхронизируем баланс и предметы с ответом сервера\r\n            setBalance(parseFloat(response.balance));\r\n            if (Array.isArray(response.userItems)) {\r\n              const formattedItems = response.userItems.map(userItem => {\r\n                const item = userItem.item;\r\n                return {\r\n                  id: item.id,\r\n                  name: item.name,\r\n                  description: item.description,\r\n                  price: item.price,\r\n                  income_per_hour: item.income_per_hour,\r\n                  image_url: item.image_url,\r\n                  type: item.type,\r\n                  quantity: userItem.quantity\r\n                };\r\n              });\r\n              setItems(formattedItems);\r\n            }\r\n          } else {\r\n            console.error('Ошибка покупки на сервере', response);\r\n            return { success: false, error: response?.error || 'Ошибка покупки' };\r\n          }\r\n        } catch (error) {\r\n          console.error('Ошибка при покупке предмета на сервере:', error);\r\n          return { success: false, error: error.message };\r\n        }\r\n      }\r\n      \r\n      return { success: true };\r\n    } catch (error) {\r\n      console.error('Ошибка при покупке предмета:', error);\r\n      return { success: false, error: error.message };\r\n    }\r\n  };\r\n\r\n  // Отправка запроса в друзья\r\n  const sendFriendRequestHandler = async (friendId) => {\r\n    try {\r\n      if (!dbUser || !userData || !userData.userId) {\r\n        return { success: false, error: 'Нет данных пользователя' };\r\n      }\r\n      \r\n      const response = await sendFriendRequest(userData.userId, friendId);\r\n\r\n      if (response && response.success) {\r\n        // Если запрос успешно отправлен, обновляем данные о друзьях\r\n        console.log('Запрос в друзья успешно отправлен, обновляем данные о друзьях');\r\n        \r\n        // Загружаем данные о друзьях принудительно\r\n        try {\r\n          // Загружаем список друзей\r\n          const friendsList = await getFriends(userData.userId);\r\n          console.log('Загружены друзья после отправки запроса:', friendsList);\r\n          setFriends(friendsList || []);\r\n          \r\n          // Загружаем запросы в друзья\r\n          const requests = await getFriendRequests(userData.userId);\r\n          console.log('Загружены запросы в друзья после отправки запроса:', requests);\r\n          setFriendRequests(requests || []);\r\n        } catch (error) {\r\n          console.error('Ошибка при обновлении данных о друзьях после отправки запроса:', error);\r\n        }\r\n      }\r\n      \r\n      return response || { success: false, error: 'Неизвестная ошибка' };\r\n    } catch (error) {\r\n      return { success: false, error: error.message };\r\n    }\r\n  };\r\n\r\n  // Принятие запроса в друзья\r\n  const acceptFriendRequest = async (friendId) => {\r\n    try {\r\n      if (!dbUser || !userData || !userData.userId) {\r\n        return { success: false, error: 'Нет данных пользователя' };\r\n      }\r\n      \r\n      const response = await acceptFriendRequestDb(userData.userId, friendId);\r\n\r\n      if (response && response.success) {\r\n        // Если запрос успешно принят, обновляем данные о друзьях\r\n        console.log('Запрос в друзья успешно принят, обновляем данные о друзьях');\r\n        \r\n        // Загружаем данные о друзьях принудительно\r\n        try {\r\n          // Загружаем список друзей\r\n          const friendsList = await getFriends(userData.userId);\r\n          console.log('Загружены друзья после принятия запроса:', friendsList);\r\n          setFriends(friendsList || []);\r\n          \r\n          // Загружаем запросы в друзья\r\n          const requests = await getFriendRequests(userData.userId);\r\n          console.log('Загружены запросы в друзья после принятия запроса:', requests);\r\n          setFriendRequests(requests || []);\r\n        } catch (error) {\r\n          console.error('Ошибка при обновлении данных о друзьях после принятия запроса:', error);\r\n        }\r\n        \r\n        setTimeout(() => {\r\n          saveData();\r\n        }, 100);\r\n        \r\n        await updateBalance(100, 50); // 100 VL и 50 XP за нового друга\r\n      }\r\n      \r\n      return response || { success: false, error: 'Неизвестная ошибка' };\r\n    } catch (error) {\r\n      return { success: false, error: error.message };\r\n    }\r\n  };\r\n\r\n  // Отклонение запроса в друзья\r\n  const rejectFriendRequest = async (friendId) => {\r\n    try {\r\n      if (!dbUser || !userData || !userData.userId) {\r\n        return { success: false, error: 'Нет данных пользователя' };\r\n      }\r\n      \r\n      const response = await rejectFriendRequestDb(userData.userId, friendId);\r\n\r\n      if (response && response.success) {\r\n        // Если запрос успешно отклонен, обновляем данные о друзьях\r\n        console.log('Запрос в друзья успешно отклонен, обновляем данные о друзьях');\r\n        \r\n        // Загружаем данные о друзьях принудительно\r\n        try {\r\n          // Загружаем список друзей\r\n          const friendsList = await getFriends(userData.userId);\r\n          console.log('Загружены друзья после отклонения запроса:', friendsList);\r\n          setFriends(friendsList || []);\r\n          \r\n          // Загружаем запросы в друзья\r\n          const requests = await getFriendRequests(userData.userId);\r\n          console.log('Загружены запросы в друзья после отклонения запроса:', requests);\r\n          setFriendRequests(requests || []);\r\n        } catch (error) {\r\n          console.error('Ошибка при обновлении данных о друзьях после отклонения запроса:', error);\r\n        }\r\n        \r\n        setTimeout(() => {\r\n          saveData();\r\n        }, 100);\r\n      }\r\n      \r\n      return response || { success: false, error: 'Неизвестная ошибка' };\r\n    } catch (error) {\r\n      return { success: false, error: error.message };\r\n    }\r\n  };\r\n\r\n  // Обработка обновления профиля\r\n  const handleProfileUpdate = (updates) => {\r\n    setUserData(prev => ({ ...prev, ...updates }));\r\n    \r\n    // Сохраняем данные локально\r\n    setTimeout(() => {\r\n      saveData();\r\n    }, 100);\r\n  };\r\n\r\n  // Performance logging effect\r\n  useEffect(() => {\r\n    performanceTrackingRef.current.renderCount++;\r\n    \r\n    if (performanceTrackingRef.current.renderCount % 10 === 0) {\r\n      const renderTime = performance.now() - performanceTrackingRef.current.loadStartTime;\r\n      console.group('App Performance');\r\n      console.log(`Total renders: ${performanceTrackingRef.current.renderCount}`);\r\n      console.log(`Cumulative render time: ${renderTime.toFixed(2)}ms`);\r\n      console.groupEnd();\r\n    }\r\n  });\r\n\r\n  // Функция для обновления друзей и запросов - вызывается только при переходе на экран друзей\r\n  const handleFriendsScreenLoad = useCallback(() => {\r\n    if (userData && userData.userId && currentScreen === 'friends') {\r\n      // Всегда загружаем данные о друзьях при переходе на экран друзей\r\n      console.log('Загрузка данных о друзьях при переходе на экран друзей');\r\n      loadFriendsData(userData.userId, true); // Принудительное обновление\r\n    }\r\n  }, [userData, currentScreen, loadFriendsData]);\r\n\r\n  // Эффект для одноразовой загрузки данных о друзьях при входе на экран друзей (без интервала)\r\n  useEffect(() => {\r\n    if (currentScreen === 'friends') {\r\n      handleFriendsScreenLoad();\r\n    }\r\n  }, [currentScreen, handleFriendsScreenLoad]);\r\n\r\n  // Обработчик использования артефакта\r\n  const handleUseArtifact = (artifact) => {\r\n    console.log('Использован артефакт:', artifact);\r\n    \r\n    // Здесь можно добавить логику эффектов артефактов\r\n    // Например, временное увеличение дохода, бонус к опыту и т.д.\r\n    \r\n    // Пример: бонус к опыту\r\n    if (artifact.effect && artifact.effect.includes('опыт')) {\r\n      updateBalance(0, 50); // Добавляем 50 опыта\r\n    }\r\n    \r\n    // Пример: бонус к доходу\r\n    if (artifact.effect && artifact.effect.includes('доход')) {\r\n      updateBalance(100, 0); // Добавляем 100 VL\r\n    }\r\n  };\r\n\r\n  // Memoized screen rendering to prevent unnecessary re-renders\r\n  const renderScreen = useMemo(() => {\r\n    if (loading) {\r\n      return <div>Loading...</div>; // Changed from LoadingSpinner to a simple div\r\n    }\r\n\r\n    const screenProps = {\r\n      home: { onTap: () => updateBalance(0.01), balance, dailyIncome },\r\n      earn: { onComplete: (reward) => updateBalance(reward) },\r\n      farm: { balance, updateBalance },\r\n      tasks: { onComplete: (reward) => updateBalance(reward) },\r\n      shop: { balance, items, onBuy: buyItem },\r\n      friends: { \r\n        userData, \r\n        friends, \r\n        friendRequests, \r\n        onSendRequest: sendFriendRequestHandler,\r\n        onAcceptRequest: acceptFriendRequest,\r\n        onRejectRequest: rejectFriendRequest,\r\n        onLoadFriends: handleFriendsScreenLoad\r\n      },\r\n      profile: { \r\n        userData, \r\n        balance, \r\n        exp, \r\n        level, \r\n        nextLevelExp: calculateNextLevelExp(level),\r\n        items,\r\n        onUpdate: handleProfileUpdate\r\n      },\r\n      fun: { balance, onPlay: (amount) => updateBalance(amount) },\r\n      artifacts: { items, balance, onUseArtifact: handleUseArtifact }\r\n    };\r\n\r\n    const screenComponents = {\r\n      home: HomeScreen,\r\n      earn: EarnScreen,\r\n      farm: FarmScreen,\r\n      tasks: TasksScreen,\r\n      shop: ShopScreen,\r\n      friends: FriendsScreen,\r\n      profile: ProfileScreen,\r\n      fun: FunScreen,\r\n      artifacts: ArtifactsScreen\r\n    };\r\n\r\n    const Screen = screenComponents[currentScreen] || HomeScreen;\r\n    return <Screen {...screenProps[currentScreen]} />;\r\n  }, [\r\n    loading, \r\n    currentScreen, \r\n    balance, \r\n    dailyIncome, \r\n    items, \r\n    friends, \r\n    friendRequests, \r\n    userData, \r\n    exp, \r\n    level, \r\n    calculateNextLevelExp,\r\n    handleFriendsScreenLoad,\r\n    handleUseArtifact\r\n  ]);\r\n\r\n  // Create cryptids in the background\r\n  const createCryptids = () => {\r\n    // Очищаем предыдущие криптиды, если они есть\r\n    const existingLayer = document.querySelector('.cryptid-layer');\r\n    if (existingLayer) {\r\n      existingLayer.remove();\r\n    }\r\n    \r\n    const cryptidLayer = document.createElement('div');\r\n    cryptidLayer.className = 'cryptid-layer';\r\n    document.body.appendChild(cryptidLayer);\r\n    \r\n    // Ограничиваем количество криптидов для улучшения производительности\r\n    const maxCryptids = window.innerWidth < 768 ? 3 : 5;\r\n    \r\n    for (let i = 0; i < maxCryptids; i++) {\r\n      const cryptid = document.createElement('div');\r\n      cryptid.className = 'cryptid';\r\n      \r\n      // Случайное положение\r\n      const posX = Math.random() * 90 + 5; // 5-95%\r\n      const posY = Math.random() * 80 + 10; // 10-90%\r\n      \r\n      // Случайная задержка появления\r\n      const delay = Math.random() * 30000; // 0-30 секунд\r\n      \r\n      // Стили\r\n      Object.assign(cryptid.style, {\r\n        left: `${posX}%`,\r\n        top: `${posY}%`,\r\n        backgroundImage: `url('/images/cryptid${i % 3 + 1}.png')`,\r\n        animationDelay: `${delay}ms`\r\n      });\r\n      \r\n      cryptidLayer.appendChild(cryptid);\r\n      \r\n      // Автоматически удаляем криптида через 30 секунд для экономии памяти\r\n      setTimeout(() => {\r\n        if (cryptid.parentNode) {\r\n          cryptid.parentNode.removeChild(cryptid);\r\n        }\r\n      }, 30000 + delay);\r\n    }\r\n  };\r\n\r\n  // Play guitar sound\r\n  const playGuitar = () => {\r\n    if (guitarAudioRef.current) {\r\n      setPlayingGuitar(true);\r\n      guitarAudioRef.current.currentTime = 0;\r\n      guitarAudioRef.current.play();\r\n      \r\n      setTimeout(() => {\r\n        setPlayingGuitar(false);\r\n      }, 3000);\r\n    }\r\n  };\r\n\r\n  // Toggle balance details\r\n  const toggleBalanceDetails = () => {\r\n    setShowBalanceDetails(!showBalanceDetails);\r\n  };\r\n\r\n  // Set current screen\r\n  const setScreen = (screenId) => {\r\n    // GSAP-like page transition via anime.js\r\n    const overlay = document.getElementById('page-transition');\r\n    if (overlay) {\r\n      overlay.style.opacity = 0;\r\n      anime({ targets: overlay, opacity: [0, 1], duration: 120, easing: 'easeInQuad', complete: () => {\r\n        setCurrentScreen(screenId);\r\n        anime({ targets: overlay, opacity: [1, 0], duration: 200, easing: 'easeOutQuad' });\r\n      }});\r\n      // Analytics\r\n      if (window.gtag) {\r\n        window.gtag('event', 'screen_view', { screen_name: screenId });\r\n      }\r\n      return;\r\n    }\r\n    setCurrentScreen(screenId);\r\n    // Track screen change\r\n    if (window.gtag) {\r\n      window.gtag('event', 'screen_view', {\r\n        screen_name: screenId\r\n      });\r\n    }\r\n  };\r\n\r\n  // Функция для начисления пассивного дохода\r\n  const applyPassiveIncome = useCallback(async () => {\r\n    try {\r\n      console.log('Начисление пассивного дохода...');\r\n      \r\n      // Проверяем, есть ли доход для начисления\r\n      if (!dailyIncome || dailyIncome <= 0) {\r\n        console.log('Нет пассивного дохода для начисления');\r\n        return;\r\n      }\r\n      \r\n      // Проверяем, прошел ли час с последнего начисления\r\n      const lastIncomeTime = localStorage.getItem('lastIncomeTime');\r\n      const now = Date.now();\r\n      \r\n      if (lastIncomeTime) {\r\n        const timeSinceLastIncome = now - parseInt(lastIncomeTime, 10);\r\n        const oneHour = 60 * 60 * 1000; // 1 час в миллисекундах\r\n        \r\n        if (timeSinceLastIncome < oneHour) {\r\n          const minutesLeft = Math.ceil((oneHour - timeSinceLastIncome) / (60 * 1000));\r\n          console.log(`До следующего начисления осталось ${minutesLeft} минут`);\r\n          return { success: false, message: `До следующего начисления осталось ${minutesLeft} минут` };\r\n        }\r\n      }\r\n      \r\n      // Сначала получаем актуальный баланс пользователя из базы данных\r\n      if (dbUser && dbUser.id) {\r\n        try {\r\n          // Запрашиваем актуальные данные пользователя из базы\r\n          const updatedUser = await getUserByTelegramId(userData.userId);\r\n          \r\n          if (updatedUser) {\r\n            // Обновляем локальный баланс из базы данных\r\n            const dbBalance = parseFloat(updatedUser.balance || 0);\r\n            setBalance(dbBalance);\r\n            console.log(`Баланс обновлен из базы данных: ${dbBalance.toFixed(2)}`);\r\n            \r\n            // Обновляем опыт и уровень, если они изменились\r\n            if (updatedUser.exp !== undefined && updatedUser.exp !== exp) {\r\n              const newExp = parseFloat(updatedUser.exp);\r\n              setExp(newExp);\r\n              const newLevel = calculateLevel(newExp);\r\n              setLevel(newLevel);\r\n            }\r\n          }\r\n        } catch (error) {\r\n          console.error('Ошибка при получении актуальных данных пользователя:', error);\r\n        }\r\n      }\r\n      \r\n      // Рассчитываем доход на основе предметов\r\n      let hourlyIncome = 0;\r\n      \r\n      // Базовый доход\r\n      const baseIncome = 5.0;\r\n      \r\n      // Доход от предметов\r\n      if (items && items.length > 0) {\r\n        hourlyIncome = items.reduce((sum, item) => {\r\n          // Проверяем, есть ли у предмета свойство income_per_hour или income\r\n          const itemIncome = parseFloat(item.income_per_hour || item.income || 0) * (item.quantity || 1);\r\n          console.log(`Пассивный доход от предмета ${item.name}: ${itemIncome} VL/час (${item.income_per_hour || item.income} × ${item.quantity || 1})`);\r\n          return sum + itemIncome;\r\n        }, 0);\r\n      }\r\n      \r\n      // Если нет дохода от предметов, используем базовый\r\n      if (hourlyIncome <= 0) {\r\n        hourlyIncome = baseIncome;\r\n        console.log(`Используем базовый доход: ${baseIncome} VL/час`);\r\n      } else {\r\n        console.log(`Общий доход от предметов: ${hourlyIncome} VL/час`);\r\n      }\r\n      \r\n      // Добавляем доход от друзей: 2 VL за каждого друга\r\n      if (friends && friends.length > 0) {\r\n        hourlyIncome += friends.length * 2.0;\r\n      }\r\n      \r\n      // Добавляем доход за уровень: 1 VL за каждый уровень выше 1\r\n      if (level > 1) {\r\n        hourlyIncome += (level - 1) * 1.0;\r\n      }\r\n      \r\n      // Обновляем баланс\r\n      const newBalance = balance + hourlyIncome;\r\n      setBalance(newBalance);\r\n      \r\n      // Показываем уведомление о начислении дохода\r\n      setBalanceChange(`+${hourlyIncome.toFixed(2)}`);\r\n      setTimeout(() => {\r\n        setBalanceChange(null);\r\n      }, 3000);\r\n      \r\n      // Сохраняем время последнего начисления\r\n      localStorage.setItem('lastIncomeTime', now.toString());\r\n      \r\n      // Обновляем баланс в базе данных\r\n      if (dbUser && dbUser.id) {\r\n        try {\r\n          console.log(`Обновление баланса в БД: ${balance} + ${hourlyIncome} = ${newBalance}`);\r\n          const updatedUser = await updateUserBalance(dbUser.id, newBalance);\r\n          \r\n          if (updatedUser) {\r\n            setDbUser(updatedUser);\r\n            console.log('Баланс успешно обновлен в БД после начисления дохода:', updatedUser.balance);\r\n          }\r\n        } catch (error) {\r\n          console.error('Ошибка при обновлении баланса в БД:', error);\r\n        }\r\n      }\r\n      \r\n      // Сохраняем обновленные данные локально\r\n      setTimeout(async () => {\r\n        await saveData();\r\n      }, 100);\r\n      \r\n      return { success: true, hourlyIncome };\r\n    } catch (error) {\r\n      console.error('Ошибка при начислении пассивного дохода:', error);\r\n      return { success: false, error: error.message };\r\n    }\r\n  }, [dailyIncome, dbUser, balance, items, friends, level, saveData, userData.userId, calculateLevel, exp]);\r\n\r\n  // Запускаем начисление пассивного дохода при загрузке и каждый час\r\n  useEffect(() => {\r\n    if (loading || !userData.userId) return;\r\n    \r\n    console.log('Запуск системы пассивного дохода');\r\n    \r\n    // Начисляем доход при загрузке только если прошел час с последнего начисления\r\n    applyPassiveIncome();\r\n    \r\n    // Устанавливаем интервал для проверки каждый час\r\n    const incomeInterval = setInterval(() => {\r\n      applyPassiveIncome();\r\n    }, 60 * 60 * 1000); // 1 час\r\n    \r\n    return () => clearInterval(incomeInterval);\r\n  }, [loading, userData.userId, applyPassiveIncome]);\r\n\r\n  // Обработчик клика по карте Таро\r\n  const handleTarotCardClick = (screenId) => {\r\n    if (screenId) {\r\n      setScreen(screenId);\r\n    }\r\n  };\r\n  \r\n  // Обработчик переключения темы\r\n  const toggleTheme = () => {\r\n    const themes = ['mystical', 'cosmic', 'ethereal'];\r\n    const currentIndex = themes.indexOf(visualTheme);\r\n    const nextIndex = (currentIndex + 1) % themes.length;\r\n    setVisualTheme(themes[nextIndex]);\r\n  };\r\n  \r\n  // Обработчик переключения звука\r\n  const toggleSound = () => {\r\n    setSoundEnabled(!soundEnabled);\r\n  };\r\n\r\n  // High contrast toggle\r\n  const [highContrast, setHighContrast] = useState(false);\r\n  useEffect(() => {\r\n    const root = document.documentElement;\r\n    if (highContrast) {\r\n      root.classList.add('high-contrast');\r\n    } else {\r\n      root.classList.remove('high-contrast');\r\n    }\r\n  }, [highContrast]);\r\n\r\n  // Animate energy orb flying to the balance counter\r\n  useEffect(() => {\r\n    const handler = (e) => {\r\n      const layer = document.getElementById('energy-orb-layer');\r\n      if (!layer) return;\r\n      const { x, y } = e.detail || {};\r\n      const orb = document.createElement('div');\r\n      Object.assign(orb.style, {\r\n        position: 'fixed',\r\n        left: x + 'px',\r\n        top: y + 'px',\r\n        width: '10px',\r\n        height: '10px',\r\n        borderRadius: '50%',\r\n        background: 'radial-gradient(circle, #A8C7FA, #1A3C34)',\r\n        boxShadow: '0 0 15px rgba(168,199,250,0.8)'\r\n      });\r\n      layer.appendChild(orb);\r\n      // Target roughly center of the balance control in header\r\n      const header = document.querySelector('.app-header');\r\n      const targetRect = header ? header.getBoundingClientRect() : { left: window.innerWidth/2, top: 20, width: 100, height: 40 };\r\n      const tx = targetRect.left + targetRect.width/2;\r\n      const ty = targetRect.top + targetRect.height/2;\r\n      anime({\r\n        targets: orb,\r\n        translateX: tx - x,\r\n        translateY: ty - y,\r\n        scale: [1, 0.6],\r\n        easing: 'easeInOutQuad',\r\n        duration: 600,\r\n        complete: () => {\r\n          if (orb && orb.parentNode) orb.parentNode.removeChild(orb);\r\n        }\r\n      });\r\n    };\r\n    window.addEventListener('energy-collected', handler);\r\n    return () => window.removeEventListener('energy-collected', handler);\r\n  }, []);\r\n\r\n  // Show Magic Circle VFX when portal opens\r\n  const [showCircle, setShowCircle] = useState(false);\r\n  useEffect(() => {\r\n    const portalOpenListener = () => {\r\n      setShowCircle(true);\r\n      setTimeout(() => setShowCircle(false), 1100);\r\n    };\r\n    window.addEventListener('portal-opened', portalOpenListener);\r\n    return () => window.removeEventListener('portal-opened', portalOpenListener);\r\n  }, []);\r\n\r\n  return (\r\n    <div className=\"app-container\">\r\n      {/* Energy orbs to balance counter */}\r\n      <div id=\"energy-orb-layer\" style={{ position:'fixed', inset:0, pointerEvents:'none', zIndex: 5 }} />\r\n      {/* Page transition overlay */}\r\n      <div id=\"page-transition\" className=\"page-transition-overlay\" />\r\n      <MagicCircleVFX show={showCircle} color=\"#A8C7FA\" />\r\n      <MagicalBackground \r\n        theme={visualTheme} \r\n        soundEnabled={soundEnabled} \r\n        currentScreen={currentScreen}\r\n        onCardClick={handleTarotCardClick}\r\n        paused={currentScreen === 'farm'}\r\n      />\r\n      {loading ? (\r\n        <div className=\"loading-screen\">\r\n          <div className=\"forest-background\"></div>\r\n          <div className=\"loader\"></div>\r\n          <QuillTextEffect \r\n            text=\"Открываем книгу мистического пространства...\" \r\n            fontSize=\"1.5rem\"\r\n            speed={40}\r\n            autoStart={true}\r\n            style={{\r\n              color: COLOR_PALETTE.beigeParchment,\r\n              maxWidth: '80%',\r\n              margin: '20px auto',\r\n              textAlign: 'center'\r\n            }}\r\n          />\r\n        </div>\r\n      ) : (\r\n        <>\r\n          <div className=\"forest-background\"></div>\r\n          \r\n          {/* Candles */}\r\n          <div className=\"candle candle-left\"></div>\r\n          <div className=\"candle candle-right\"></div>\r\n          \r\n          <div className=\"app-header\" style={{ display: 'flex', justifyContent: 'center', alignItems: 'center' }}>\r\n            <GothicBalance \r\n              balance={balance} \r\n              incomePerHour={dailyIncome}\r\n              change={balanceChange}\r\n              onClick={toggleBalanceDetails}\r\n              symbol={currentScreen === 'farm' ? '☽' : currentScreen === 'artifacts' ? '♦' : currentScreen === 'shop' ? '♱' : '✦'}\r\n              progress={Math.min(1, (exp || 0) / (calculateNextLevelExp(level) || 1))}\r\n            />\r\n          </div>\r\n          \r\n          {/* Balance Details Modal */}\r\n          {showBalanceDetails && (\r\n            <div className=\"modal-overlay\" onClick={() => setShowBalanceDetails(false)}>\r\n              <div className=\"modal-content\" onClick={e => e.stopPropagation()}>\r\n                <h3>Ваша энергия</h3>\r\n                <div className=\"balance-details\">\r\n                  <div className=\"balance-detail-item\">\r\n                    <span className=\"detail-label\">Текущий баланс:</span>\r\n                    <span className=\"detail-value\">{balance.toFixed(2)} ✦</span>\r\n                  </div>\r\n                  <div className=\"balance-detail-item\">\r\n                    <span className=\"detail-label\">Ежедневный доход:</span>\r\n                    <span className=\"detail-value\">{(dailyIncome * 24).toFixed(2)} VL</span>\r\n                  </div>\r\n                  <div className=\"balance-detail-item\">\r\n                    <span className=\"detail-label\">Почасовой доход:</span>\r\n                    <span className=\"detail-value\">{dailyIncome.toFixed(2)} VL</span>\r\n                  </div>\r\n                  <div className=\"balance-detail-item\">\r\n                    <span className=\"detail-label\">Уровень:</span>\r\n                    <span className=\"detail-value\">{level}</span>\r\n                  </div>\r\n                  <div className=\"balance-detail-item\">\r\n                    <span className=\"detail-label\">Заработано нажатиями:</span>\r\n                    <span className=\"detail-value\">0.01 ✦ / нажатие</span>\r\n                  </div>\r\n                  <div className=\"balance-detail-item\">\r\n                    <span className=\"detail-label\">Комбо бонус:</span>\r\n                    <span className=\"detail-value\">x2 после 5 нажатий</span>\r\n                  </div>\r\n                </div>\r\n                <button className=\"btn btn-primary\" onClick={() => setShowBalanceDetails(false)}>\r\n                  Закрыть\r\n                </button>\r\n              </div>\r\n            </div>\r\n          )}\r\n          \r\n          <div className=\"app-main\">\r\n            {renderScreen}\r\n          </div>\r\n          \r\n          <div className=\"app-footer\">\r\n            <NavBar currentScreen={currentScreen} setScreen={setScreen} />\r\n          </div>\r\n          \r\n          {/* Guitar icon */}\r\n          <div className={`guitar-icon ${playingGuitar ? 'playing' : ''}`} onClick={playGuitar}>\r\n            <div className=\"guitar-strings\"></div>\r\n          </div>\r\n          \r\n          {/* Кнопки управления темой и звуком */}\r\n          <div className=\"settings-controls\">\r\n            <div className=\"settings-stack\">\r\n              <MusicControl\r\n                soundEnabled={soundEnabled}\r\n                onSoundToggle={setSoundEnabled}\r\n                position=\"inline\"\r\n                className=\"gothic-music-control\"\r\n              />\r\n              <button \r\n                className=\"theme-toggle-btn\" \r\n                onClick={toggleTheme}\r\n                title=\"Сменить визуальную тему\"\r\n              >\r\n                {visualTheme === 'mystical' ? '☽' : visualTheme === 'cosmic' ? '✧' : '⚝'}\r\n              </button>\r\n              <button \r\n                className=\"sound-toggle-btn\" \r\n                onClick={toggleSound}\r\n                title={soundEnabled ? \"Выключить звук\" : \"Включить звук\"}\r\n              >\r\n                {soundEnabled ? '♫' : '♪'}\r\n              </button>\r\n              <button \r\n                className=\"contrast-toggle-btn\" \r\n                onClick={() => setHighContrast(v => !v)}\r\n                title={highContrast ? 'Обычный контраст' : 'Высокий контраст'}\r\n              >\r\n                {highContrast ? 'HC' : 'hc'}\r\n              </button>\r\n            </div>\r\n          </div>\r\n        </>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default App;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}