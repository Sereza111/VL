{"ast":null,"code":"import _objectSpread from\"/var/www/www-root/data/www/knigavl.ru/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import{useState,useEffect,useRef}from'react';/**\r\n * Performance monitoring hook that detects performance issues\r\n * and can trigger performance optimizations\r\n */export const usePerformanceMonitor=()=>{const[performanceMode,setPerformanceMode]=useState('auto');const[fps,setFps]=useState(60);const[isLagging,setIsLagging]=useState(false);const frameCountRef=useRef(0);const lastTimeRef=useRef(performance.now());const fpsHistoryRef=useRef([]);useEffect(()=>{let animationId;const measureFPS=()=>{const currentTime=performance.now();const delta=currentTime-lastTimeRef.current;if(delta>=1000){// Measure every second\nconst currentFps=Math.round(frameCountRef.current*1000/delta);// Keep FPS history for averaging\nfpsHistoryRef.current.push(currentFps);if(fpsHistoryRef.current.length>5){fpsHistoryRef.current.shift();}// Calculate average FPS\nconst avgFps=fpsHistoryRef.current.reduce((a,b)=>a+b,0)/fpsHistoryRef.current.length;setFps(Math.round(avgFps));// Detect performance issues\nconst isCurrentlyLagging=avgFps<30;setIsLagging(isCurrentlyLagging);// Auto-adjust performance mode\nif(performanceMode==='auto'){if(isCurrentlyLagging&&performanceMode!=='low'){console.warn('Performance issues detected, switching to low performance mode');setPerformanceMode('low');}else if(!isCurrentlyLagging&&avgFps>50&&performanceMode!=='high'){setPerformanceMode('high');}}frameCountRef.current=0;lastTimeRef.current=currentTime;}frameCountRef.current++;animationId=requestAnimationFrame(measureFPS);};animationId=requestAnimationFrame(measureFPS);return()=>{if(animationId){cancelAnimationFrame(animationId);}};},[performanceMode]);// Memory usage monitoring (if available)\nconst[memoryUsage,setMemoryUsage]=useState(null);useEffect(()=>{const checkMemory=()=>{if(performance.memory){const used=performance.memory.usedJSHeapSize;const total=performance.memory.totalJSHeapSize;const limit=performance.memory.jsHeapSizeLimit;setMemoryUsage({used:Math.round(used/1048576),// MB\ntotal:Math.round(total/1048576),// MB\nlimit:Math.round(limit/1048576),// MB\npercentage:Math.round(used/limit*100)});// Warn if memory usage is high\nif(used/limit>0.8){console.warn('High memory usage detected:',Math.round(used/limit*100)+'%');}}};const interval=setInterval(checkMemory,5000);// Check every 5 seconds\ncheckMemory();// Initial check\nreturn()=>clearInterval(interval);},[]);const getOptimizationSettings=()=>{const baseSettings={maxAnimations:10,maxParticles:50,audioPolyphony:8,shadowQuality:'high',effectsEnabled:true,renderDistance:1000};if(performanceMode==='low'||isLagging){return _objectSpread(_objectSpread({},baseSettings),{},{maxAnimations:3,maxParticles:10,audioPolyphony:4,shadowQuality:'low',effectsEnabled:false,renderDistance:500});}if(memoryUsage&&memoryUsage.percentage>70){return _objectSpread(_objectSpread({},baseSettings),{},{maxAnimations:5,maxParticles:25,audioPolyphony:6,shadowQuality:'medium',effectsEnabled:true,renderDistance:750});}return baseSettings;};return{fps,isLagging,performanceMode,memoryUsage,setPerformanceMode,getOptimizationSettings};};/**\r\n * Performance optimization utilities\r\n */export const PerformanceUtils={// Throttle function calls\nthrottle:(func,limit)=>{let inThrottle;return function(){const args=arguments;const context=this;if(!inThrottle){func.apply(context,args);inThrottle=true;setTimeout(()=>inThrottle=false,limit);}};},// Debounce function calls\ndebounce:(func,delay)=>{let timeoutId;return function(){const args=arguments;const context=this;clearTimeout(timeoutId);timeoutId=setTimeout(()=>func.apply(context,args),delay);};},// Check if device is mobile\nisMobile:()=>{return /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);},// Get device performance tier\ngetDevicePerformanceTier:()=>{const mobile=PerformanceUtils.isMobile();const memory=navigator.deviceMemory||4;const cores=navigator.hardwareConcurrency||4;if(mobile||memory<2||cores<2){return'low';}else if(memory>=8&&cores>=4){return'high';}else{return'medium';}},// Reduce motion for accessibility and performance\nprefersReducedMotion:()=>{return window.matchMedia('(prefers-reduced-motion: reduce)').matches;}};","map":{"version":3,"names":["useState","useEffect","useRef","usePerformanceMonitor","performanceMode","setPerformanceMode","fps","setFps","isLagging","setIsLagging","frameCountRef","lastTimeRef","performance","now","fpsHistoryRef","animationId","measureFPS","currentTime","delta","current","currentFps","Math","round","push","length","shift","avgFps","reduce","a","b","isCurrentlyLagging","console","warn","requestAnimationFrame","cancelAnimationFrame","memoryUsage","setMemoryUsage","checkMemory","memory","used","usedJSHeapSize","total","totalJSHeapSize","limit","jsHeapSizeLimit","percentage","interval","setInterval","clearInterval","getOptimizationSettings","baseSettings","maxAnimations","maxParticles","audioPolyphony","shadowQuality","effectsEnabled","renderDistance","_objectSpread","PerformanceUtils","throttle","func","inThrottle","args","arguments","context","apply","setTimeout","debounce","delay","timeoutId","clearTimeout","isMobile","test","navigator","userAgent","getDevicePerformanceTier","mobile","deviceMemory","cores","hardwareConcurrency","prefersReducedMotion","window","matchMedia","matches"],"sources":["/var/www/www-root/data/www/knigavl.ru/src/components/PerformanceMonitor.js"],"sourcesContent":["import { useState, useEffect, useRef } from 'react';\r\n\r\n/**\r\n * Performance monitoring hook that detects performance issues\r\n * and can trigger performance optimizations\r\n */\r\nexport const usePerformanceMonitor = () => {\r\n  const [performanceMode, setPerformanceMode] = useState('auto');\r\n  const [fps, setFps] = useState(60);\r\n  const [isLagging, setIsLagging] = useState(false);\r\n  const frameCountRef = useRef(0);\r\n  const lastTimeRef = useRef(performance.now());\r\n  const fpsHistoryRef = useRef([]);\r\n\r\n  useEffect(() => {\r\n    let animationId;\r\n    \r\n    const measureFPS = () => {\r\n      const currentTime = performance.now();\r\n      const delta = currentTime - lastTimeRef.current;\r\n      \r\n      if (delta >= 1000) { // Measure every second\r\n        const currentFps = Math.round((frameCountRef.current * 1000) / delta);\r\n        \r\n        // Keep FPS history for averaging\r\n        fpsHistoryRef.current.push(currentFps);\r\n        if (fpsHistoryRef.current.length > 5) {\r\n          fpsHistoryRef.current.shift();\r\n        }\r\n        \r\n        // Calculate average FPS\r\n        const avgFps = fpsHistoryRef.current.reduce((a, b) => a + b, 0) / fpsHistoryRef.current.length;\r\n        setFps(Math.round(avgFps));\r\n        \r\n        // Detect performance issues\r\n        const isCurrentlyLagging = avgFps < 30;\r\n        setIsLagging(isCurrentlyLagging);\r\n        \r\n        // Auto-adjust performance mode\r\n        if (performanceMode === 'auto') {\r\n          if (isCurrentlyLagging && performanceMode !== 'low') {\r\n            console.warn('Performance issues detected, switching to low performance mode');\r\n            setPerformanceMode('low');\r\n          } else if (!isCurrentlyLagging && avgFps > 50 && performanceMode !== 'high') {\r\n            setPerformanceMode('high');\r\n          }\r\n        }\r\n        \r\n        frameCountRef.current = 0;\r\n        lastTimeRef.current = currentTime;\r\n      }\r\n      \r\n      frameCountRef.current++;\r\n      animationId = requestAnimationFrame(measureFPS);\r\n    };\r\n    \r\n    animationId = requestAnimationFrame(measureFPS);\r\n    \r\n    return () => {\r\n      if (animationId) {\r\n        cancelAnimationFrame(animationId);\r\n      }\r\n    };\r\n  }, [performanceMode]);\r\n\r\n  // Memory usage monitoring (if available)\r\n  const [memoryUsage, setMemoryUsage] = useState(null);\r\n  \r\n  useEffect(() => {\r\n    const checkMemory = () => {\r\n      if (performance.memory) {\r\n        const used = performance.memory.usedJSHeapSize;\r\n        const total = performance.memory.totalJSHeapSize;\r\n        const limit = performance.memory.jsHeapSizeLimit;\r\n        \r\n        setMemoryUsage({\r\n          used: Math.round(used / 1048576), // MB\r\n          total: Math.round(total / 1048576), // MB\r\n          limit: Math.round(limit / 1048576), // MB\r\n          percentage: Math.round((used / limit) * 100)\r\n        });\r\n        \r\n        // Warn if memory usage is high\r\n        if (used / limit > 0.8) {\r\n          console.warn('High memory usage detected:', Math.round((used / limit) * 100) + '%');\r\n        }\r\n      }\r\n    };\r\n    \r\n    const interval = setInterval(checkMemory, 5000); // Check every 5 seconds\r\n    checkMemory(); // Initial check\r\n    \r\n    return () => clearInterval(interval);\r\n  }, []);\r\n\r\n  const getOptimizationSettings = () => {\r\n    const baseSettings = {\r\n      maxAnimations: 10,\r\n      maxParticles: 50,\r\n      audioPolyphony: 8,\r\n      shadowQuality: 'high',\r\n      effectsEnabled: true,\r\n      renderDistance: 1000\r\n    };\r\n\r\n    if (performanceMode === 'low' || isLagging) {\r\n      return {\r\n        ...baseSettings,\r\n        maxAnimations: 3,\r\n        maxParticles: 10,\r\n        audioPolyphony: 4,\r\n        shadowQuality: 'low',\r\n        effectsEnabled: false,\r\n        renderDistance: 500\r\n      };\r\n    }\r\n\r\n    if (memoryUsage && memoryUsage.percentage > 70) {\r\n      return {\r\n        ...baseSettings,\r\n        maxAnimations: 5,\r\n        maxParticles: 25,\r\n        audioPolyphony: 6,\r\n        shadowQuality: 'medium',\r\n        effectsEnabled: true,\r\n        renderDistance: 750\r\n      };\r\n    }\r\n\r\n    return baseSettings;\r\n  };\r\n\r\n  return {\r\n    fps,\r\n    isLagging,\r\n    performanceMode,\r\n    memoryUsage,\r\n    setPerformanceMode,\r\n    getOptimizationSettings\r\n  };\r\n};\r\n\r\n/**\r\n * Performance optimization utilities\r\n */\r\nexport const PerformanceUtils = {\r\n  // Throttle function calls\r\n  throttle: (func, limit) => {\r\n    let inThrottle;\r\n    return function() {\r\n      const args = arguments;\r\n      const context = this;\r\n      if (!inThrottle) {\r\n        func.apply(context, args);\r\n        inThrottle = true;\r\n        setTimeout(() => inThrottle = false, limit);\r\n      }\r\n    };\r\n  },\r\n\r\n  // Debounce function calls\r\n  debounce: (func, delay) => {\r\n    let timeoutId;\r\n    return function() {\r\n      const args = arguments;\r\n      const context = this;\r\n      clearTimeout(timeoutId);\r\n      timeoutId = setTimeout(() => func.apply(context, args), delay);\r\n    };\r\n  },\r\n\r\n  // Check if device is mobile\r\n  isMobile: () => {\r\n    return /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);\r\n  },\r\n\r\n  // Get device performance tier\r\n  getDevicePerformanceTier: () => {\r\n    const mobile = PerformanceUtils.isMobile();\r\n    const memory = navigator.deviceMemory || 4;\r\n    const cores = navigator.hardwareConcurrency || 4;\r\n    \r\n    if (mobile || memory < 2 || cores < 2) {\r\n      return 'low';\r\n    } else if (memory >= 8 && cores >= 4) {\r\n      return 'high';\r\n    } else {\r\n      return 'medium';\r\n    }\r\n  },\r\n\r\n  // Reduce motion for accessibility and performance\r\n  prefersReducedMotion: () => {\r\n    return window.matchMedia('(prefers-reduced-motion: reduce)').matches;\r\n  }\r\n};"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}