{"ast":null,"code":"import{executeApiRequest}from'./database';import config from'../config';// API URL\nconst API_URL=config.api.baseUrl;/**\r\n * Создает нового пользователя или обновляет существующего\r\n * @param {Object} userData - Данные пользователя\r\n * @returns {Promise<Object>} - Созданный или обновленный пользователь\r\n */export const createOrUpdateUser=async userData=>{try{console.log('Создание/обновление пользователя:',userData);const response=await executeApiRequest('/users','POST',userData);return response;}catch(error){console.error('Ошибка при создании/обновлении пользователя:',error);throw error;}};/**\r\n * Получает пользователя по Telegram ID\r\n * @param {string} telegramId - Telegram ID пользователя\r\n * @returns {Promise<Object|null>} - Данные пользователя или null\r\n */export const getUserByTelegramId=async telegramId=>{try{const response=await executeApiRequest(\"/users/by-telegram/\".concat(telegramId));return response;}catch(error){// Если мы не в Telegram WebApp, не блокируем UI — вернём null и продолжим локально\nconsole.warn('Не удалось получить пользователя с сервера (возможно не Telegram WebApp):',(error===null||error===void 0?void 0:error.message)||error);return null;}};/**\r\n * Проверяет существование пользователя по Telegram ID\r\n * @param {string} telegramId - Telegram ID пользователя\r\n * @returns {Promise<boolean>} - true если пользователь существует, иначе false\r\n */export const checkUserExists=async telegramId=>{try{console.log('Проверка существования пользователя с ID:',telegramId);const user=await getUserByTelegramId(telegramId);return!!user;}catch(error){console.error('Ошибка при проверке существования пользователя:',error);return false;}};/**\r\n * Ищет пользователей по части Telegram ID или имени пользователя\r\n * @param {string} searchQuery - Поисковый запрос\r\n * @param {number} limit - Максимальное количество результатов\r\n * @returns {Promise<Array>} - Массив найденных пользователей\r\n */export const searchUsers=async function(searchQuery){let limit=arguments.length>1&&arguments[1]!==undefined?arguments[1]:10;try{if(!searchQuery)return[];const response=await executeApiRequest(\"/users/search?q=\".concat(encodeURIComponent(searchQuery),\"&limit=\").concat(limit));return response;}catch(error){console.error('Ошибка при поиске пользователей:',error);return[];}};/**\r\n * Обновляет баланс пользователя\r\n * @param {string} userId - ID пользователя\r\n * @param {number|string} amount - Новый баланс пользователя\r\n * @returns {Promise<Object>} - Обновленные данные пользователя\r\n */export const updateUserBalance=async(userId,amount)=>{try{// Проверяем, что userId и amount определены\nif(!userId){console.error('Ошибка: userId не указан');throw new Error('ID пользователя не указан');}// Преобразуем amount в число и проверяем его корректность\nconst numericAmount=parseFloat(amount);if(isNaN(numericAmount)){console.error('Ошибка: amount не является числом',amount);throw new Error('Некорректное значение баланса');}// Используем форматированное значение с двумя знаками после запятой\nconst formattedAmount=numericAmount.toFixed(2);console.log(\"\\u041E\\u0431\\u043D\\u043E\\u0432\\u043B\\u0435\\u043D\\u0438\\u0435 \\u0431\\u0430\\u043B\\u0430\\u043D\\u0441\\u0430 \\u043F\\u043E\\u043B\\u044C\\u0437\\u043E\\u0432\\u0430\\u0442\\u0435\\u043B\\u044F \".concat(userId,\" \\u043D\\u0430 \").concat(formattedAmount));// Реальный запрос к API\nconst response=await executeApiRequest(\"/users/\".concat(userId,\"/balance\"),'PUT',{amount:formattedAmount});return response;}catch(error){console.error('Ошибка при обновлении баланса пользователя:',error);// Возвращаем объект с ошибкой вместо выбрасывания исключения\nreturn{success:false,error:error.message};}};/**\r\n * Получает список всех пользователей\r\n * @returns {Promise<Array>} - Список пользователей\r\n */export const getAllUsers=async()=>{try{return await executeApiRequest('/users');}catch(error){console.error('Ошибка при получении списка пользователей:',error);return[];}};// Получение предметов пользователя\nexport const getUserItems=async userId=>{try{console.log(\"\\u0417\\u0430\\u043F\\u0440\\u043E\\u0441 \\u043F\\u0440\\u0435\\u0434\\u043C\\u0435\\u0442\\u043E\\u0432 \\u043F\\u043E\\u043B\\u044C\\u0437\\u043E\\u0432\\u0430\\u0442\\u0435\\u043B\\u044F \\u0441 ID: \".concat(userId));const response=await executeApiRequest(\"/users/\".concat(userId,\"/items\"));console.log(\"\\u041F\\u043E\\u043B\\u0443\\u0447\\u0435\\u043D\\u043E \".concat(response.length,\" \\u043F\\u0440\\u0435\\u0434\\u043C\\u0435\\u0442\\u043E\\u0432 \\u043F\\u043E\\u043B\\u044C\\u0437\\u043E\\u0432\\u0430\\u0442\\u0435\\u043B\\u044F\"));return response;}catch(error){console.error('Ошибка при получении предметов пользователя:',error);// Возвращаем пустой массив в случае ошибки\nreturn[];}};","map":{"version":3,"names":["executeApiRequest","config","API_URL","api","baseUrl","createOrUpdateUser","userData","console","log","response","error","getUserByTelegramId","telegramId","concat","warn","message","checkUserExists","user","searchUsers","searchQuery","limit","arguments","length","undefined","encodeURIComponent","updateUserBalance","userId","amount","Error","numericAmount","parseFloat","isNaN","formattedAmount","toFixed","success","getAllUsers","getUserItems"],"sources":["/var/www/www-root/data/www/knigavl.ru/src/services/userService.js"],"sourcesContent":["import { executeApiRequest } from './database';\r\nimport config from '../config';\r\n\r\n// API URL\r\nconst API_URL = config.api.baseUrl;\r\n\r\n/**\r\n * Создает нового пользователя или обновляет существующего\r\n * @param {Object} userData - Данные пользователя\r\n * @returns {Promise<Object>} - Созданный или обновленный пользователь\r\n */\r\nexport const createOrUpdateUser = async (userData) => {\r\n  try {\r\n    console.log('Создание/обновление пользователя:', userData);\r\n    const response = await executeApiRequest('/users', 'POST', userData);\r\n    return response;\r\n  } catch (error) {\r\n    console.error('Ошибка при создании/обновлении пользователя:', error);\r\n    throw error;\r\n  }\r\n};\r\n\r\n/**\r\n * Получает пользователя по Telegram ID\r\n * @param {string} telegramId - Telegram ID пользователя\r\n * @returns {Promise<Object|null>} - Данные пользователя или null\r\n */\r\nexport const getUserByTelegramId = async (telegramId) => {\r\n  try {\r\n    const response = await executeApiRequest(`/users/by-telegram/${telegramId}`);\r\n    return response;\r\n  } catch (error) {\r\n    // Если мы не в Telegram WebApp, не блокируем UI — вернём null и продолжим локально\r\n    console.warn('Не удалось получить пользователя с сервера (возможно не Telegram WebApp):', error?.message || error);\r\n    return null;\r\n  }\r\n};\r\n\r\n/**\r\n * Проверяет существование пользователя по Telegram ID\r\n * @param {string} telegramId - Telegram ID пользователя\r\n * @returns {Promise<boolean>} - true если пользователь существует, иначе false\r\n */\r\nexport const checkUserExists = async (telegramId) => {\r\n  try {\r\n    console.log('Проверка существования пользователя с ID:', telegramId);\r\n    const user = await getUserByTelegramId(telegramId);\r\n    return !!user;\r\n  } catch (error) {\r\n    console.error('Ошибка при проверке существования пользователя:', error);\r\n    return false;\r\n  }\r\n};\r\n\r\n/**\r\n * Ищет пользователей по части Telegram ID или имени пользователя\r\n * @param {string} searchQuery - Поисковый запрос\r\n * @param {number} limit - Максимальное количество результатов\r\n * @returns {Promise<Array>} - Массив найденных пользователей\r\n */\r\nexport const searchUsers = async (searchQuery, limit = 10) => {\r\n  try {\r\n    if (!searchQuery) return [];\r\n    \r\n    const response = await executeApiRequest(`/users/search?q=${encodeURIComponent(searchQuery)}&limit=${limit}`);\r\n    return response;\r\n  } catch (error) {\r\n    console.error('Ошибка при поиске пользователей:', error);\r\n    return [];\r\n  }\r\n};\r\n\r\n/**\r\n * Обновляет баланс пользователя\r\n * @param {string} userId - ID пользователя\r\n * @param {number|string} amount - Новый баланс пользователя\r\n * @returns {Promise<Object>} - Обновленные данные пользователя\r\n */\r\nexport const updateUserBalance = async (userId, amount) => {\r\n  try {\r\n    // Проверяем, что userId и amount определены\r\n    if (!userId) {\r\n      console.error('Ошибка: userId не указан');\r\n      throw new Error('ID пользователя не указан');\r\n    }\r\n    \r\n    // Преобразуем amount в число и проверяем его корректность\r\n    const numericAmount = parseFloat(amount);\r\n    \r\n    if (isNaN(numericAmount)) {\r\n      console.error('Ошибка: amount не является числом', amount);\r\n      throw new Error('Некорректное значение баланса');\r\n    }\r\n    \r\n    // Используем форматированное значение с двумя знаками после запятой\r\n    const formattedAmount = numericAmount.toFixed(2);\r\n    \r\n    console.log(`Обновление баланса пользователя ${userId} на ${formattedAmount}`);\r\n    \r\n    // Реальный запрос к API\r\n    const response = await executeApiRequest(`/users/${userId}/balance`, 'PUT', { \r\n      amount: formattedAmount \r\n    });\r\n    \r\n    return response;\r\n  } catch (error) {\r\n    console.error('Ошибка при обновлении баланса пользователя:', error);\r\n    // Возвращаем объект с ошибкой вместо выбрасывания исключения\r\n    return { \r\n      success: false, \r\n      error: error.message \r\n    };\r\n  }\r\n};\r\n\r\n/**\r\n * Получает список всех пользователей\r\n * @returns {Promise<Array>} - Список пользователей\r\n */\r\nexport const getAllUsers = async () => {\r\n  try {\r\n    return await executeApiRequest('/users');\r\n  } catch (error) {\r\n    console.error('Ошибка при получении списка пользователей:', error);\r\n    return [];\r\n  }\r\n}; \r\n\r\n// Получение предметов пользователя\r\nexport const getUserItems = async (userId) => {\r\n  try {\r\n    console.log(`Запрос предметов пользователя с ID: ${userId}`);\r\n    const response = await executeApiRequest(`/users/${userId}/items`);\r\n    console.log(`Получено ${response.length} предметов пользователя`);\r\n    return response;\r\n  } catch (error) {\r\n    console.error('Ошибка при получении предметов пользователя:', error);\r\n    // Возвращаем пустой массив в случае ошибки\r\n    return [];\r\n  }\r\n}; "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}