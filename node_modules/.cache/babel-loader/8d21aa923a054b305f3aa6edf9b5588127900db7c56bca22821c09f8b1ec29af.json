{"ast":null,"code":"import React,{useRef,useEffect,useState,useCallback}from'react';import anime from'animejs/lib/anime.js';import AlchemyLab from'../screens/mini/AlchemyLab';import'./AdvancedPortalManager.css';// WebGL Portal Ring —Å —á–∞—Å—Ç–∏—Ü–∞–º–∏ –∏ —ç–Ω–µ—Ä–≥–µ—Ç–∏—á–µ—Å–∫–∏–º–∏ —ç—Ñ—Ñ–µ–∫—Ç–∞–º–∏\nimport{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";class WebGLPortalRing{constructor(canvas){let options=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};this.canvas=canvas;this.gl=canvas.getContext('webgl')||canvas.getContext('experimental-webgl');if(!this.gl){console.warn('WebGL –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è, –∏—Å–ø–æ–ª—å–∑—É–µ–º fallback');this.fallback=true;return;}this.particles=[];this.time=0;this.animationId=null;// –û–ø—Ü–∏–∏ –ø–æ—Ä—Ç–∞–ª–∞\nthis.options={particleCount:options.particleCount||120,colors:options.colors||{primary:[0.3,0.7,1.0],// –ì–æ–ª—É–±–æ–π –ø–æ—Ä—Ç–∞–ª\nsecondary:[1.0,0.8,0.3],// –ó–æ–ª–æ—Ç—ã–µ –∏—Å–∫—Ä—ã\nenergy:[0.6,0.9,1.0]},radius:options.radius||0.8,speed:options.speed||0.02,intensity:options.intensity||1.0};this.initWebGL();this.createParticles();}initWebGL(){const gl=this.gl;// Vertex shader –¥–ª—è –ø–æ—Ä—Ç–∞–ª—å–Ω–æ–≥–æ –∫–æ–ª—å—Ü–∞\nconst vertexShaderSource=\"\\n      attribute vec3 a_position;\\n      attribute vec2 a_uv;\\n      attribute float a_phase;\\n      \\n      uniform float u_time;\\n      uniform mat4 u_projection;\\n      uniform float u_intensity;\\n      \\n      varying vec2 v_uv;\\n      varying float v_intensity;\\n      varying float v_phase;\\n      \\n      void main() {\\n        vec3 pos = a_position;\\n        \\n        // \\u0412\\u043E\\u043B\\u043D\\u043E\\u0432\\u043E\\u0439 \\u044D\\u0444\\u0444\\u0435\\u043A\\u0442 \\u044D\\u043D\\u0435\\u0440\\u0433\\u0438\\u0438\\n        float wave = sin(u_time * 3.0 + a_phase * 10.0) * 0.1 * u_intensity;\\n        pos.y += wave;\\n        \\n        // \\u0412\\u0440\\u0430\\u0449\\u0435\\u043D\\u0438\\u0435 \\u0447\\u0430\\u0441\\u0442\\u0438\\u0446 \\u0432\\u043E\\u043A\\u0440\\u0443\\u0433 \\u0446\\u0435\\u043D\\u0442\\u0440\\u0430\\n        float angle = u_time * 0.5 + a_phase * 6.28318;\\n        float cosAngle = cos(angle);\\n        float sinAngle = sin(angle);\\n        \\n        vec3 rotated = vec3(\\n          pos.x * cosAngle - pos.z * sinAngle,\\n          pos.y,\\n          pos.x * sinAngle + pos.z * cosAngle\\n        );\\n        \\n        // \\u0418\\u043D\\u0442\\u0435\\u043D\\u0441\\u0438\\u0432\\u043D\\u043E\\u0441\\u0442\\u044C \\u0434\\u043B\\u044F \\u043C\\u0435\\u0440\\u0446\\u0430\\u043D\\u0438\\u044F\\n        v_intensity = 0.5 + 0.5 * sin(u_time * 5.0 + a_phase * 15.0);\\n        v_uv = a_uv;\\n        v_phase = a_phase;\\n        \\n        gl_Position = u_projection * vec4(rotated, 1.0);\\n        gl_PointSize = 3.0 + v_intensity * 4.0;\\n      }\\n    \";// Fragment shader –¥–ª—è –º–∞–≥–∏—á–µ—Å–∫–∏—Ö —ç—Ñ—Ñ–µ–∫—Ç–æ–≤\nconst fragmentShaderSource=\"\\n      precision mediump float;\\n      \\n      varying vec2 v_uv;\\n      varying float v_intensity;\\n      varying float v_phase;\\n      \\n      uniform float u_time;\\n      uniform vec3 u_primaryColor;\\n      uniform vec3 u_secondaryColor;\\n      uniform vec3 u_energyColor;\\n      \\n      void main() {\\n        vec2 center = gl_PointCoord - 0.5;\\n        float dist = length(center);\\n        \\n        if (dist > 0.5) discard;\\n        \\n        // \\u041C\\u0430\\u0433\\u0438\\u0447\\u0435\\u0441\\u043A\\u043E\\u0435 \\u0441\\u0432\\u0435\\u0447\\u0435\\u043D\\u0438\\u0435 \\u0441 \\u0440\\u0430\\u0437\\u043D\\u044B\\u043C\\u0438 \\u0446\\u0432\\u0435\\u0442\\u0430\\u043C\\u0438\\n        vec3 color = u_primaryColor;\\n        \\n        // \\u0414\\u043E\\u0431\\u0430\\u0432\\u043B\\u044F\\u0435\\u043C \\u0437\\u043E\\u043B\\u043E\\u0442\\u044B\\u0435 \\u0438\\u0441\\u043A\\u0440\\u044B \\u043E\\u0441\\u043D\\u043E\\u0432\\u0430\\u043D\\u043D\\u044B\\u0435 \\u043D\\u0430 \\u0444\\u0430\\u0437\\u0435 \\u0447\\u0430\\u0441\\u0442\\u0438\\u0446\\u044B\\n        if (v_phase > 0.7) {\\n          color = mix(color, u_secondaryColor, v_intensity);\\n        }\\n        \\n        // \\u042D\\u043D\\u0435\\u0440\\u0433\\u0435\\u0442\\u0438\\u0447\\u0435\\u0441\\u043A\\u043E\\u0435 \\u0441\\u0432\\u0435\\u0447\\u0435\\u043D\\u0438\\u0435 \\u0432 \\u0446\\u0435\\u043D\\u0442\\u0440\\u0435\\n        if (dist < 0.2) {\\n          color = mix(color, u_energyColor, 0.8);\\n        }\\n        \\n        // \\u041F\\u043B\\u0430\\u0432\\u043D\\u044B\\u0439 fade \\u043D\\u0430 \\u043A\\u0440\\u0430\\u044F\\u0445\\n        float alpha = (0.5 - dist) * 2.0 * v_intensity;\\n        \\n        // \\u0414\\u043E\\u043F\\u043E\\u043B\\u043D\\u0438\\u0442\\u0435\\u043B\\u044C\\u043D\\u043E\\u0435 \\u043C\\u0435\\u0440\\u0446\\u0430\\u043D\\u0438\\u0435\\n        alpha *= 0.7 + 0.3 * sin(u_time * 8.0 + v_phase * 20.0);\\n        \\n        gl_FragColor = vec4(color, alpha * 0.8);\\n      }\\n    \";this.program=this.createShaderProgram(vertexShaderSource,fragmentShaderSource);if(!this.program){console.error('–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ–∑–¥–∞—Ç—å —à–µ–π–¥–µ—Ä–Ω—É—é –ø—Ä–æ–≥—Ä–∞–º–º—É');this.fallback=true;return;}// –ü–æ–ª—É—á–∞–µ–º locations –¥–ª—è uniform –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö\nthis.uniforms={time:gl.getUniformLocation(this.program,'u_time'),projection:gl.getUniformLocation(this.program,'u_projection'),intensity:gl.getUniformLocation(this.program,'u_intensity'),primaryColor:gl.getUniformLocation(this.program,'u_primaryColor'),secondaryColor:gl.getUniformLocation(this.program,'u_secondaryColor'),energyColor:gl.getUniformLocation(this.program,'u_energyColor')};// –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º WebGL —Å–æ—Å—Ç–æ—è–Ω–∏–µ\ngl.enable(gl.BLEND);gl.blendFunc(gl.SRC_ALPHA,gl.ONE_MINUS_SRC_ALPHA);gl.clearColor(0.0,0.0,0.0,0.0);}createShaderProgram(vertexShaderSource,fragmentShaderSource){const gl=this.gl;const vertexShader=this.compileShader(gl.VERTEX_SHADER,vertexShaderSource);const fragmentShader=this.compileShader(gl.FRAGMENT_SHADER,fragmentShaderSource);if(!vertexShader||!fragmentShader){return null;}const program=gl.createProgram();gl.attachShader(program,vertexShader);gl.attachShader(program,fragmentShader);gl.linkProgram(program);if(!gl.getProgramParameter(program,gl.LINK_STATUS)){console.error('–û—à–∏–±–∫–∞ –ª–∏–Ω–∫–æ–≤–∫–∏ –ø—Ä–æ–≥—Ä–∞–º–º—ã:',gl.getProgramInfoLog(program));return null;}return program;}compileShader(type,source){const gl=this.gl;const shader=gl.createShader(type);gl.shaderSource(shader,source);gl.compileShader(shader);if(!gl.getShaderParameter(shader,gl.COMPILE_STATUS)){console.error('–û—à–∏–±–∫–∞ –∫–æ–º–ø–∏–ª—è—Ü–∏–∏ —à–µ–π–¥–µ—Ä–∞:',gl.getShaderInfoLog(shader));gl.deleteShader(shader);return null;}return shader;}createParticles(){this.particles=[];const particleCount=this.options.particleCount;const positions=new Float32Array(particleCount*3);const uvs=new Float32Array(particleCount*2);const phases=new Float32Array(particleCount);for(let i=0;i<particleCount;i++){const angle=i/particleCount*Math.PI*2;const radius=this.options.radius+(Math.random()-0.5)*0.3;const height=(Math.random()-0.5)*0.2;// –ü–æ–∑–∏—Ü–∏—è —á–∞—Å—Ç–∏—Ü—ã\npositions[i*3]=Math.cos(angle)*radius;positions[i*3+1]=height;positions[i*3+2]=Math.sin(angle)*radius;// UV –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã\nuvs[i*2]=(Math.cos(angle)+1.0)*0.5;uvs[i*2+1]=(Math.sin(angle)+1.0)*0.5;// –§–∞–∑–∞ –¥–ª—è –∞–Ω–∏–º–∞—Ü–∏–∏\nphases[i]=Math.random();this.particles.push({originalAngle:angle,originalRadius:radius,speed:this.options.speed+Math.random()*0.03,phase:phases[i]});}// –°–æ–∑–¥–∞–µ–º –±—É—Ñ–µ—Ä—ã\nif(this.gl&&this.program){this.positionBuffer=this.gl.createBuffer();this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.positionBuffer);this.gl.bufferData(this.gl.ARRAY_BUFFER,positions,this.gl.STATIC_DRAW);this.uvBuffer=this.gl.createBuffer();this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.uvBuffer);this.gl.bufferData(this.gl.ARRAY_BUFFER,uvs,this.gl.STATIC_DRAW);this.phaseBuffer=this.gl.createBuffer();this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.phaseBuffer);this.gl.bufferData(this.gl.ARRAY_BUFFER,phases,this.gl.STATIC_DRAW);}}animate(){if(this.fallback){this.animateFallback();return;}this.time+=0.016;this.render();this.animationId=requestAnimationFrame(()=>this.animate());}render(){const gl=this.gl;if(!gl||!this.program)return;// –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º viewport\ngl.viewport(0,0,this.canvas.width,this.canvas.height);gl.clear(gl.COLOR_BUFFER_BIT);// –ò—Å–ø–æ–ª—å–∑—É–µ–º —à–µ–π–¥–µ—Ä–Ω—É—é –ø—Ä–æ–≥—Ä–∞–º–º—É\ngl.useProgram(this.program);// –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –ø—Ä–æ–µ–∫—Ü–∏–æ–Ω–Ω—É—é –º–∞—Ç—Ä–∏—Ü—É (–æ—Ä—Ç–æ–≥–æ–Ω–∞–ª—å–Ω–∞—è –ø—Ä–æ–µ–∫—Ü–∏—è)\nconst projection=new Float32Array([2.0,0.0,0.0,0.0,0.0,2.0,0.0,0.0,0.0,0.0,1.0,0.0,0.0,0.0,0.0,1.0]);// –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º uniform –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ\ngl.uniformMatrix4fv(this.uniforms.projection,false,projection);gl.uniform1f(this.uniforms.time,this.time);gl.uniform1f(this.uniforms.intensity,this.options.intensity);gl.uniform3fv(this.uniforms.primaryColor,this.options.colors.primary);gl.uniform3fv(this.uniforms.secondaryColor,this.options.colors.secondary);gl.uniform3fv(this.uniforms.energyColor,this.options.colors.energy);// –ü—Ä–∏–≤—è–∑—ã–≤–∞–µ–º –∞—Ç—Ä–∏–±—É—Ç—ã\nconst positionAttribute=gl.getAttribLocation(this.program,'a_position');const uvAttribute=gl.getAttribLocation(this.program,'a_uv');const phaseAttribute=gl.getAttribLocation(this.program,'a_phase');// –ü–æ–∑–∏—Ü–∏–∏\ngl.bindBuffer(gl.ARRAY_BUFFER,this.positionBuffer);gl.enableVertexAttribArray(positionAttribute);gl.vertexAttribPointer(positionAttribute,3,gl.FLOAT,false,0,0);// UV –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã\ngl.bindBuffer(gl.ARRAY_BUFFER,this.uvBuffer);gl.enableVertexAttribArray(uvAttribute);gl.vertexAttribPointer(uvAttribute,2,gl.FLOAT,false,0,0);// –§–∞–∑—ã\ngl.bindBuffer(gl.ARRAY_BUFFER,this.phaseBuffer);gl.enableVertexAttribArray(phaseAttribute);gl.vertexAttribPointer(phaseAttribute,1,gl.FLOAT,false,0,0);// –†–∏—Å—É–µ–º —á–∞—Å—Ç–∏—Ü—ã\ngl.drawArrays(gl.POINTS,0,this.options.particleCount);}// Fallback –∞–Ω–∏–º–∞—Ü–∏—è –¥–ª—è —É—Å—Ç—Ä–æ–π—Å—Ç–≤ –±–µ–∑ WebGL\nanimateFallback(){const canvas=this.canvas;const ctx=canvas.getContext('2d');if(!ctx)return;ctx.clearRect(0,0,canvas.width,canvas.height);const centerX=canvas.width/2;const centerY=canvas.height/2;const baseRadius=Math.min(canvas.width,canvas.height)*0.3;// –†–∏—Å—É–µ–º —ç–Ω–µ—Ä–≥–µ—Ç–∏—á–µ—Å–∫–æ–µ –∫–æ–ª—å—Ü–æ\nfor(let i=0;i<60;i++){const angle=i/60*Math.PI*2+this.time;const radius=baseRadius+Math.sin(this.time*3+i*0.5)*20;const x=centerX+Math.cos(angle)*radius;const y=centerY+Math.sin(angle)*radius;const alpha=0.5+0.3*Math.sin(this.time*5+i*0.8);const size=3+Math.sin(this.time*4+i*0.3)*2;ctx.save();ctx.globalAlpha=alpha;ctx.fillStyle=i%3===0?'#FFD700':'#87CEEB';ctx.beginPath();ctx.arc(x,y,size,0,Math.PI*2);ctx.fill();ctx.restore();}this.time+=0.016;this.animationId=requestAnimationFrame(()=>this.animateFallback());}setIntensity(intensity){this.options.intensity=intensity;}stop(){if(this.animationId){cancelAnimationFrame(this.animationId);this.animationId=null;}}destroy(){this.stop();if(this.gl&&this.program){this.gl.deleteProgram(this.program);this.gl.deleteBuffer(this.positionBuffer);this.gl.deleteBuffer(this.uvBuffer);this.gl.deleteBuffer(this.phaseBuffer);}}}// –ì–ª–∞–≤–Ω—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –ø—Ä–æ–¥–≤–∏–Ω—É—Ç–æ–≥–æ –ø–æ—Ä—Ç–∞–ª—å–Ω–æ–≥–æ –º–µ–Ω–µ–¥–∂–µ—Ä–∞\nconst AdvancedPortalManager=_ref=>{let{isOpen=false,onClose=null,onComplete=null,clickPosition=null,children}=_ref;const[portalState,setPortalState]=useState('closed');// closed, opening, webgl, expanding, fullscreen, laboratory, closing\nconst[webglRing,setWebglRing]=useState(null);const[isFullscreen,setIsFullscreen]=useState(false);const[isMobile,setIsMobile]=useState(false);const portalContainerRef=useRef(null);const webglCanvasRef=useRef(null);const laboratororyRef=useRef(null);// –û–ø—Ä–µ–¥–µ–ª—è–µ–º –º–æ–±–∏–ª—å–Ω–æ–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ\nuseEffect(()=>{const checkMobile=()=>{setIsMobile(window.innerWidth<=768||/Android|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent));};checkMobile();window.addEventListener('resize',checkMobile);return()=>window.removeEventListener('resize',checkMobile);},[]);// –ó–≤—É–∫–æ–≤—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã\nconst playSound=useCallback(soundType=>{// –ó–¥–µ—Å—å –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –∑–≤—É–∫–æ–≤—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã\nconsole.log(\"Playing sound: \".concat(soundType));},[]);// –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ—Ä—Ç–∞–ª—å–Ω–æ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞\nconst createPortalElement=useCallback((x,y)=>{if(!portalContainerRef.current)return;const portal=portalContainerRef.current;// –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –Ω–∞—á–∞–ª—å–Ω—É—é –ø–æ–∑–∏—Ü–∏—é\nportal.style.left=\"\".concat(x-10,\"px\");portal.style.top=\"\".concat(y-10,\"px\");portal.style.width='20px';portal.style.height='20px';portal.style.display='block';portal.style.opacity='1';return portal;},[]);// –ê–Ω–∏–º–∞—Ü–∏—è –ø–æ—è–≤–ª–µ–Ω–∏—è –ø–æ—Ä—Ç–∞–ª–∞\nconst animatePortalAppearance=useCallback(async()=>{return new Promise(resolve=>{const portal=portalContainerRef.current;if(!portal)return resolve();playSound('portal_opening');// CSS –∞–Ω–∏–º–∞—Ü–∏—è —Ä–∞–∑—Ä—ã–≤–∞ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞\nanime({targets:portal,width:['20px','200px'],height:['20px','200px'],left:el=>parseFloat(el.style.left)-90,top:el=>parseFloat(el.style.top)-90,rotate:[0,720],scale:[0.1,1],opacity:[0,1],duration:isMobile?800:1200,easing:'easeOutCubic',complete:()=>{setPortalState('webgl');resolve();}});});},[isMobile,playSound]);// –ó–∞–ø—É—Å–∫ WebGL —ç—Ñ—Ñ–µ–∫—Ç–æ–≤\nconst startWebGLEffects=useCallback(async()=>{return new Promise(resolve=>{var _portalContainerRef$c;const canvas=webglCanvasRef.current;if(!canvas)return resolve();// –ù–∞—Å—Ç—Ä–æ–π–∫–∞ canvas\nconst rect=(_portalContainerRef$c=portalContainerRef.current)===null||_portalContainerRef$c===void 0?void 0:_portalContainerRef$c.getBoundingClientRect();if(rect){canvas.width=rect.width*(window.devicePixelRatio||1);canvas.height=rect.height*(window.devicePixelRatio||1);canvas.style.width=rect.width+'px';canvas.style.height=rect.height+'px';}// –°–æ–∑–¥–∞–µ–º WebGL —ç—Ñ—Ñ–µ–∫—Ç\nconst ring=new WebGLPortalRing(canvas,{particleCount:isMobile?60:120,intensity:1.0});setWebglRing(ring);ring.animate();// –ü–ª–∞–≤–Ω–æ–µ –ø–æ—è–≤–ª–µ–Ω–∏–µ WebGL canvas\nanime({targets:canvas,opacity:[0,1],duration:600,easing:'easeOutQuad',complete:()=>{setTimeout(()=>{setPortalState('expanding');resolve();},800);}});});},[isMobile]);// –ü–µ—Ä–µ—Ö–æ–¥ –≤ fullscreen\nconst expandToFullscreen=useCallback(async()=>{return new Promise(async resolve=>{// –ü—ã—Ç–∞–µ–º—Å—è –≤–∫–ª—é—á–∏—Ç—å fullscreen\ntry{if(document.documentElement.requestFullscreen){await document.documentElement.requestFullscreen();setIsFullscreen(true);}}catch(e){console.log('Fallback –∫ CSS fullscreen');// Fallback –¥–ª—è iOS Safari –∏ –¥—Ä—É–≥–∏—Ö –±—Ä–∞—É–∑–µ—Ä–æ–≤\ndocument.body.classList.add('portal-fullscreen-fallback');setIsFullscreen(true);}const portal=portalContainerRef.current;if(!portal)return resolve();playSound('portal_expand');// –ê–Ω–∏–º–∞—Ü–∏—è —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è –ø–æ—Ä—Ç–∞–ª–∞\nanime({targets:portal,width:'100vw',height:'100vh',left:'0px',top:'0px',borderRadius:['50%','0%'],duration:isMobile?600:1000,easing:'easeInOutCubic',complete:()=>{setPortalState('laboratory');resolve();}});});},[isMobile,playSound]);// –ó–∞–≥—Ä—É–∑–∫–∞ –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–∏–∏\nconst loadLaboratory=useCallback(()=>{playSound('portal_enter');// –ó–∞—Ç—É—Ö–∞–Ω–∏–µ –ø–æ—Ä—Ç–∞–ª—å–Ω–æ–≥–æ —ç—Ñ—Ñ–µ–∫—Ç–∞\nif(webglRing){anime({targets:webglCanvasRef.current,opacity:0,duration:500,complete:()=>{webglRing.stop();}});}// –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–∏—é\nconst laboratory=laboratororyRef.current;if(laboratory){laboratory.style.display='block';anime({targets:laboratory,opacity:[0,1],scale:[0.9,1],duration:800,easing:'easeOutQuart'});}},[webglRing,playSound]);// –ó–∞–∫—Ä—ã—Ç–∏–µ –ø–æ—Ä—Ç–∞–ª–∞\nconst closePortal=useCallback(async()=>{// –ó–∞—â–∏—Ç–∞ –æ—Ç –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –∑–∞–∫—Ä—ã—Ç–∏—è\nif(portalState==='closing'||portalState==='closed'){return;}console.log('üö™ –ó–∞–∫—Ä—ã—Ç–∏–µ –ø–æ—Ä—Ç–∞–ª–∞...');setPortalState('closing');const laboratory=laboratororyRef.current;const portal=portalContainerRef.current;// –°–∫—Ä—ã–≤–∞–µ–º –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–∏—é\nif(laboratory){await new Promise(resolve=>{anime({targets:laboratory,opacity:0,scale:0.9,duration:400,easing:'easeInQuart',complete:()=>{laboratory.style.display='none';resolve();}});});}// –ê–Ω–∏–º–∞—Ü–∏—è –∑–∞–∫—Ä—ã—Ç–∏—è –ø–æ—Ä—Ç–∞–ª–∞\nif(portal){anime({targets:portal,scale:0,rotate:-360,opacity:0,duration:600,easing:'easeInBack',complete:()=>{portal.style.display='none';setPortalState('closed');}});}// –í—ã—Ö–æ–¥–∏–º –∏–∑ fullscreen\nif(isFullscreen){try{if(document.fullscreenElement){await document.exitFullscreen();}document.body.classList.remove('portal-fullscreen-fallback');setIsFullscreen(false);}catch(e){console.log('–û—à–∏–±–∫–∞ –ø—Ä–∏ –≤—ã—Ö–æ–¥–µ –∏–∑ fullscreen:',e);}}// –û—á–∏—â–∞–µ–º WebGL —Ä–µ—Å—É—Ä—Å—ã\nif(webglRing){webglRing.destroy();setWebglRing(null);}// –ó–∞–¥–µ—Ä–∂–∫–∞ –ø–µ—Ä–µ–¥ –≤—ã–∑–æ–≤–æ–º onClose –¥–ª—è –∏–∑–±–µ–∂–∞–Ω–∏—è –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤\nsetTimeout(()=>{if(onClose){onClose();}},100);},[portalState,isFullscreen,webglRing,onClose]);// –ì–ª–∞–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –æ—Ç–∫—Ä—ã—Ç–∏—è –ø–æ—Ä—Ç–∞–ª–∞\nconst openPortal=useCallback(async()=>{if(portalState!=='closed')return;console.log('üåÄ –ù–ê–ß–ê–õ–û: –û—Ç–∫—Ä—ã—Ç–∏–µ –ø–æ—Ä—Ç–∞–ª–∞...');setPortalState('opening');const{x,y}=clickPosition||{x:window.innerWidth/2,y:window.innerHeight/2};try{// –®–∞–≥ 1: –°–æ–∑–¥–∞–µ–º –ø–æ—Ä—Ç–∞–ª—å–Ω—ã–π —ç–ª–µ–º–µ–Ω—Ç\nconsole.log('üìç –®–ê–ì 1: –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ—Ä—Ç–∞–ª—å–Ω–æ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞ –≤ –ø–æ–∑–∏—Ü–∏–∏',{x,y});createPortalElement(x,y);// –®–∞–≥ 2: –ê–Ω–∏–º–∞—Ü–∏—è –ø–æ—è–≤–ª–µ–Ω–∏—è –ø–æ—Ä—Ç–∞–ª–∞\nconsole.log('‚ú® –®–ê–ì 2: –ó–∞–ø—É—Å–∫ –∞–Ω–∏–º–∞—Ü–∏–∏ –ø–æ—è–≤–ª–µ–Ω–∏—è...');await animatePortalAppearance();console.log('‚úÖ –®–ê–ì 2: –ê–Ω–∏–º–∞—Ü–∏—è –ø–æ—è–≤–ª–µ–Ω–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞');// –®–∞–≥ 3: WebGL —ç—Ñ—Ñ–µ–∫—Ç—ã\nconsole.log('üåÄ –®–ê–ì 3: –ó–∞–ø—É—Å–∫ WebGL —ç—Ñ—Ñ–µ–∫—Ç–æ–≤...');await startWebGLEffects();console.log('‚úÖ –®–ê–ì 3: WebGL —ç—Ñ—Ñ–µ–∫—Ç—ã –∑–∞–≤–µ—Ä—à–µ–Ω—ã');// –®–∞–≥ 4: –ü–µ—Ä–µ—Ö–æ–¥ –≤ fullscreen\nconsole.log('üì± –®–ê–ì 4: –ü–µ—Ä–µ—Ö–æ–¥ –≤ fullscreen...');await expandToFullscreen();console.log('‚úÖ –®–ê–ì 4: Fullscreen –ø–µ—Ä–µ—Ö–æ–¥ –∑–∞–≤–µ—Ä—à–µ–Ω');// –®–∞–≥ 5: –ó–∞–≥—Ä—É–∂–∞–µ–º –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–∏—é\nconsole.log('‚öóÔ∏è –®–ê–ì 5: –ó–∞–≥—Ä—É–∑–∫–∞ –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–∏–∏...');loadLaboratory();console.log('‚úÖ –£–°–ü–ï–•: –ü–æ—Ä—Ç–∞–ª –ø–æ–ª–Ω–æ—Å—Ç—å—é –æ—Ç–∫—Ä—ã—Ç –∏ –≥–æ—Ç–æ–≤ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é!');// –ù–ï –≤—ã–∑—ã–≤–∞–µ–º onComplete —Å—Ä–∞–∑—É - —Ç–æ–ª—å–∫–æ –ø—Ä–∏ —Ä–µ–∞–ª—å–Ω–æ–º –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏\n}catch(error){console.error('‚ùå –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –û–®–ò–ë–ö–ê –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ –ø–æ—Ä—Ç–∞–ª–∞:',error);console.error('Stack trace:',error.stack);// –ù–ï –∑–∞–∫—Ä—ã–≤–∞–µ–º –ø–æ—Ä—Ç–∞–ª –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö - –ø—É—Å—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–∞–º —Ä–µ—à–∞–µ—Ç\n// closePortal();\n}},[portalState,clickPosition,createPortalElement,animatePortalAppearance,startWebGLEffects,expandToFullscreen,loadLaboratory,closePortal,onComplete]);// –≠—Ñ—Ñ–µ–∫—Ç –¥–ª—è –æ—Ç–∫—Ä—ã—Ç–∏—è –ø–æ—Ä—Ç–∞–ª–∞\nuseEffect(()=>{if(isOpen&&portalState==='closed'&&clickPosition){console.log('üåÄ –ó–∞–ø—É—Å–∫ –ø–æ—Ä—Ç–∞–ª—å–Ω–æ–π –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏...');openPortal();}},[isOpen,portalState,openPortal,clickPosition]);// Cleanup —ç—Ñ—Ñ–µ–∫—Ç\nuseEffect(()=>{return()=>{if(webglRing){webglRing.destroy();}// –û—á–∏—â–∞–µ–º fullscreen —Å–æ—Å—Ç–æ—è–Ω–∏–µ\nif(document.fullscreenElement){document.exitFullscreen().catch(()=>{});}document.body.classList.remove('portal-fullscreen-fallback');};},[webglRing]);return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(\"div\",{ref:portalContainerRef,className:\"advanced-portal-container portal-state-\".concat(portalState),style:{position:'fixed',display:'none',zIndex:9999,pointerEvents:portalState==='laboratory'?'auto':'none',borderRadius:'50%',background:'radial-gradient(circle, rgba(60,47,79,0.9) 0%, rgba(27,38,59,0.6) 70%, rgba(26,60,52,0.3) 100%)',boxShadow:'0 0 50px rgba(168,199,250,0.5), inset 0 0 30px rgba(26,60,52,0.8)',border:'2px solid rgba(168,199,250,0.3)'},children:[/*#__PURE__*/_jsx(\"canvas\",{ref:webglCanvasRef,className:\"portal-webgl-canvas\",style:{position:'absolute',top:0,left:0,width:'100%',height:'100%',opacity:0,pointerEvents:'none'}}),/*#__PURE__*/_jsx(\"div\",{ref:laboratororyRef,className:\"portal-laboratory\",style:{position:'absolute',top:0,left:0,width:'100%',height:'100%',display:'none',opacity:0},children:portalState==='laboratory'&&/*#__PURE__*/_jsx(AlchemyLab,{onClose:()=>{console.log('üö™ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–∫—Ä—ã–ª –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–∏—é');closePortal();},onBrew:reward=>{console.log('–ó–µ–ª—å–µ –≥–æ—Ç–æ–≤–æ! –ù–∞–≥—Ä–∞–¥–∞:',reward);if(onComplete)onComplete({type:'brew',reward});},onAddPotion:potion=>{console.log('–î–æ–±–∞–≤–ª–µ–Ω–æ –∑–µ–ª—å–µ:',potion);if(onComplete)onComplete({type:'potion',potion});},energyReward:0.12// –ü–æ–≤—ã—à–µ–Ω–Ω–∞—è –Ω–∞–≥—Ä–∞–¥–∞ –∑–∞ –ø–æ—Ä—Ç–∞–ª—å–Ω—É—é –∞–ª—Ö–∏–º–∏—é\n})}),portalState==='opening'&&/*#__PURE__*/_jsx(\"div\",{className:\"portal-opening-particles\",children:[...Array(20)].map((_,i)=>/*#__PURE__*/_jsx(\"div\",{className:\"portal-particle\",style:{position:'absolute',width:'4px',height:'4px',background:i%2===0?'#A8C7FA':'#FFD700',borderRadius:'50%',animation:\"portalParticle\".concat(i%4,\" 1.5s ease-out forwards\"),left:'50%',top:'50%',boxShadow:'0 0 10px currentColor'}},i))}),(portalState==='webgl'||portalState==='expanding')&&/*#__PURE__*/_jsx(\"div\",{className:\"portal-magic-effects\",children:/*#__PURE__*/_jsx(\"div\",{className:\"portal-runes\",children:['‚ú¶','‚òΩ','‚öù','‚öú','‚òæ','‚úß','‚öπ','‚ô±'].map((rune,i)=>/*#__PURE__*/_jsx(\"div\",{className:\"portal-rune\",style:{position:'absolute',color:'#A8C7FA',fontSize:'18px',textShadow:'0 0 10px currentColor',animation:\"portalRune 3s linear infinite\",animationDelay:\"\".concat(i*0.375,\"s\"),transformOrigin:'center',left:'50%',top:'50%',transform:\"\\n                      translate(-50%, -50%) \\n                      rotate(\".concat(i*45,\"deg) \\n                      translateY(-\").concat(isMobile?'60px':'80px',\")\")},children:rune},i))})})]}),children]});};export default AdvancedPortalManager;","map":{"version":3,"names":["React","useRef","useEffect","useState","useCallback","anime","AlchemyLab","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","WebGLPortalRing","constructor","canvas","options","arguments","length","undefined","gl","getContext","console","warn","fallback","particles","time","animationId","particleCount","colors","primary","secondary","energy","radius","speed","intensity","initWebGL","createParticles","vertexShaderSource","fragmentShaderSource","program","createShaderProgram","error","uniforms","getUniformLocation","projection","primaryColor","secondaryColor","energyColor","enable","BLEND","blendFunc","SRC_ALPHA","ONE_MINUS_SRC_ALPHA","clearColor","vertexShader","compileShader","VERTEX_SHADER","fragmentShader","FRAGMENT_SHADER","createProgram","attachShader","linkProgram","getProgramParameter","LINK_STATUS","getProgramInfoLog","type","source","shader","createShader","shaderSource","getShaderParameter","COMPILE_STATUS","getShaderInfoLog","deleteShader","positions","Float32Array","uvs","phases","i","angle","Math","PI","random","height","cos","sin","push","originalAngle","originalRadius","phase","positionBuffer","createBuffer","bindBuffer","ARRAY_BUFFER","bufferData","STATIC_DRAW","uvBuffer","phaseBuffer","animate","animateFallback","render","requestAnimationFrame","viewport","width","clear","COLOR_BUFFER_BIT","useProgram","uniformMatrix4fv","uniform1f","uniform3fv","positionAttribute","getAttribLocation","uvAttribute","phaseAttribute","enableVertexAttribArray","vertexAttribPointer","FLOAT","drawArrays","POINTS","ctx","clearRect","centerX","centerY","baseRadius","min","x","y","alpha","size","save","globalAlpha","fillStyle","beginPath","arc","fill","restore","setIntensity","stop","cancelAnimationFrame","destroy","deleteProgram","deleteBuffer","AdvancedPortalManager","_ref","isOpen","onClose","onComplete","clickPosition","children","portalState","setPortalState","webglRing","setWebglRing","isFullscreen","setIsFullscreen","isMobile","setIsMobile","portalContainerRef","webglCanvasRef","laboratororyRef","checkMobile","window","innerWidth","test","navigator","userAgent","addEventListener","removeEventListener","playSound","soundType","log","concat","createPortalElement","current","portal","style","left","top","display","opacity","animatePortalAppearance","Promise","resolve","targets","el","parseFloat","rotate","scale","duration","easing","complete","startWebGLEffects","_portalContainerRef$c","rect","getBoundingClientRect","devicePixelRatio","ring","setTimeout","expandToFullscreen","document","documentElement","requestFullscreen","e","body","classList","add","borderRadius","loadLaboratory","laboratory","closePortal","fullscreenElement","exitFullscreen","remove","openPortal","innerHeight","stack","catch","ref","className","position","zIndex","pointerEvents","background","boxShadow","border","onBrew","reward","onAddPotion","potion","energyReward","Array","map","_","animation","rune","color","fontSize","textShadow","animationDelay","transformOrigin","transform"],"sources":["/var/www/www-root/data/www/knigavl.ru/src/components/AdvancedPortalManager.js"],"sourcesContent":["import React, { useRef, useEffect, useState, useCallback } from 'react';\r\nimport anime from 'animejs/lib/anime.js';\r\nimport AlchemyLab from '../screens/mini/AlchemyLab';\r\nimport './AdvancedPortalManager.css';\r\n\r\n// WebGL Portal Ring —Å —á–∞—Å—Ç–∏—Ü–∞–º–∏ –∏ —ç–Ω–µ—Ä–≥–µ—Ç–∏—á–µ—Å–∫–∏–º–∏ —ç—Ñ—Ñ–µ–∫—Ç–∞–º–∏\r\nclass WebGLPortalRing {\r\n  constructor(canvas, options = {}) {\r\n    this.canvas = canvas;\r\n    this.gl = canvas.getContext('webgl') || canvas.getContext('experimental-webgl');\r\n    \r\n    if (!this.gl) {\r\n      console.warn('WebGL –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è, –∏—Å–ø–æ–ª—å–∑—É–µ–º fallback');\r\n      this.fallback = true;\r\n      return;\r\n    }\r\n\r\n    this.particles = [];\r\n    this.time = 0;\r\n    this.animationId = null;\r\n    \r\n    // –û–ø—Ü–∏–∏ –ø–æ—Ä—Ç–∞–ª–∞\r\n    this.options = {\r\n      particleCount: options.particleCount || 120,\r\n      colors: options.colors || {\r\n        primary: [0.3, 0.7, 1.0], // –ì–æ–ª—É–±–æ–π –ø–æ—Ä—Ç–∞–ª\r\n        secondary: [1.0, 0.8, 0.3], // –ó–æ–ª–æ—Ç—ã–µ –∏—Å–∫—Ä—ã\r\n        energy: [0.6, 0.9, 1.0]\r\n      },\r\n      radius: options.radius || 0.8,\r\n      speed: options.speed || 0.02,\r\n      intensity: options.intensity || 1.0\r\n    };\r\n    \r\n    this.initWebGL();\r\n    this.createParticles();\r\n  }\r\n\r\n  initWebGL() {\r\n    const gl = this.gl;\r\n    \r\n    // Vertex shader –¥–ª—è –ø–æ—Ä—Ç–∞–ª—å–Ω–æ–≥–æ –∫–æ–ª—å—Ü–∞\r\n    const vertexShaderSource = `\r\n      attribute vec3 a_position;\r\n      attribute vec2 a_uv;\r\n      attribute float a_phase;\r\n      \r\n      uniform float u_time;\r\n      uniform mat4 u_projection;\r\n      uniform float u_intensity;\r\n      \r\n      varying vec2 v_uv;\r\n      varying float v_intensity;\r\n      varying float v_phase;\r\n      \r\n      void main() {\r\n        vec3 pos = a_position;\r\n        \r\n        // –í–æ–ª–Ω–æ–≤–æ–π —ç—Ñ—Ñ–µ–∫—Ç —ç–Ω–µ—Ä–≥–∏–∏\r\n        float wave = sin(u_time * 3.0 + a_phase * 10.0) * 0.1 * u_intensity;\r\n        pos.y += wave;\r\n        \r\n        // –í—Ä–∞—â–µ–Ω–∏–µ —á–∞—Å—Ç–∏—Ü –≤–æ–∫—Ä—É–≥ —Ü–µ–Ω—Ç—Ä–∞\r\n        float angle = u_time * 0.5 + a_phase * 6.28318;\r\n        float cosAngle = cos(angle);\r\n        float sinAngle = sin(angle);\r\n        \r\n        vec3 rotated = vec3(\r\n          pos.x * cosAngle - pos.z * sinAngle,\r\n          pos.y,\r\n          pos.x * sinAngle + pos.z * cosAngle\r\n        );\r\n        \r\n        // –ò–Ω—Ç–µ–Ω—Å–∏–≤–Ω–æ—Å—Ç—å –¥–ª—è –º–µ—Ä—Ü–∞–Ω–∏—è\r\n        v_intensity = 0.5 + 0.5 * sin(u_time * 5.0 + a_phase * 15.0);\r\n        v_uv = a_uv;\r\n        v_phase = a_phase;\r\n        \r\n        gl_Position = u_projection * vec4(rotated, 1.0);\r\n        gl_PointSize = 3.0 + v_intensity * 4.0;\r\n      }\r\n    `;\r\n\r\n    // Fragment shader –¥–ª—è –º–∞–≥–∏—á–µ—Å–∫–∏—Ö —ç—Ñ—Ñ–µ–∫—Ç–æ–≤\r\n    const fragmentShaderSource = `\r\n      precision mediump float;\r\n      \r\n      varying vec2 v_uv;\r\n      varying float v_intensity;\r\n      varying float v_phase;\r\n      \r\n      uniform float u_time;\r\n      uniform vec3 u_primaryColor;\r\n      uniform vec3 u_secondaryColor;\r\n      uniform vec3 u_energyColor;\r\n      \r\n      void main() {\r\n        vec2 center = gl_PointCoord - 0.5;\r\n        float dist = length(center);\r\n        \r\n        if (dist > 0.5) discard;\r\n        \r\n        // –ú–∞–≥–∏—á–µ—Å–∫–æ–µ —Å–≤–µ—á–µ–Ω–∏–µ —Å —Ä–∞–∑–Ω—ã–º–∏ —Ü–≤–µ—Ç–∞–º–∏\r\n        vec3 color = u_primaryColor;\r\n        \r\n        // –î–æ–±–∞–≤–ª—è–µ–º –∑–æ–ª–æ—Ç—ã–µ –∏—Å–∫—Ä—ã –æ—Å–Ω–æ–≤–∞–Ω–Ω—ã–µ –Ω–∞ —Ñ–∞–∑–µ —á–∞—Å—Ç–∏—Ü—ã\r\n        if (v_phase > 0.7) {\r\n          color = mix(color, u_secondaryColor, v_intensity);\r\n        }\r\n        \r\n        // –≠–Ω–µ—Ä–≥–µ—Ç–∏—á–µ—Å–∫–æ–µ —Å–≤–µ—á–µ–Ω–∏–µ –≤ —Ü–µ–Ω—Ç—Ä–µ\r\n        if (dist < 0.2) {\r\n          color = mix(color, u_energyColor, 0.8);\r\n        }\r\n        \r\n        // –ü–ª–∞–≤–Ω—ã–π fade –Ω–∞ –∫—Ä–∞—è—Ö\r\n        float alpha = (0.5 - dist) * 2.0 * v_intensity;\r\n        \r\n        // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–µ –º–µ—Ä—Ü–∞–Ω–∏–µ\r\n        alpha *= 0.7 + 0.3 * sin(u_time * 8.0 + v_phase * 20.0);\r\n        \r\n        gl_FragColor = vec4(color, alpha * 0.8);\r\n      }\r\n    `;\r\n    \r\n    this.program = this.createShaderProgram(vertexShaderSource, fragmentShaderSource);\r\n    \r\n    if (!this.program) {\r\n      console.error('–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ–∑–¥–∞—Ç—å —à–µ–π–¥–µ—Ä–Ω—É—é –ø—Ä–æ–≥—Ä–∞–º–º—É');\r\n      this.fallback = true;\r\n      return;\r\n    }\r\n\r\n    // –ü–æ–ª—É—á–∞–µ–º locations –¥–ª—è uniform –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö\r\n    this.uniforms = {\r\n      time: gl.getUniformLocation(this.program, 'u_time'),\r\n      projection: gl.getUniformLocation(this.program, 'u_projection'),\r\n      intensity: gl.getUniformLocation(this.program, 'u_intensity'),\r\n      primaryColor: gl.getUniformLocation(this.program, 'u_primaryColor'),\r\n      secondaryColor: gl.getUniformLocation(this.program, 'u_secondaryColor'),\r\n      energyColor: gl.getUniformLocation(this.program, 'u_energyColor')\r\n    };\r\n\r\n    // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º WebGL —Å–æ—Å—Ç–æ—è–Ω–∏–µ\r\n    gl.enable(gl.BLEND);\r\n    gl.blendFunc(gl.SRC_ALPHA, gl.ONE_MINUS_SRC_ALPHA);\r\n    gl.clearColor(0.0, 0.0, 0.0, 0.0);\r\n  }\r\n\r\n  createShaderProgram(vertexShaderSource, fragmentShaderSource) {\r\n    const gl = this.gl;\r\n    \r\n    const vertexShader = this.compileShader(gl.VERTEX_SHADER, vertexShaderSource);\r\n    const fragmentShader = this.compileShader(gl.FRAGMENT_SHADER, fragmentShaderSource);\r\n    \r\n    if (!vertexShader || !fragmentShader) {\r\n      return null;\r\n    }\r\n    \r\n    const program = gl.createProgram();\r\n    gl.attachShader(program, vertexShader);\r\n    gl.attachShader(program, fragmentShader);\r\n    gl.linkProgram(program);\r\n    \r\n    if (!gl.getProgramParameter(program, gl.LINK_STATUS)) {\r\n      console.error('–û—à–∏–±–∫–∞ –ª–∏–Ω–∫–æ–≤–∫–∏ –ø—Ä–æ–≥—Ä–∞–º–º—ã:', gl.getProgramInfoLog(program));\r\n      return null;\r\n    }\r\n    \r\n    return program;\r\n  }\r\n\r\n  compileShader(type, source) {\r\n    const gl = this.gl;\r\n    const shader = gl.createShader(type);\r\n    gl.shaderSource(shader, source);\r\n    gl.compileShader(shader);\r\n    \r\n    if (!gl.getShaderParameter(shader, gl.COMPILE_STATUS)) {\r\n      console.error('–û—à–∏–±–∫–∞ –∫–æ–º–ø–∏–ª—è—Ü–∏–∏ —à–µ–π–¥–µ—Ä–∞:', gl.getShaderInfoLog(shader));\r\n      gl.deleteShader(shader);\r\n      return null;\r\n    }\r\n    \r\n    return shader;\r\n  }\r\n\r\n  createParticles() {\r\n    this.particles = [];\r\n    const particleCount = this.options.particleCount;\r\n    const positions = new Float32Array(particleCount * 3);\r\n    const uvs = new Float32Array(particleCount * 2);\r\n    const phases = new Float32Array(particleCount);\r\n    \r\n    for (let i = 0; i < particleCount; i++) {\r\n      const angle = (i / particleCount) * Math.PI * 2;\r\n      const radius = this.options.radius + (Math.random() - 0.5) * 0.3;\r\n      const height = (Math.random() - 0.5) * 0.2;\r\n      \r\n      // –ü–æ–∑–∏—Ü–∏—è —á–∞—Å—Ç–∏—Ü—ã\r\n      positions[i * 3] = Math.cos(angle) * radius;\r\n      positions[i * 3 + 1] = height;\r\n      positions[i * 3 + 2] = Math.sin(angle) * radius;\r\n      \r\n      // UV –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã\r\n      uvs[i * 2] = (Math.cos(angle) + 1.0) * 0.5;\r\n      uvs[i * 2 + 1] = (Math.sin(angle) + 1.0) * 0.5;\r\n      \r\n      // –§–∞–∑–∞ –¥–ª—è –∞–Ω–∏–º–∞—Ü–∏–∏\r\n      phases[i] = Math.random();\r\n      \r\n      this.particles.push({\r\n        originalAngle: angle,\r\n        originalRadius: radius,\r\n        speed: this.options.speed + Math.random() * 0.03,\r\n        phase: phases[i]\r\n      });\r\n    }\r\n\r\n    // –°–æ–∑–¥–∞–µ–º –±—É—Ñ–µ—Ä—ã\r\n    if (this.gl && this.program) {\r\n      this.positionBuffer = this.gl.createBuffer();\r\n      this.gl.bindBuffer(this.gl.ARRAY_BUFFER, this.positionBuffer);\r\n      this.gl.bufferData(this.gl.ARRAY_BUFFER, positions, this.gl.STATIC_DRAW);\r\n      \r\n      this.uvBuffer = this.gl.createBuffer();\r\n      this.gl.bindBuffer(this.gl.ARRAY_BUFFER, this.uvBuffer);\r\n      this.gl.bufferData(this.gl.ARRAY_BUFFER, uvs, this.gl.STATIC_DRAW);\r\n      \r\n      this.phaseBuffer = this.gl.createBuffer();\r\n      this.gl.bindBuffer(this.gl.ARRAY_BUFFER, this.phaseBuffer);\r\n      this.gl.bufferData(this.gl.ARRAY_BUFFER, phases, this.gl.STATIC_DRAW);\r\n    }\r\n  }\r\n\r\n  animate() {\r\n    if (this.fallback) {\r\n      this.animateFallback();\r\n      return;\r\n    }\r\n    \r\n    this.time += 0.016;\r\n    this.render();\r\n    this.animationId = requestAnimationFrame(() => this.animate());\r\n  }\r\n\r\n  render() {\r\n    const gl = this.gl;\r\n    if (!gl || !this.program) return;\r\n    \r\n    // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º viewport\r\n    gl.viewport(0, 0, this.canvas.width, this.canvas.height);\r\n    gl.clear(gl.COLOR_BUFFER_BIT);\r\n    \r\n    // –ò—Å–ø–æ–ª—å–∑—É–µ–º —à–µ–π–¥–µ—Ä–Ω—É—é –ø—Ä–æ–≥—Ä–∞–º–º—É\r\n    gl.useProgram(this.program);\r\n    \r\n    // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –ø—Ä–æ–µ–∫—Ü–∏–æ–Ω–Ω—É—é –º–∞—Ç—Ä–∏—Ü—É (–æ—Ä—Ç–æ–≥–æ–Ω–∞–ª—å–Ω–∞—è –ø—Ä–æ–µ–∫—Ü–∏—è)\r\n    const projection = new Float32Array([\r\n      2.0, 0.0, 0.0, 0.0,\r\n      0.0, 2.0, 0.0, 0.0,\r\n      0.0, 0.0, 1.0, 0.0,\r\n      0.0, 0.0, 0.0, 1.0\r\n    ]);\r\n    \r\n    // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º uniform –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ\r\n    gl.uniformMatrix4fv(this.uniforms.projection, false, projection);\r\n    gl.uniform1f(this.uniforms.time, this.time);\r\n    gl.uniform1f(this.uniforms.intensity, this.options.intensity);\r\n    gl.uniform3fv(this.uniforms.primaryColor, this.options.colors.primary);\r\n    gl.uniform3fv(this.uniforms.secondaryColor, this.options.colors.secondary);\r\n    gl.uniform3fv(this.uniforms.energyColor, this.options.colors.energy);\r\n    \r\n    // –ü—Ä–∏–≤—è–∑—ã–≤–∞–µ–º –∞—Ç—Ä–∏–±—É—Ç—ã\r\n    const positionAttribute = gl.getAttribLocation(this.program, 'a_position');\r\n    const uvAttribute = gl.getAttribLocation(this.program, 'a_uv');\r\n    const phaseAttribute = gl.getAttribLocation(this.program, 'a_phase');\r\n    \r\n    // –ü–æ–∑–∏—Ü–∏–∏\r\n    gl.bindBuffer(gl.ARRAY_BUFFER, this.positionBuffer);\r\n    gl.enableVertexAttribArray(positionAttribute);\r\n    gl.vertexAttribPointer(positionAttribute, 3, gl.FLOAT, false, 0, 0);\r\n    \r\n    // UV –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã\r\n    gl.bindBuffer(gl.ARRAY_BUFFER, this.uvBuffer);\r\n    gl.enableVertexAttribArray(uvAttribute);\r\n    gl.vertexAttribPointer(uvAttribute, 2, gl.FLOAT, false, 0, 0);\r\n    \r\n    // –§–∞–∑—ã\r\n    gl.bindBuffer(gl.ARRAY_BUFFER, this.phaseBuffer);\r\n    gl.enableVertexAttribArray(phaseAttribute);\r\n    gl.vertexAttribPointer(phaseAttribute, 1, gl.FLOAT, false, 0, 0);\r\n    \r\n    // –†–∏—Å—É–µ–º —á–∞—Å—Ç–∏—Ü—ã\r\n    gl.drawArrays(gl.POINTS, 0, this.options.particleCount);\r\n  }\r\n\r\n  // Fallback –∞–Ω–∏–º–∞—Ü–∏—è –¥–ª—è —É—Å—Ç—Ä–æ–π—Å—Ç–≤ –±–µ–∑ WebGL\r\n  animateFallback() {\r\n    const canvas = this.canvas;\r\n    const ctx = canvas.getContext('2d');\r\n    \r\n    if (!ctx) return;\r\n    \r\n    ctx.clearRect(0, 0, canvas.width, canvas.height);\r\n    \r\n    const centerX = canvas.width / 2;\r\n    const centerY = canvas.height / 2;\r\n    const baseRadius = Math.min(canvas.width, canvas.height) * 0.3;\r\n    \r\n    // –†–∏—Å—É–µ–º —ç–Ω–µ—Ä–≥–µ—Ç–∏—á–µ—Å–∫–æ–µ –∫–æ–ª—å—Ü–æ\r\n    for (let i = 0; i < 60; i++) {\r\n      const angle = (i / 60) * Math.PI * 2 + this.time;\r\n      const radius = baseRadius + Math.sin(this.time * 3 + i * 0.5) * 20;\r\n      const x = centerX + Math.cos(angle) * radius;\r\n      const y = centerY + Math.sin(angle) * radius;\r\n      \r\n      const alpha = 0.5 + 0.3 * Math.sin(this.time * 5 + i * 0.8);\r\n      const size = 3 + Math.sin(this.time * 4 + i * 0.3) * 2;\r\n      \r\n      ctx.save();\r\n      ctx.globalAlpha = alpha;\r\n      ctx.fillStyle = i % 3 === 0 ? '#FFD700' : '#87CEEB';\r\n      ctx.beginPath();\r\n      ctx.arc(x, y, size, 0, Math.PI * 2);\r\n      ctx.fill();\r\n      ctx.restore();\r\n    }\r\n    \r\n    this.time += 0.016;\r\n    this.animationId = requestAnimationFrame(() => this.animateFallback());\r\n  }\r\n\r\n  setIntensity(intensity) {\r\n    this.options.intensity = intensity;\r\n  }\r\n\r\n  stop() {\r\n    if (this.animationId) {\r\n      cancelAnimationFrame(this.animationId);\r\n      this.animationId = null;\r\n    }\r\n  }\r\n\r\n  destroy() {\r\n    this.stop();\r\n    \r\n    if (this.gl && this.program) {\r\n      this.gl.deleteProgram(this.program);\r\n      this.gl.deleteBuffer(this.positionBuffer);\r\n      this.gl.deleteBuffer(this.uvBuffer);\r\n      this.gl.deleteBuffer(this.phaseBuffer);\r\n    }\r\n  }\r\n}\r\n\r\n// –ì–ª–∞–≤–Ω—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –ø—Ä–æ–¥–≤–∏–Ω—É—Ç–æ–≥–æ –ø–æ—Ä—Ç–∞–ª—å–Ω–æ–≥–æ –º–µ–Ω–µ–¥–∂–µ—Ä–∞\r\nconst AdvancedPortalManager = ({ \r\n  isOpen = false, \r\n  onClose = null, \r\n  onComplete = null,\r\n  clickPosition = null,\r\n  children \r\n}) => {\r\n  const [portalState, setPortalState] = useState('closed'); // closed, opening, webgl, expanding, fullscreen, laboratory, closing\r\n  const [webglRing, setWebglRing] = useState(null);\r\n  const [isFullscreen, setIsFullscreen] = useState(false);\r\n  const [isMobile, setIsMobile] = useState(false);\r\n  \r\n  const portalContainerRef = useRef(null);\r\n  const webglCanvasRef = useRef(null);\r\n  const laboratororyRef = useRef(null);\r\n  \r\n  // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –º–æ–±–∏–ª—å–Ω–æ–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ\r\n  useEffect(() => {\r\n    const checkMobile = () => {\r\n      setIsMobile(window.innerWidth <= 768 || /Android|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent));\r\n    };\r\n    \r\n    checkMobile();\r\n    window.addEventListener('resize', checkMobile);\r\n    return () => window.removeEventListener('resize', checkMobile);\r\n  }, []);\r\n\r\n  // –ó–≤—É–∫–æ–≤—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã\r\n  const playSound = useCallback((soundType) => {\r\n    // –ó–¥–µ—Å—å –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –∑–≤—É–∫–æ–≤—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã\r\n    console.log(`Playing sound: ${soundType}`);\r\n  }, []);\r\n\r\n  // –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ—Ä—Ç–∞–ª—å–Ω–æ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞\r\n  const createPortalElement = useCallback((x, y) => {\r\n    if (!portalContainerRef.current) return;\r\n    \r\n    const portal = portalContainerRef.current;\r\n    \r\n    // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –Ω–∞—á–∞–ª—å–Ω—É—é –ø–æ–∑–∏—Ü–∏—é\r\n    portal.style.left = `${x - 10}px`;\r\n    portal.style.top = `${y - 10}px`;\r\n    portal.style.width = '20px';\r\n    portal.style.height = '20px';\r\n    portal.style.display = 'block';\r\n    portal.style.opacity = '1';\r\n    \r\n    return portal;\r\n  }, []);\r\n\r\n  // –ê–Ω–∏–º–∞—Ü–∏—è –ø–æ—è–≤–ª–µ–Ω–∏—è –ø–æ—Ä—Ç–∞–ª–∞\r\n  const animatePortalAppearance = useCallback(async () => {\r\n    return new Promise((resolve) => {\r\n      const portal = portalContainerRef.current;\r\n      if (!portal) return resolve();\r\n      \r\n      playSound('portal_opening');\r\n      \r\n      // CSS –∞–Ω–∏–º–∞—Ü–∏—è —Ä–∞–∑—Ä—ã–≤–∞ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞\r\n      anime({\r\n        targets: portal,\r\n        width: ['20px', '200px'],\r\n        height: ['20px', '200px'],\r\n        left: (el) => parseFloat(el.style.left) - 90,\r\n        top: (el) => parseFloat(el.style.top) - 90,\r\n        rotate: [0, 720],\r\n        scale: [0.1, 1],\r\n        opacity: [0, 1],\r\n        duration: isMobile ? 800 : 1200,\r\n        easing: 'easeOutCubic',\r\n        complete: () => {\r\n          setPortalState('webgl');\r\n          resolve();\r\n        }\r\n      });\r\n    });\r\n  }, [isMobile, playSound]);\r\n\r\n  // –ó–∞–ø—É—Å–∫ WebGL —ç—Ñ—Ñ–µ–∫—Ç–æ–≤\r\n  const startWebGLEffects = useCallback(async () => {\r\n    return new Promise((resolve) => {\r\n      const canvas = webglCanvasRef.current;\r\n      if (!canvas) return resolve();\r\n      \r\n      // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ canvas\r\n      const rect = portalContainerRef.current?.getBoundingClientRect();\r\n      if (rect) {\r\n        canvas.width = rect.width * (window.devicePixelRatio || 1);\r\n        canvas.height = rect.height * (window.devicePixelRatio || 1);\r\n        canvas.style.width = rect.width + 'px';\r\n        canvas.style.height = rect.height + 'px';\r\n      }\r\n      \r\n      // –°–æ–∑–¥–∞–µ–º WebGL —ç—Ñ—Ñ–µ–∫—Ç\r\n      const ring = new WebGLPortalRing(canvas, {\r\n        particleCount: isMobile ? 60 : 120,\r\n        intensity: 1.0\r\n      });\r\n      \r\n      setWebglRing(ring);\r\n      ring.animate();\r\n      \r\n      // –ü–ª–∞–≤–Ω–æ–µ –ø–æ—è–≤–ª–µ–Ω–∏–µ WebGL canvas\r\n      anime({\r\n        targets: canvas,\r\n        opacity: [0, 1],\r\n        duration: 600,\r\n        easing: 'easeOutQuad',\r\n        complete: () => {\r\n          setTimeout(() => {\r\n            setPortalState('expanding');\r\n            resolve();\r\n          }, 800);\r\n        }\r\n      });\r\n    });\r\n  }, [isMobile]);\r\n\r\n  // –ü–µ—Ä–µ—Ö–æ–¥ –≤ fullscreen\r\n  const expandToFullscreen = useCallback(async () => {\r\n    return new Promise(async (resolve) => {\r\n      // –ü—ã—Ç–∞–µ–º—Å—è –≤–∫–ª—é—á–∏—Ç—å fullscreen\r\n      try {\r\n        if (document.documentElement.requestFullscreen) {\r\n          await document.documentElement.requestFullscreen();\r\n          setIsFullscreen(true);\r\n        }\r\n      } catch (e) {\r\n        console.log('Fallback –∫ CSS fullscreen');\r\n        // Fallback –¥–ª—è iOS Safari –∏ –¥—Ä—É–≥–∏—Ö –±—Ä–∞—É–∑–µ—Ä–æ–≤\r\n        document.body.classList.add('portal-fullscreen-fallback');\r\n        setIsFullscreen(true);\r\n      }\r\n      \r\n      const portal = portalContainerRef.current;\r\n      if (!portal) return resolve();\r\n      \r\n      playSound('portal_expand');\r\n      \r\n      // –ê–Ω–∏–º–∞—Ü–∏—è —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è –ø–æ—Ä—Ç–∞–ª–∞\r\n      anime({\r\n        targets: portal,\r\n        width: '100vw',\r\n        height: '100vh',\r\n        left: '0px',\r\n        top: '0px',\r\n        borderRadius: ['50%', '0%'],\r\n        duration: isMobile ? 600 : 1000,\r\n        easing: 'easeInOutCubic',\r\n        complete: () => {\r\n          setPortalState('laboratory');\r\n          resolve();\r\n        }\r\n      });\r\n    });\r\n  }, [isMobile, playSound]);\r\n\r\n  // –ó–∞–≥—Ä—É–∑–∫–∞ –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–∏–∏\r\n  const loadLaboratory = useCallback(() => {\r\n    playSound('portal_enter');\r\n    \r\n    // –ó–∞—Ç—É—Ö–∞–Ω–∏–µ –ø–æ—Ä—Ç–∞–ª—å–Ω–æ–≥–æ —ç—Ñ—Ñ–µ–∫—Ç–∞\r\n    if (webglRing) {\r\n      anime({\r\n        targets: webglCanvasRef.current,\r\n        opacity: 0,\r\n        duration: 500,\r\n        complete: () => {\r\n          webglRing.stop();\r\n        }\r\n      });\r\n    }\r\n    \r\n    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–∏—é\r\n    const laboratory = laboratororyRef.current;\r\n    if (laboratory) {\r\n      laboratory.style.display = 'block';\r\n      anime({\r\n        targets: laboratory,\r\n        opacity: [0, 1],\r\n        scale: [0.9, 1],\r\n        duration: 800,\r\n        easing: 'easeOutQuart'\r\n      });\r\n    }\r\n  }, [webglRing, playSound]);\r\n\r\n  // –ó–∞–∫—Ä—ã—Ç–∏–µ –ø–æ—Ä—Ç–∞–ª–∞\r\n  const closePortal = useCallback(async () => {\r\n    // –ó–∞—â–∏—Ç–∞ –æ—Ç –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –∑–∞–∫—Ä—ã—Ç–∏—è\r\n    if (portalState === 'closing' || portalState === 'closed') {\r\n      return;\r\n    }\r\n    \r\n    console.log('üö™ –ó–∞–∫—Ä—ã—Ç–∏–µ –ø–æ—Ä—Ç–∞–ª–∞...');\r\n    setPortalState('closing');\r\n    \r\n    const laboratory = laboratororyRef.current;\r\n    const portal = portalContainerRef.current;\r\n    \r\n    // –°–∫—Ä—ã–≤–∞–µ–º –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–∏—é\r\n    if (laboratory) {\r\n      await new Promise(resolve => {\r\n        anime({\r\n          targets: laboratory,\r\n          opacity: 0,\r\n          scale: 0.9,\r\n          duration: 400,\r\n          easing: 'easeInQuart',\r\n          complete: () => {\r\n            laboratory.style.display = 'none';\r\n            resolve();\r\n          }\r\n        });\r\n      });\r\n    }\r\n    \r\n    // –ê–Ω–∏–º–∞—Ü–∏—è –∑–∞–∫—Ä—ã—Ç–∏—è –ø–æ—Ä—Ç–∞–ª–∞\r\n    if (portal) {\r\n      anime({\r\n        targets: portal,\r\n        scale: 0,\r\n        rotate: -360,\r\n        opacity: 0,\r\n        duration: 600,\r\n        easing: 'easeInBack',\r\n        complete: () => {\r\n          portal.style.display = 'none';\r\n          setPortalState('closed');\r\n        }\r\n      });\r\n    }\r\n    \r\n    // –í—ã—Ö–æ–¥–∏–º –∏–∑ fullscreen\r\n    if (isFullscreen) {\r\n      try {\r\n        if (document.fullscreenElement) {\r\n          await document.exitFullscreen();\r\n        }\r\n        document.body.classList.remove('portal-fullscreen-fallback');\r\n        setIsFullscreen(false);\r\n      } catch (e) {\r\n        console.log('–û—à–∏–±–∫–∞ –ø—Ä–∏ –≤—ã—Ö–æ–¥–µ –∏–∑ fullscreen:', e);\r\n      }\r\n    }\r\n    \r\n    // –û—á–∏—â–∞–µ–º WebGL —Ä–µ—Å—É—Ä—Å—ã\r\n    if (webglRing) {\r\n      webglRing.destroy();\r\n      setWebglRing(null);\r\n    }\r\n    \r\n    // –ó–∞–¥–µ—Ä–∂–∫–∞ –ø–µ—Ä–µ–¥ –≤—ã–∑–æ–≤–æ–º onClose –¥–ª—è –∏–∑–±–µ–∂–∞–Ω–∏—è –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤\r\n    setTimeout(() => {\r\n      if (onClose) {\r\n        onClose();\r\n      }\r\n    }, 100);\r\n  }, [portalState, isFullscreen, webglRing, onClose]);\r\n\r\n  // –ì–ª–∞–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –æ—Ç–∫—Ä—ã—Ç–∏—è –ø–æ—Ä—Ç–∞–ª–∞\r\n  const openPortal = useCallback(async () => {\r\n    if (portalState !== 'closed') return;\r\n    \r\n    console.log('üåÄ –ù–ê–ß–ê–õ–û: –û—Ç–∫—Ä—ã—Ç–∏–µ –ø–æ—Ä—Ç–∞–ª–∞...');\r\n    setPortalState('opening');\r\n    \r\n    const { x, y } = clickPosition || { x: window.innerWidth / 2, y: window.innerHeight / 2 };\r\n    \r\n    try {\r\n      // –®–∞–≥ 1: –°–æ–∑–¥–∞–µ–º –ø–æ—Ä—Ç–∞–ª—å–Ω—ã–π —ç–ª–µ–º–µ–Ω—Ç\r\n      console.log('üìç –®–ê–ì 1: –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ—Ä—Ç–∞–ª—å–Ω–æ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞ –≤ –ø–æ–∑–∏—Ü–∏–∏', { x, y });\r\n      createPortalElement(x, y);\r\n      \r\n      // –®–∞–≥ 2: –ê–Ω–∏–º–∞—Ü–∏—è –ø–æ—è–≤–ª–µ–Ω–∏—è –ø–æ—Ä—Ç–∞–ª–∞\r\n      console.log('‚ú® –®–ê–ì 2: –ó–∞–ø—É—Å–∫ –∞–Ω–∏–º–∞—Ü–∏–∏ –ø–æ—è–≤–ª–µ–Ω–∏—è...');\r\n      await animatePortalAppearance();\r\n      console.log('‚úÖ –®–ê–ì 2: –ê–Ω–∏–º–∞—Ü–∏—è –ø–æ—è–≤–ª–µ–Ω–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞');\r\n      \r\n      // –®–∞–≥ 3: WebGL —ç—Ñ—Ñ–µ–∫—Ç—ã\r\n      console.log('üåÄ –®–ê–ì 3: –ó–∞–ø—É—Å–∫ WebGL —ç—Ñ—Ñ–µ–∫—Ç–æ–≤...');\r\n      await startWebGLEffects();\r\n      console.log('‚úÖ –®–ê–ì 3: WebGL —ç—Ñ—Ñ–µ–∫—Ç—ã –∑–∞–≤–µ—Ä—à–µ–Ω—ã');\r\n      \r\n      // –®–∞–≥ 4: –ü–µ—Ä–µ—Ö–æ–¥ –≤ fullscreen\r\n      console.log('üì± –®–ê–ì 4: –ü–µ—Ä–µ—Ö–æ–¥ –≤ fullscreen...');\r\n      await expandToFullscreen();\r\n      console.log('‚úÖ –®–ê–ì 4: Fullscreen –ø–µ—Ä–µ—Ö–æ–¥ –∑–∞–≤–µ—Ä—à–µ–Ω');\r\n      \r\n      // –®–∞–≥ 5: –ó–∞–≥—Ä—É–∂–∞–µ–º –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–∏—é\r\n      console.log('‚öóÔ∏è –®–ê–ì 5: –ó–∞–≥—Ä—É–∑–∫–∞ –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–∏–∏...');\r\n      loadLaboratory();\r\n      console.log('‚úÖ –£–°–ü–ï–•: –ü–æ—Ä—Ç–∞–ª –ø–æ–ª–Ω–æ—Å—Ç—å—é –æ—Ç–∫—Ä—ã—Ç –∏ –≥–æ—Ç–æ–≤ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é!');\r\n      \r\n      // –ù–ï –≤—ã–∑—ã–≤–∞–µ–º onComplete —Å—Ä–∞–∑—É - —Ç–æ–ª—å–∫–æ –ø—Ä–∏ —Ä–µ–∞–ª—å–Ω–æ–º –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏\r\n    } catch (error) {\r\n      console.error('‚ùå –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –û–®–ò–ë–ö–ê –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ –ø–æ—Ä—Ç–∞–ª–∞:', error);\r\n      console.error('Stack trace:', error.stack);\r\n      // –ù–ï –∑–∞–∫—Ä—ã–≤–∞–µ–º –ø–æ—Ä—Ç–∞–ª –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö - –ø—É—Å—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–∞–º —Ä–µ—à–∞–µ—Ç\r\n      // closePortal();\r\n    }\r\n  }, [\r\n    portalState,\r\n    clickPosition,\r\n    createPortalElement,\r\n    animatePortalAppearance,\r\n    startWebGLEffects,\r\n    expandToFullscreen,\r\n    loadLaboratory,\r\n    closePortal,\r\n    onComplete\r\n  ]);\r\n\r\n  // –≠—Ñ—Ñ–µ–∫—Ç –¥–ª—è –æ—Ç–∫—Ä—ã—Ç–∏—è –ø–æ—Ä—Ç–∞–ª–∞\r\n  useEffect(() => {\r\n    if (isOpen && portalState === 'closed' && clickPosition) {\r\n      console.log('üåÄ –ó–∞–ø—É—Å–∫ –ø–æ—Ä—Ç–∞–ª—å–Ω–æ–π –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏...');\r\n      openPortal();\r\n    }\r\n  }, [isOpen, portalState, openPortal, clickPosition]);\r\n\r\n  // Cleanup —ç—Ñ—Ñ–µ–∫—Ç\r\n  useEffect(() => {\r\n    return () => {\r\n      if (webglRing) {\r\n        webglRing.destroy();\r\n      }\r\n      \r\n      // –û—á–∏—â–∞–µ–º fullscreen —Å–æ—Å—Ç–æ—è–Ω–∏–µ\r\n      if (document.fullscreenElement) {\r\n        document.exitFullscreen().catch(() => {});\r\n      }\r\n      document.body.classList.remove('portal-fullscreen-fallback');\r\n    };\r\n  }, [webglRing]);\r\n\r\n  return (\r\n    <>\r\n      {/* –ü–æ—Ä—Ç–∞–ª—å–Ω—ã–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä */}\r\n      <div \r\n        ref={portalContainerRef}\r\n        className={`advanced-portal-container portal-state-${portalState}`}\r\n        style={{\r\n          position: 'fixed',\r\n          display: 'none',\r\n          zIndex: 9999,\r\n          pointerEvents: portalState === 'laboratory' ? 'auto' : 'none',\r\n          borderRadius: '50%',\r\n          background: 'radial-gradient(circle, rgba(60,47,79,0.9) 0%, rgba(27,38,59,0.6) 70%, rgba(26,60,52,0.3) 100%)',\r\n          boxShadow: '0 0 50px rgba(168,199,250,0.5), inset 0 0 30px rgba(26,60,52,0.8)',\r\n          border: '2px solid rgba(168,199,250,0.3)'\r\n        }}\r\n      >\r\n        {/* WebGL Canvas –¥–ª—è –ø–æ—Ä—Ç–∞–ª—å–Ω–æ–≥–æ –∫–æ–ª—å—Ü–∞ */}\r\n        <canvas\r\n          ref={webglCanvasRef}\r\n          className=\"portal-webgl-canvas\"\r\n          style={{\r\n            position: 'absolute',\r\n            top: 0,\r\n            left: 0,\r\n            width: '100%',\r\n            height: '100%',\r\n            opacity: 0,\r\n            pointerEvents: 'none'\r\n          }}\r\n        />\r\n        \r\n        {/* –ê–ª—Ö–∏–º–∏—á–µ—Å–∫–∞—è –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–∏—è */}\r\n        <div \r\n          ref={laboratororyRef}\r\n          className=\"portal-laboratory\"\r\n          style={{\r\n            position: 'absolute',\r\n            top: 0,\r\n            left: 0,\r\n            width: '100%',\r\n            height: '100%',\r\n            display: 'none',\r\n            opacity: 0\r\n          }}\r\n        >\r\n          {portalState === 'laboratory' && (\r\n            <AlchemyLab\r\n              onClose={() => {\r\n                console.log('üö™ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–∫—Ä—ã–ª –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–∏—é');\r\n                closePortal();\r\n              }}\r\n              onBrew={(reward) => {\r\n                console.log('–ó–µ–ª—å–µ –≥–æ—Ç–æ–≤–æ! –ù–∞–≥—Ä–∞–¥–∞:', reward);\r\n                if (onComplete) onComplete({ type: 'brew', reward });\r\n              }}\r\n              onAddPotion={(potion) => {\r\n                console.log('–î–æ–±–∞–≤–ª–µ–Ω–æ –∑–µ–ª—å–µ:', potion);\r\n                if (onComplete) onComplete({ type: 'potion', potion });\r\n              }}\r\n              energyReward={0.12} // –ü–æ–≤—ã—à–µ–Ω–Ω–∞—è –Ω–∞–≥—Ä–∞–¥–∞ –∑–∞ –ø–æ—Ä—Ç–∞–ª—å–Ω—É—é –∞–ª—Ö–∏–º–∏—é\r\n            />\r\n          )}\r\n        </div>\r\n        \r\n        {/* –≠—Ñ—Ñ–µ–∫—Ç—ã —á–∞—Å—Ç–∏—Ü –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ */}\r\n        {portalState === 'opening' && (\r\n          <div className=\"portal-opening-particles\">\r\n            {[...Array(20)].map((_, i) => (\r\n              <div\r\n                key={i}\r\n                className=\"portal-particle\"\r\n                style={{\r\n                  position: 'absolute',\r\n                  width: '4px',\r\n                  height: '4px',\r\n                  background: i % 2 === 0 ? '#A8C7FA' : '#FFD700',\r\n                  borderRadius: '50%',\r\n                  animation: `portalParticle${i % 4} 1.5s ease-out forwards`,\r\n                  left: '50%',\r\n                  top: '50%',\r\n                  boxShadow: '0 0 10px currentColor'\r\n                }}\r\n              />\r\n            ))}\r\n          </div>\r\n        )}\r\n        \r\n        {/* –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –º–∞–≥–∏—á–µ—Å–∫–∏–µ —ç—Ñ—Ñ–µ–∫—Ç—ã */}\r\n        {(portalState === 'webgl' || portalState === 'expanding') && (\r\n          <div className=\"portal-magic-effects\">\r\n            <div className=\"portal-runes\">\r\n              {['‚ú¶', '‚òΩ', '‚öù', '‚öú', '‚òæ', '‚úß', '‚öπ', '‚ô±'].map((rune, i) => (\r\n                <div\r\n                  key={i}\r\n                  className=\"portal-rune\"\r\n                  style={{\r\n                    position: 'absolute',\r\n                    color: '#A8C7FA',\r\n                    fontSize: '18px',\r\n                    textShadow: '0 0 10px currentColor',\r\n                    animation: `portalRune 3s linear infinite`,\r\n                    animationDelay: `${i * 0.375}s`,\r\n                    transformOrigin: 'center',\r\n                    left: '50%',\r\n                    top: '50%',\r\n                    transform: `\r\n                      translate(-50%, -50%) \r\n                      rotate(${i * 45}deg) \r\n                      translateY(-${isMobile ? '60px' : '80px'})`\r\n                  }}\r\n                >\r\n                  {rune}\r\n                </div>\r\n              ))}\r\n            </div>\r\n          </div>\r\n        )}\r\n      </div>\r\n      \r\n      {children}\r\n    </>\r\n  );\r\n};\r\n\r\nexport default AdvancedPortalManager;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}