{"ast":null,"code":"import _objectSpread from \"/var/www/www-root/data/www/knigavl.ru/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";\nimport _objectWithoutProperties from \"/var/www/www-root/data/www/knigavl.ru/node_modules/@babel/runtime/helpers/esm/objectWithoutProperties.js\";\nconst _excluded = [\"selection\", \"selectionLayer\", \"lights\", \"inverted\", \"ignoreBackground\", \"luminanceThreshold\", \"luminanceSmoothing\", \"intensity\", \"width\", \"height\", \"kernelSize\", \"mipmapBlur\"];\nimport { jsx } from \"react/jsx-runtime\";\nimport { SelectiveBloomEffect, BlendFunction } from \"postprocessing\";\nimport { forwardRef, useContext, useMemo, useEffect } from \"react\";\nimport { useThree } from \"@react-three/fiber\";\nimport { EffectComposerContext } from \"../EffectComposer.js\";\nimport { selectionContext } from \"../Selection.js\";\nimport { resolveRef } from \"../util.js\";\nconst addLight = (light, effect) => light.layers.enable(effect.selection.layer);\nconst removeLight = (light, effect) => light.layers.disable(effect.selection.layer);\nconst SelectiveBloom = forwardRef(function SelectiveBloom2(_ref, forwardRef2) {\n  let {\n      selection = [],\n      selectionLayer = 10,\n      lights = [],\n      inverted = false,\n      ignoreBackground = false,\n      luminanceThreshold,\n      luminanceSmoothing,\n      intensity,\n      width,\n      height,\n      kernelSize,\n      mipmapBlur\n    } = _ref,\n    props = _objectWithoutProperties(_ref, _excluded);\n  if (lights.length === 0) {\n    console.warn(\"SelectiveBloom requires lights to work.\");\n  }\n  const invalidate = useThree(state => state.invalidate);\n  const {\n    scene,\n    camera\n  } = useContext(EffectComposerContext);\n  const effect = useMemo(() => {\n    const effect2 = new SelectiveBloomEffect(scene, camera, _objectSpread({\n      blendFunction: BlendFunction.ADD,\n      luminanceThreshold,\n      luminanceSmoothing,\n      intensity,\n      width,\n      height,\n      kernelSize,\n      mipmapBlur\n    }, props));\n    effect2.inverted = inverted;\n    effect2.ignoreBackground = ignoreBackground;\n    return effect2;\n  }, [scene, camera, luminanceThreshold, luminanceSmoothing, intensity, width, height, kernelSize, mipmapBlur, inverted, ignoreBackground, props]);\n  const api = useContext(selectionContext);\n  useEffect(() => {\n    if (!api && selection) {\n      effect.selection.set(Array.isArray(selection) ? selection.map(resolveRef) : [resolveRef(selection)]);\n      invalidate();\n      return () => {\n        effect.selection.clear();\n        invalidate();\n      };\n    }\n  }, [effect, selection, api, invalidate]);\n  useEffect(() => {\n    effect.selection.layer = selectionLayer;\n    invalidate();\n  }, [effect, invalidate, selectionLayer]);\n  useEffect(() => {\n    if (lights && lights.length > 0) {\n      lights.forEach(light => addLight(resolveRef(light), effect));\n      invalidate();\n      return () => {\n        lights.forEach(light => removeLight(resolveRef(light), effect));\n        invalidate();\n      };\n    }\n  }, [effect, invalidate, lights, selectionLayer]);\n  useEffect(() => {\n    var _a;\n    if (api && api.enabled) {\n      if ((_a = api.selected) == null ? void 0 : _a.length) {\n        effect.selection.set(api.selected);\n        invalidate();\n        return () => {\n          effect.selection.clear();\n          invalidate();\n        };\n      }\n    }\n  }, [api, effect.selection, invalidate]);\n  return /* @__PURE__ */jsx(\"primitive\", {\n    ref: forwardRef2,\n    object: effect,\n    dispose: null\n  });\n});\nexport { SelectiveBloom };","map":{"version":3,"names":["addLight","light","effect","layers","enable","selection","layer","removeLight","disable","SelectiveBloom","forwardRef","SelectiveBloom2","_ref","forwardRef2","selectionLayer","lights","inverted","ignoreBackground","luminanceThreshold","luminanceSmoothing","intensity","width","height","kernelSize","mipmapBlur","props","_objectWithoutProperties","_excluded","length","console","warn","invalidate","useThree","state","scene","camera","useContext","EffectComposerContext","useMemo","effect2","SelectiveBloomEffect","_objectSpread","blendFunction","BlendFunction","ADD","api","selectionContext","useEffect","set","Array","isArray","map","resolveRef","clear","forEach","enabled","_a","selected","jsx","ref","object","dispose"],"sources":["/var/www/www-root/data/www/knigavl.ru/node_modules/@react-three/postprocessing/src/effects/SelectiveBloom.tsx"],"sourcesContent":["import { SelectiveBloomEffect, BlendFunction } from 'postprocessing'\nimport type { BloomEffectOptions } from 'postprocessing'\nimport React, { Ref, MutableRefObject, forwardRef, useMemo, useEffect, useContext, useRef } from 'react'\nimport { Object3D } from 'three'\nimport { useThree } from '@react-three/fiber'\nimport { EffectComposerContext } from '../EffectComposer'\nimport { selectionContext } from '../Selection'\nimport { resolveRef } from '../util'\n\ntype ObjectRef = MutableRefObject<Object3D>\n\nexport type SelectiveBloomProps = BloomEffectOptions &\n  Partial<{\n    lights: Object3D[] | ObjectRef[]\n    selection: Object3D | Object3D[] | ObjectRef | ObjectRef[]\n    selectionLayer: number\n    inverted: boolean\n    ignoreBackground: boolean\n  }>\n\nconst addLight = (light: Object3D, effect: SelectiveBloomEffect) => light.layers.enable(effect.selection.layer)\nconst removeLight = (light: Object3D, effect: SelectiveBloomEffect) => light.layers.disable(effect.selection.layer)\n\nexport const SelectiveBloom = forwardRef(function SelectiveBloom(\n  {\n    selection = [],\n    selectionLayer = 10,\n    lights = [],\n    inverted = false,\n    ignoreBackground = false,\n    luminanceThreshold,\n    luminanceSmoothing,\n    intensity,\n    width,\n    height,\n    kernelSize,\n    mipmapBlur,\n\n    ...props\n  }: SelectiveBloomProps,\n  forwardRef: Ref<SelectiveBloomEffect>\n) {\n  if (lights.length === 0) {\n    console.warn('SelectiveBloom requires lights to work.')\n  }\n\n  const invalidate = useThree((state) => state.invalidate)\n  const { scene, camera } = useContext(EffectComposerContext)\n  const effect = useMemo(() => {\n    const effect = new SelectiveBloomEffect(scene, camera, {\n      blendFunction: BlendFunction.ADD,\n      luminanceThreshold,\n      luminanceSmoothing,\n      intensity,\n      width,\n      height,\n      kernelSize,\n      mipmapBlur,\n      ...props,\n    })\n    effect.inverted = inverted\n    effect.ignoreBackground = ignoreBackground\n    return effect\n  }, [\n    scene,\n    camera,\n    luminanceThreshold,\n    luminanceSmoothing,\n    intensity,\n    width,\n    height,\n    kernelSize,\n    mipmapBlur,\n    inverted,\n    ignoreBackground,\n    props,\n  ])\n\n  const api = useContext(selectionContext)\n\n  useEffect(() => {\n    // Do not allow array selection if declarative selection is active\n    // TODO: array selection should probably be deprecated altogether\n    if (!api && selection) {\n      effect.selection.set(\n        Array.isArray(selection) ? (selection as Object3D[]).map(resolveRef) : [resolveRef(selection) as Object3D]\n      )\n      invalidate()\n      return () => {\n        effect.selection.clear()\n        invalidate()\n      }\n    }\n  }, [effect, selection, api, invalidate])\n\n  useEffect(() => {\n    effect.selection.layer = selectionLayer\n    invalidate()\n  }, [effect, invalidate, selectionLayer])\n\n  useEffect(() => {\n    if (lights && lights.length > 0) {\n      lights.forEach((light) => addLight(resolveRef(light), effect))\n      invalidate()\n      return () => {\n        lights.forEach((light) => removeLight(resolveRef(light), effect))\n        invalidate()\n      }\n    }\n  }, [effect, invalidate, lights, selectionLayer])\n\n  useEffect(() => {\n    if (api && api.enabled) {\n      if (api.selected?.length) {\n        effect.selection.set(api.selected)\n        invalidate()\n        return () => {\n          effect.selection.clear()\n          invalidate()\n        }\n      }\n    }\n  }, [api, effect.selection, invalidate])\n\n  return <primitive ref={forwardRef} object={effect} dispose={null} />\n})\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}