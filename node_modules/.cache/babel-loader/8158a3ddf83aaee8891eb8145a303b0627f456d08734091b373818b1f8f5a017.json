{"ast":null,"code":"import React,{useEffect,useRef,useState,useCallback}from'react';import*as Tone from'tone';import{PerformanceUtils}from'./PerformanceMonitor';/**\r\n * GothicMusicGenerator - –ö–æ–º–ø–æ–Ω–µ–Ω—Ç –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –≥–æ—Ç–∏—á–µ—Å–∫–æ–π –º—É–∑—ã–∫–∏ –∫–æ–¥–æ–º\r\n * –°–æ–∑–¥–∞–µ—Ç –∞—Ç–º–æ—Å—Ñ–µ—Ä–Ω—É—é –≥–æ—Ç–∏—á–µ—Å–∫—É—é –º—É–∑—ã–∫—É —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º Tone.js\r\n */// Error boundary component to catch audio errors\nimport{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";class AudioErrorBoundary extends React.Component{constructor(props){super(props);this.state={hasError:false,error:null};}static getDerivedStateFromError(error){return{hasError:true,error};}componentDidCatch(error,errorInfo){console.error('Audio system error:',error,errorInfo);}render(){if(this.state.hasError){return/*#__PURE__*/_jsxs(\"div\",{className:\"audio-error\",style:{padding:'10px',color:'#E8D5B7'},children:[/*#__PURE__*/_jsx(\"p\",{children:\"\\uD83C\\uDFB5 Audio temporarily unavailable\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>this.setState({hasError:false,error:null}),children:\"Try Again\"})]});}return this.props.children;}}class GothicMusicSystem{constructor(){this.isPlaying=false;this.currentComposition=null;this.currentStyle=null;this.instruments={};this.effects={};this.isInitialized=false;this.initError=null;this.activePatterns=[];this.audioContext=null;this.isLowPerformanceMode=this.detectLowPerformance();try{this.masterVolume=new Tone.Volume(-12).toDestination();// –ì–æ—Ç–∏—á–µ—Å–∫–∏–µ —Ç–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏ (–º–∏–Ω–æ—Ä–Ω—ã–µ –≥–∞–º–º—ã)\nthis.gothicScales={darkMinor:['C3','D3','Eb3','F3','G3','Ab3','Bb3','C4'],harmonic:['A2','B2','C3','D3','E3','F3','G#3','A3'],dorian:['D3','E3','F3','G3','A3','B3','C4','D4'],phrygian:['E3','F3','G3','A3','B3','C4','D4','E4']};this.initializeInstruments();this.isInitialized=true;}catch(error){console.error('Failed to initialize Gothic Music System:',error);this.initError=error;this.isInitialized=false;}}detectLowPerformance(){// Simple performance detection\nconst canvas=document.createElement('canvas');const gl=canvas.getContext('webgl')||canvas.getContext('experimental-webgl');if(!gl)return true;// No WebGL = low performance\nconst renderer=gl.getParameter(gl.RENDERER);const vendor=gl.getParameter(gl.VENDOR);// Check for mobile or low-end devices\nif(/mobile|android|iphone|ipad/i.test(navigator.userAgent)){return true;}// Check available memory (if supported)\nif(navigator.deviceMemory&&navigator.deviceMemory<4){return true;}return false;}initializeInstruments(){try{// Reduce polyphony for low-performance devices\nconst maxPolyphony=this.isLowPerformanceMode?4:8;const effectsWet=this.isLowPerformanceMode?0.2:0.6;// –ì–ª–∞–≤–Ω—ã–π —Å–∏–Ω—Ç–µ–∑–∞—Ç–æ—Ä –¥–ª—è –º–µ–ª–æ–¥–∏–∏ (–æ—Ä–≥–∞–Ω-—Å—Ç–∞–π–ª)\nthis.instruments.lead=new Tone.PolySynth({maxPolyphony:maxPolyphony,voice:Tone.Synth,options:{oscillator:{type:'sawtooth'},envelope:{attack:0.3,decay:0.1,sustain:0.8,release:2.0},filter:{frequency:800,type:'lowpass'}}});// –ë–∞—Å–æ–≤—ã–π —Å–∏–Ω—Ç–µ–∑–∞—Ç–æ—Ä\nthis.instruments.bass=new Tone.MonoSynth({oscillator:{type:'triangle'},envelope:{attack:0.1,decay:0.3,sustain:0.5,release:1.5},filter:{frequency:300,type:'lowpass'}});// –ê—Ç–º–æ—Å—Ñ–µ—Ä–Ω—ã–µ –ø–∞–¥—ã (reduced polyphony)\nthis.instruments.pad=new Tone.PolySynth({maxPolyphony:Math.max(2,maxPolyphony/2),voice:Tone.Synth,options:{oscillator:{type:'sine'},envelope:{attack:2.0,decay:1.0,sustain:0.9,release:4.0}}});// –£–¥–∞—Ä–Ω—ã–µ (–≥–æ—Ç–∏—á–µ—Å–∫–∏–π —Å—Ç–∏–ª—å)\nthis.instruments.drums=new Tone.MembraneSynth({envelope:{attack:0.02,decay:0.3,sustain:0.1,release:1.2}});// –≠—Ñ—Ñ–µ–∫—Ç—ã (reduced for performance)\nif(!this.isLowPerformanceMode){this.effects.reverb=new Tone.Reverb({decay:4,wet:effectsWet});this.effects.delay=new Tone.PingPongDelay({delayTime:'8n',feedback:0.3,wet:0.3});this.effects.chorus=new Tone.Chorus({frequency:0.5,delayTime:8,depth:0.4,wet:0.3});this.effects.distortion=new Tone.Distortion({distortion:0.1,wet:0.2});// –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —ç—Ñ—Ñ–µ–∫—Ç–æ–≤\nthis.instruments.lead.connect(this.effects.reverb);this.effects.reverb.connect(this.effects.delay);this.effects.delay.connect(this.masterVolume);this.instruments.bass.connect(this.effects.distortion);this.effects.distortion.connect(this.masterVolume);this.instruments.pad.connect(this.effects.chorus);this.effects.chorus.connect(this.effects.reverb);}else{// Low performance mode - direct connections\nthis.instruments.lead.connect(this.masterVolume);this.instruments.bass.connect(this.masterVolume);this.instruments.pad.connect(this.masterVolume);}this.instruments.drums.connect(this.masterVolume);}catch(error){console.error('Failed to initialize instruments:',error);throw error;}}// –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –≥–æ—Ç–∏—á–µ—Å–∫–æ–π –º–µ–ª–æ–¥–∏–∏ (optimized)\ngenerateGothicMelody(){let scale=arguments.length>0&&arguments[0]!==undefined?arguments[0]:'darkMinor';let length=arguments.length>1&&arguments[1]!==undefined?arguments[1]:16;// Reduce length for low performance devices\nconst actualLength=this.isLowPerformanceMode?Math.min(length,8):length;const scaleNotes=this.gothicScales[scale];const melody=[];// –ì–æ—Ç–∏—á–µ—Å–∫–∏–µ –∏–Ω—Ç–µ—Ä–≤–∞–ª—ã (–ø—Ä–µ–¥–ø–æ—á–∏—Ç–∞–µ–º –º–∏–Ω–æ—Ä–Ω—ã–µ —Ç–µ—Ä—Ü–∏–∏, –∫–≤–∞—Ä—Ç—ã, –∫–≤–∏–Ω—Ç—ã)\nconst gothicIntervals=[-7,-5,-3,-2,0,2,3,5,7];let currentNoteIndex=0;for(let i=0;i<actualLength;i++){// Higher chance of pauses in low performance mode\nconst noteChance=this.isLowPerformanceMode?0.6:0.8;if(Math.random()<noteChance){const interval=gothicIntervals[Math.floor(Math.random()*gothicIntervals.length)];currentNoteIndex=Math.max(0,Math.min(scaleNotes.length-1,currentNoteIndex+interval));melody.push({note:scaleNotes[currentNoteIndex],duration:this.getGothicNoteDuration(),velocity:Math.random()*0.3+0.4// 0.4 - 0.7\n});}else{melody.push({note:null,duration:'8n'});// –ü–∞—É–∑–∞\n}}return melody;}getGothicNoteDuration(){const durations=['4n','4n','8n','8n','2n','8n.'];return durations[Math.floor(Math.random()*durations.length)];}// –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –±–∞—Å–æ–≤–æ–π –ª–∏–Ω–∏–∏\ngenerateBassLine(){let scale=arguments.length>0&&arguments[0]!==undefined?arguments[0]:'darkMinor';let length=arguments.length>1&&arguments[1]!==undefined?arguments[1]:8;const scaleNotes=this.gothicScales[scale].map(note=>note.replace(/\\d/,num=>String(parseInt(num)-1)));const bassLine=[];const bassPattern=[0,0,4,4,2,2,6,0];// –ì–æ—Ç–∏—á–µ—Å–∫–∏–π –±–∞—Å–æ–≤—ã–π –ø–∞—Ç—Ç–µ—Ä–Ω\nfor(let i=0;i<length;i++){const noteIndex=bassPattern[i%bassPattern.length];bassLine.push({note:scaleNotes[noteIndex],duration:'4n',velocity:0.8});}return bassLine;}// –°–æ–∑–¥–∞–Ω–∏–µ –∞—Ç–º–æ—Å—Ñ–µ—Ä–Ω—ã—Ö –ø–∞–¥–æ–≤\ngenerateAtmosphericPads(){let scale=arguments.length>0&&arguments[0]!==undefined?arguments[0]:'darkMinor';const scaleNotes=this.gothicScales[scale];const chords=[[scaleNotes[0],scaleNotes[2],scaleNotes[4]],// i\n[scaleNotes[1],scaleNotes[3],scaleNotes[5]],// ii¬∞\n[scaleNotes[2],scaleNotes[4],scaleNotes[6]],// III\n[scaleNotes[3],scaleNotes[5],scaleNotes[0]],// iv\n[scaleNotes[4],scaleNotes[6],scaleNotes[1]],// v\n[scaleNotes[5],scaleNotes[0],scaleNotes[2]],// VI\n[scaleNotes[6],scaleNotes[1],scaleNotes[3]]// VII\n];return chords;}// –ì–æ—Ç–∏—á–µ—Å–∫–∏–π —Ä–∏—Ç–º-–ø–∞—Ç—Ç–µ—Ä–Ω\ngenerateDrumPattern(){return[{time:'0:0:0',note:'C2',velocity:0.9},{time:'0:1:0',note:'C2',velocity:0.3},{time:'0:2:0',note:'C2',velocity:0.7},{time:'0:3:2',note:'C2',velocity:0.4}];}async startComposition(){let type=arguments.length>0&&arguments[0]!==undefined?arguments[0]:'ambient';if(this.isPlaying)return;// Check if system is properly initialized\nif(!this.isInitialized||this.initError){console.error('Cannot start composition: system not initialized',this.initError);return false;}try{await Tone.start();this.isPlaying=true;this.activePatterns=[];this.currentStyle=type;if(type==='ambient'){this.playAmbientGothic();}else if(type==='rhythmic'){this.playRhythmicGothic();}else if(type==='dark'){this.playDarkAtmosphere();}else if(type==='cathedral'){this.playCathedralOrgan();}else if(type==='ritual'){this.playRitualPercussion();}return true;}catch(error){console.error('Failed to start composition:',error);this.isPlaying=false;return false;}}playAmbientGothic(){const scale='harmonic';const melodyLength=this.isLowPerformanceMode?16:32;const melody=this.generateGothicMelody(scale,melodyLength);const chords=this.generateAtmosphericPads(scale);// Store active patterns for transitions\nthis.activePatterns=[];// –ò–≥—Ä–∞–µ–º –º–µ–ª–æ–¥–∏—é\nlet melodyTime=0;melody.forEach((note,index)=>{if(note.note){Tone.Transport.schedule(time=>{this.instruments.lead.triggerAttackRelease(note.note,note.duration,time,note.velocity);},melodyTime);}melodyTime+=Tone.Time(note.duration).toSeconds();});// –ò–≥—Ä–∞–µ–º –∞—Ç–º–æ—Å—Ñ–µ—Ä–Ω—ã–µ –∞–∫–∫–æ—Ä–¥—ã (less frequent on low-end devices)\nconst chordInterval=this.isLowPerformanceMode?8:4;chords.forEach((chord,index)=>{const time=index*chordInterval;Tone.Transport.schedule(scheduleTime=>{this.instruments.pad.triggerAttackRelease(chord,'1m',scheduleTime,0.3);},time);});// Add background ambience (only on high-performance devices)\nif(!this.isLowPerformanceMode){const ambienceLoop=new Tone.Loop(time=>{if(Math.random()<0.3){const note=this.gothicScales[scale][Math.floor(Math.random()*this.gothicScales[scale].length)];this.instruments.pad.triggerAttackRelease(Tone.Frequency(note).transpose(12),'4n',time,0.1);}},'2m').start(0);this.activePatterns.push(ambienceLoop);}if(Tone.Transport.state!=='started'){Tone.Transport.start();}}playRhythmicGothic(){const scale='dorian';const melody=this.generateGothicMelody(scale,16);const bassLine=this.generateBassLine(scale,16);const drumPattern=this.generateDrumPattern();// Store active patterns for transitions\nthis.activePatterns=[];// –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ª—É–ø–æ–≤\nconst melodyLoop=new Tone.Sequence((time,note)=>{if(note&&note.note){this.instruments.lead.triggerAttackRelease(note.note,note.duration,time,note.velocity);}},melody,'8n').start(0);const bassLoop=new Tone.Sequence((time,note)=>{this.instruments.bass.triggerAttackRelease(note.note,note.duration,time,note.velocity);},bassLine,'4n').start(0);const drumLoop=new Tone.Sequence((time,drum)=>{this.instruments.drums.triggerAttackRelease(drum.note,'8n',time,drum.velocity);},drumPattern,'4n').start(0);this.activePatterns.push(melodyLoop,bassLoop,drumLoop);if(Tone.Transport.state!=='started'){Tone.Transport.start();}}playDarkAtmosphere(){const scale='phrygian';const lowNotes=this.gothicScales[scale].map(note=>note.replace(/\\d/,'1'));// Store active patterns for transitions\nthis.activePatterns=[];// –û—á–µ–Ω—å –º–µ–¥–ª–µ–Ω–Ω–∞—è, –∂—É—Ç–∫–∞—è –∞—Ç–º–æ—Å—Ñ–µ—Ä–∞\nlowNotes.forEach((note,index)=>{Tone.Transport.schedule(time=>{this.instruments.pad.triggerAttackRelease([note,Tone.Frequency(note).transpose(3),Tone.Frequency(note).transpose(7)],'2m',time,0.2);// –î–æ–±–∞–≤–ª—è–µ–º —Å–ª—É—á–∞–π–Ω—ã–µ –≤—ã—Å–æ–∫–∏–µ –Ω–æ—Ç—ã –¥–ª—è –∂—É—Ç–∫–æ—Å—Ç–∏\nif(Math.random()<0.3){this.instruments.lead.triggerAttackRelease(Tone.Frequency(note).transpose(24),'1n',time+Math.random()*4,0.1);}},index*8);});// Add creepy background noises\nconst creepyLoop=new Tone.Loop(time=>{if(Math.random()<0.15){const noteIndex=Math.floor(Math.random()*lowNotes.length);const note=lowNotes[noteIndex];const transpose=Math.random()<0.5?36:24;this.instruments.lead.triggerAttackRelease(Tone.Frequency(note).transpose(transpose),'16n',time,0.05);}},'4m').start(0);this.activePatterns.push(creepyLoop);if(Tone.Transport.state!=='started'){Tone.Transport.start();}}playCathedralOrgan(){const scale='harmonic';const chords=this.generateAtmosphericPads(scale);// Store active patterns for transitions\nthis.activePatterns=[];// Create a cathedral organ pattern\nconst organLoop=new Tone.Loop(time=>{// Choose a random chord\nconst chord=chords[Math.floor(Math.random()*chords.length)];// Play deep organ sound\nthis.instruments.pad.set({oscillator:{type:'sine'},envelope:{attack:0.1,release:4.0}});// Play a cathedral-style progression\nthis.instruments.pad.triggerAttackRelease(chord,'2n',time,0.2);// Add high register for pipe organ effect\nconst highNote=chord[Math.floor(Math.random()*chord.length)];setTimeout(()=>{this.instruments.lead.triggerAttackRelease(Tone.Frequency(highNote).transpose(12),'2n',time+0.1,0.1);},50);// Add bass note\nconst bassNote=chord[0].replace(/\\d/,num=>String(parseInt(num)-1));this.instruments.bass.triggerAttackRelease(bassNote,'1n',time,0.3);},'2m').start(0);// Add cathedral bell sounds occasionally\nconst bellLoop=new Tone.Loop(time=>{if(Math.random()<0.3){const scaleNotes=this.gothicScales[scale];const note=scaleNotes[Math.floor(Math.random()*scaleNotes.length)];// Create bell sound\nthis.instruments.lead.set({oscillator:{type:'sine'},envelope:{attack:0.01,decay:3.0,sustain:0,release:5.0}});// Play bell\nthis.instruments.lead.triggerAttackRelease(Tone.Frequency(note).transpose(24),'8n',time,0.2);}},'4m').start(0);this.activePatterns.push(organLoop,bellLoop);if(Tone.Transport.state!=='started'){Tone.Transport.start();}}playRitualPercussion(){const scale='phrygian';// Store active patterns for transitions\nthis.activePatterns=[];// Create ritual drum pattern\nconst drumPattern=[{time:'0:0:0',note:'C2',velocity:0.9},{time:'0:0:3',note:'C2',velocity:0.5},{time:'0:1:0',note:'G1',velocity:0.7},{time:'0:2:0',note:'C2',velocity:0.9},{time:'0:3:0',note:'G1',velocity:0.7},{time:'0:3:3',note:'C2',velocity:0.5}];// Create ritual chant pattern\nconst chantNotes=this.gothicScales[scale].slice(0,3);// Use first 3 notes\n// Slow tribal drums\nconst drumLoop=new Tone.Sequence((time,drum)=>{this.instruments.drums.triggerAttackRelease(drum.note,'8n',time,drum.velocity);},drumPattern,'4n').start(0);// Ritual chanting\nconst chantLoop=new Tone.Loop(time=>{// Set pad to vocal-like sound\nthis.instruments.pad.set({oscillator:{type:'triangle'},envelope:{attack:0.3,release:2.0}});// Play chant chord\nconst chordNotes=[chantNotes[Math.floor(Math.random()*chantNotes.length)],chantNotes[Math.floor(Math.random()*chantNotes.length)]];this.instruments.pad.triggerAttackRelease(chordNotes,'2n',time,0.15);},'2m').start(0);// Occasional ritual sounds\nconst ritualLoop=new Tone.Loop(time=>{if(Math.random()<0.2){// Create shaker/rattle sound\nconst note='A5';this.instruments.lead.triggerAttackRelease(note,'16n',time,0.1);}},'8n').start(0);this.activePatterns.push(drumLoop,chantLoop,ritualLoop);if(Tone.Transport.state!=='started'){Tone.Transport.start();}}stop(){this.isPlaying=false;// Stop all active patterns\nif(this.activePatterns&&this.activePatterns.length>0){this.activePatterns.forEach(pattern=>{if(pattern&&typeof pattern.stop==='function'){pattern.stop();}});this.activePatterns=[];}// Release all notes that might be playing\nObject.values(this.instruments).forEach(instrument=>{if(instrument&&typeof instrument.releaseAll==='function'){instrument.releaseAll();}});// Stop and cancel all scheduled events\nTone.Transport.stop();Tone.Transport.cancel();// Clear Tone.js internal state\nTone.context.rawContext.resume();}setVolume(volume){this.masterVolume.volume.value=Tone.gainToDb(volume);}async transitionToStyle(newStyle){// If not currently playing, just update the style\nif(!this.isPlaying)return;// If already playing this style, do nothing\nif(this.currentStyle===newStyle)return;// Prepare crossfade\nconst currentVolume=Tone.gainToDb(this.masterVolume.volume.value);// Gradually lower the volume\nawait Tone.Destination.volume.rampTo(currentVolume-20,0.5);// Stop the current patterns but don't reset Transport\nif(this.activePatterns){this.activePatterns.forEach(pattern=>pattern.stop());}// Clear scheduled events without stopping transport\nTone.Transport.cancel();// Update current style\nthis.currentStyle=newStyle;// Start the new style\nif(newStyle==='ambient'){this.playAmbientGothic();}else if(newStyle==='rhythmic'){this.playRhythmicGothic();}else if(newStyle==='dark'){this.playDarkAtmosphere();}else if(newStyle==='cathedral'){this.playCathedralOrgan();}else if(newStyle==='ritual'){this.playRitualPercussion();}// Gradually restore volume\nawait Tone.Destination.volume.rampTo(currentVolume,0.8);}dispose(){this.stop();Object.values(this.instruments).forEach(instrument=>instrument.dispose());Object.values(this.effects).forEach(effect=>effect.dispose());this.masterVolume.dispose();}}const GothicMusicGenerator=/*#__PURE__*/React.memo(_ref=>{let{isPlaying,volume=0.3,style='ambient',seed=null}=_ref;const musicSystemRef=useRef(null);const[currentStyle,setCurrentStyle]=useState(style);const[isLoading,setIsLoading]=useState(false);const[hasError,setHasError]=useState(false);const[isLagging,setIsLagging]=useState(false);// Detect performance issues\nconst performanceTier=PerformanceUtils.getDevicePerformanceTier();const prefersReducedMotion=PerformanceUtils.prefersReducedMotion();// Simple FPS monitoring for this component\nconst frameCountRef=useRef(0);const lastTimeRef=useRef(performance.now());useEffect(()=>{const checkPerformance=()=>{const currentTime=performance.now();const delta=currentTime-lastTimeRef.current;if(delta>=2000){// Check every 2 seconds\nconst fps=frameCountRef.current*1000/delta;setIsLagging(fps<20);// Consider lagging if below 20 FPS\nframeCountRef.current=0;lastTimeRef.current=currentTime;}frameCountRef.current++;};const interval=setInterval(checkPerformance,100);return()=>clearInterval(interval);},[]);// Initialize the music system with better cleanup\nuseEffect(()=>{let isMounted=true;// Optimized initialization\nconst initSystem=async()=>{try{if(!musicSystemRef.current&&isMounted){// Check if audio context is available\nif(typeof AudioContext==='undefined'&&typeof webkitAudioContext==='undefined'){console.warn('Web Audio API not supported');setHasError(true);return;}// Wait for audio context to fully initialize\nawait Tone.start();if(isMounted){musicSystemRef.current=new GothicMusicSystem();// Check if initialization was successful\nif(!musicSystemRef.current.isInitialized){throw new Error('Failed to initialize music system');}setHasError(false);}}}catch(error){console.error('Error initializing audio system:',error);setHasError(true);if(musicSystemRef.current){try{musicSystemRef.current.dispose();}catch(e){console.error('Error disposing failed music system:',e);}musicSystemRef.current=null;}}};initSystem();// Thorough cleanup\nreturn()=>{isMounted=false;if(musicSystemRef.current){try{// Make sure all audio is properly stopped\nmusicSystemRef.current.dispose();musicSystemRef.current=null;}catch(err){console.error('Cleanup error:',err);}}};},[]);// Volume control with debouncing (increased debounce time for performance)\nuseEffect(()=>{if(musicSystemRef.current&&musicSystemRef.current.isInitialized){const volumeTimeout=setTimeout(()=>{try{musicSystemRef.current.setVolume(volume);}catch(error){console.error('Error setting volume:',error);}},100);// Increased debounce time\nreturn()=>clearTimeout(volumeTimeout);}},[volume]);useEffect(()=>{// Optimized playback handler with error handling\nconst handlePlayback=async()=>{if(!musicSystemRef.current||hasError)return;try{if(isPlaying){setIsLoading(true);// Check if system is properly initialized\nif(!musicSystemRef.current.isInitialized){console.warn('Music system not initialized, skipping playback');setIsLoading(false);return;}// Throttle resource-intensive operations\nawait new Promise(resolve=>setTimeout(resolve,10));if(musicSystemRef.current.isPlaying&&currentStyle!==musicSystemRef.current.currentStyle){// Transition between styles when already playing\nawait musicSystemRef.current.transitionToStyle(currentStyle);}else if(!musicSystemRef.current.isPlaying){// Start from scratch\n// Apply seed by nudging Math.random via a simple PRNG if provided\nif(seed!==null&&typeof seed==='number'){let s=seed>>>0;const rand=()=>(s=s*1664525+1013904223>>>0)/4294967296;const origRandom=Math.random;Math.random=rand;const success=await musicSystemRef.current.startComposition(currentStyle);Math.random=origRandom;if(!success){console.warn('Failed to start music composition');setHasError(true);}}else{const success=await musicSystemRef.current.startComposition(currentStyle);if(!success){console.warn('Failed to start music composition');setHasError(true);}}}}else if(musicSystemRef.current&&musicSystemRef.current.isPlaying){// Stop when toggled off\nmusicSystemRef.current.stop();}}catch(error){console.error('Music playback error:',error);setHasError(true);}finally{setIsLoading(false);}};// Debounce to prevent excessive audio context changes (increased time for performance)\nconst timeoutId=setTimeout(handlePlayback,isLagging?200:100);return()=>clearTimeout(timeoutId);},[isPlaying,currentStyle,hasError,seed]);// Memoized style change handler to prevent recreating on every render\nconst handleStyleChange=useCallback(async newStyle=>{if(musicSystemRef.current){// Instead of stopping completely, we'll transition to the new style\ntry{await musicSystemRef.current.transitionToStyle(newStyle);setCurrentStyle(newStyle);}catch(error){console.error('Error transitioning to new style:',error);// Fallback to old behavior if transition fails\nmusicSystemRef.current.stop();setCurrentStyle(newStyle);if(isPlaying){setTimeout(()=>{musicSystemRef.current.startComposition(newStyle);},100);}}}else{setCurrentStyle(newStyle);}},[isPlaying]);return/*#__PURE__*/_jsx(AudioErrorBoundary,{children:/*#__PURE__*/_jsxs(\"div\",{className:\"gothic-music-generator \".concat(isPlaying?'playing':''),children:[hasError&&/*#__PURE__*/_jsxs(\"div\",{className:\"music-error\",style:{padding:'10px',color:'#E8D5B7',background:'rgba(139, 69, 19, 0.2)',borderRadius:'8px',marginBottom:'10px',textAlign:'center'},children:[/*#__PURE__*/_jsx(\"p\",{children:\"\\uD83C\\uDFB5 \\u041C\\u0443\\u0437\\u044B\\u043A\\u0430\\u043B\\u044C\\u043D\\u0430\\u044F \\u0441\\u0438\\u0441\\u0442\\u0435\\u043C\\u0430 \\u043D\\u0435\\u0434\\u043E\\u0441\\u0442\\u0443\\u043F\\u043D\\u0430\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>{setHasError(false);window.location.reload();},style:{background:'none',border:'1px solid #E8D5B7',color:'#E8D5B7',padding:'5px 10px',borderRadius:'4px',cursor:'pointer',fontSize:'12px'},children:\"\\u041F\\u043E\\u043F\\u0440\\u043E\\u0431\\u043E\\u0432\\u0430\\u0442\\u044C \\u0441\\u043D\\u043E\\u0432\\u0430\"})]}),isLoading&&/*#__PURE__*/_jsx(\"div\",{className:\"music-loading\",children:/*#__PURE__*/_jsx(\"span\",{children:\"\\uD83C\\uDFB5 \\u0421\\u043E\\u0437\\u0434\\u0430\\u043D\\u0438\\u0435 \\u0433\\u043E\\u0442\\u0438\\u0447\\u0435\\u0441\\u043A\\u043E\\u0439 \\u043A\\u043E\\u043C\\u043F\\u043E\\u0437\\u0438\\u0446\\u0438\\u0438...\"})}),!hasError&&/*#__PURE__*/_jsxs(\"div\",{className:\"music-controls\",children:[/*#__PURE__*/_jsx(\"button\",{className:\"style-btn \".concat(currentStyle==='ambient'?'active':''),onClick:()=>handleStyleChange('ambient'),children:\"\\uD83C\\uDF19 Ambient\"}),/*#__PURE__*/_jsx(\"button\",{className:\"style-btn \".concat(currentStyle==='rhythmic'?'active':''),onClick:()=>handleStyleChange('rhythmic'),children:\"\\u26A1 Gothic\"}),/*#__PURE__*/_jsx(\"button\",{className:\"style-btn \".concat(currentStyle==='dark'?'active':''),onClick:()=>handleStyleChange('dark'),children:\"\\uD83D\\uDC80 Dark\"}),/*#__PURE__*/_jsx(\"button\",{className:\"style-btn \".concat(currentStyle==='cathedral'?'active':''),onClick:()=>handleStyleChange('cathedral'),children:\"\\uD83C\\uDFF0 Cathedral\"}),/*#__PURE__*/_jsx(\"button\",{className:\"style-btn \".concat(currentStyle==='ritual'?'active':''),onClick:()=>handleStyleChange('ritual'),children:\"\\uD83D\\uDD2E Ritual\"})]})]})});});export default GothicMusicGenerator;","map":{"version":3,"names":["React","useEffect","useRef","useState","useCallback","Tone","PerformanceUtils","jsx","_jsx","jsxs","_jsxs","AudioErrorBoundary","Component","constructor","props","state","hasError","error","getDerivedStateFromError","componentDidCatch","errorInfo","console","render","className","style","padding","color","children","onClick","setState","GothicMusicSystem","isPlaying","currentComposition","currentStyle","instruments","effects","isInitialized","initError","activePatterns","audioContext","isLowPerformanceMode","detectLowPerformance","masterVolume","Volume","toDestination","gothicScales","darkMinor","harmonic","dorian","phrygian","initializeInstruments","canvas","document","createElement","gl","getContext","renderer","getParameter","RENDERER","vendor","VENDOR","test","navigator","userAgent","deviceMemory","maxPolyphony","effectsWet","lead","PolySynth","voice","Synth","options","oscillator","type","envelope","attack","decay","sustain","release","filter","frequency","bass","MonoSynth","pad","Math","max","drums","MembraneSynth","reverb","Reverb","wet","delay","PingPongDelay","delayTime","feedback","chorus","Chorus","depth","distortion","Distortion","connect","generateGothicMelody","scale","arguments","length","undefined","actualLength","min","scaleNotes","melody","gothicIntervals","currentNoteIndex","i","noteChance","random","interval","floor","push","note","duration","getGothicNoteDuration","velocity","durations","generateBassLine","map","replace","num","String","parseInt","bassLine","bassPattern","noteIndex","generateAtmosphericPads","chords","generateDrumPattern","time","startComposition","start","playAmbientGothic","playRhythmicGothic","playDarkAtmosphere","playCathedralOrgan","playRitualPercussion","melodyLength","melodyTime","forEach","index","Transport","schedule","triggerAttackRelease","Time","toSeconds","chordInterval","chord","scheduleTime","ambienceLoop","Loop","Frequency","transpose","drumPattern","melodyLoop","Sequence","bassLoop","drumLoop","drum","lowNotes","creepyLoop","organLoop","set","highNote","setTimeout","bassNote","bellLoop","chantNotes","slice","chantLoop","chordNotes","ritualLoop","stop","pattern","Object","values","instrument","releaseAll","cancel","context","rawContext","resume","setVolume","volume","value","gainToDb","transitionToStyle","newStyle","currentVolume","Destination","rampTo","dispose","effect","GothicMusicGenerator","memo","_ref","seed","musicSystemRef","setCurrentStyle","isLoading","setIsLoading","setHasError","isLagging","setIsLagging","performanceTier","getDevicePerformanceTier","prefersReducedMotion","frameCountRef","lastTimeRef","performance","now","checkPerformance","currentTime","delta","current","fps","setInterval","clearInterval","isMounted","initSystem","AudioContext","webkitAudioContext","warn","Error","e","err","volumeTimeout","clearTimeout","handlePlayback","Promise","resolve","s","rand","origRandom","success","timeoutId","handleStyleChange","concat","background","borderRadius","marginBottom","textAlign","window","location","reload","border","cursor","fontSize"],"sources":["/var/www/www-root/data/www/knigavl.ru/src/components/GothicMusicGenerator.js"],"sourcesContent":["import React, { useEffect, useRef, useState, useCallback } from 'react';\r\nimport * as Tone from 'tone';\r\nimport { PerformanceUtils } from './PerformanceMonitor';\r\n\r\n/**\r\n * GothicMusicGenerator - –ö–æ–º–ø–æ–Ω–µ–Ω—Ç –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –≥–æ—Ç–∏—á–µ—Å–∫–æ–π –º—É–∑—ã–∫–∏ –∫–æ–¥–æ–º\r\n * –°–æ–∑–¥–∞–µ—Ç –∞—Ç–º–æ—Å—Ñ–µ—Ä–Ω—É—é –≥–æ—Ç–∏—á–µ—Å–∫—É—é –º—É–∑—ã–∫—É —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º Tone.js\r\n */\r\n\r\n// Error boundary component to catch audio errors\r\nclass AudioErrorBoundary extends React.Component {\r\n  constructor(props) {\r\n    super(props);\r\n    this.state = { hasError: false, error: null };\r\n  }\r\n\r\n  static getDerivedStateFromError(error) {\r\n    return { hasError: true, error };\r\n  }\r\n\r\n  componentDidCatch(error, errorInfo) {\r\n    console.error('Audio system error:', error, errorInfo);\r\n  }\r\n\r\n  render() {\r\n    if (this.state.hasError) {\r\n      return (\r\n        <div className=\"audio-error\" style={{ padding: '10px', color: '#E8D5B7' }}>\r\n          <p>üéµ Audio temporarily unavailable</p>\r\n          <button onClick={() => this.setState({ hasError: false, error: null })}>\r\n            Try Again\r\n          </button>\r\n        </div>\r\n      );\r\n    }\r\n\r\n    return this.props.children;\r\n  }\r\n}\r\n\r\nclass GothicMusicSystem {\r\n  constructor() {\r\n    this.isPlaying = false;\r\n    this.currentComposition = null;\r\n    this.currentStyle = null;\r\n    this.instruments = {};\r\n    this.effects = {};\r\n    this.isInitialized = false;\r\n    this.initError = null;\r\n    this.activePatterns = [];\r\n    this.audioContext = null;\r\n    this.isLowPerformanceMode = this.detectLowPerformance();\r\n    \r\n    try {\r\n      this.masterVolume = new Tone.Volume(-12).toDestination();\r\n      \r\n      // –ì–æ—Ç–∏—á–µ—Å–∫–∏–µ —Ç–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏ (–º–∏–Ω–æ—Ä–Ω—ã–µ –≥–∞–º–º—ã)\r\n      this.gothicScales = {\r\n        darkMinor: ['C3', 'D3', 'Eb3', 'F3', 'G3', 'Ab3', 'Bb3', 'C4'],\r\n        harmonic: ['A2', 'B2', 'C3', 'D3', 'E3', 'F3', 'G#3', 'A3'],\r\n        dorian: ['D3', 'E3', 'F3', 'G3', 'A3', 'B3', 'C4', 'D4'],\r\n        phrygian: ['E3', 'F3', 'G3', 'A3', 'B3', 'C4', 'D4', 'E4']\r\n      };\r\n      \r\n      this.initializeInstruments();\r\n      this.isInitialized = true;\r\n    } catch (error) {\r\n      console.error('Failed to initialize Gothic Music System:', error);\r\n      this.initError = error;\r\n      this.isInitialized = false;\r\n    }\r\n  }\r\n  \r\n  detectLowPerformance() {\r\n    // Simple performance detection\r\n    const canvas = document.createElement('canvas');\r\n    const gl = canvas.getContext('webgl') || canvas.getContext('experimental-webgl');\r\n    \r\n    if (!gl) return true; // No WebGL = low performance\r\n    \r\n    const renderer = gl.getParameter(gl.RENDERER);\r\n    const vendor = gl.getParameter(gl.VENDOR);\r\n    \r\n    // Check for mobile or low-end devices\r\n    if (/mobile|android|iphone|ipad/i.test(navigator.userAgent)) {\r\n      return true;\r\n    }\r\n    \r\n    // Check available memory (if supported)\r\n    if (navigator.deviceMemory && navigator.deviceMemory < 4) {\r\n      return true;\r\n    }\r\n    \r\n    return false;\r\n  }\r\n\r\n  initializeInstruments() {\r\n    try {\r\n      // Reduce polyphony for low-performance devices\r\n      const maxPolyphony = this.isLowPerformanceMode ? 4 : 8;\r\n      const effectsWet = this.isLowPerformanceMode ? 0.2 : 0.6;\r\n      \r\n      // –ì–ª–∞–≤–Ω—ã–π —Å–∏–Ω—Ç–µ–∑–∞—Ç–æ—Ä –¥–ª—è –º–µ–ª–æ–¥–∏–∏ (–æ—Ä–≥–∞–Ω-—Å—Ç–∞–π–ª)\r\n      this.instruments.lead = new Tone.PolySynth({\r\n        maxPolyphony: maxPolyphony,\r\n        voice: Tone.Synth,\r\n        options: {\r\n          oscillator: {\r\n            type: 'sawtooth'\r\n          },\r\n          envelope: {\r\n            attack: 0.3,\r\n            decay: 0.1,\r\n            sustain: 0.8,\r\n            release: 2.0\r\n          },\r\n          filter: {\r\n            frequency: 800,\r\n            type: 'lowpass'\r\n          }\r\n        }\r\n      });\r\n\r\n      // –ë–∞—Å–æ–≤—ã–π —Å–∏–Ω—Ç–µ–∑–∞—Ç–æ—Ä\r\n      this.instruments.bass = new Tone.MonoSynth({\r\n        oscillator: {\r\n          type: 'triangle'\r\n        },\r\n        envelope: {\r\n          attack: 0.1,\r\n          decay: 0.3,\r\n          sustain: 0.5,\r\n          release: 1.5\r\n        },\r\n        filter: {\r\n          frequency: 300,\r\n          type: 'lowpass'\r\n        }\r\n      });\r\n\r\n      // –ê—Ç–º–æ—Å—Ñ–µ—Ä–Ω—ã–µ –ø–∞–¥—ã (reduced polyphony)\r\n      this.instruments.pad = new Tone.PolySynth({\r\n        maxPolyphony: Math.max(2, maxPolyphony / 2),\r\n        voice: Tone.Synth,\r\n        options: {\r\n          oscillator: {\r\n            type: 'sine'\r\n          },\r\n          envelope: {\r\n            attack: 2.0,\r\n            decay: 1.0,\r\n            sustain: 0.9,\r\n            release: 4.0\r\n          }\r\n        }\r\n      });\r\n\r\n      // –£–¥–∞—Ä–Ω—ã–µ (–≥–æ—Ç–∏—á–µ—Å–∫–∏–π —Å—Ç–∏–ª—å)\r\n      this.instruments.drums = new Tone.MembraneSynth({\r\n        envelope: {\r\n          attack: 0.02,\r\n          decay: 0.3,\r\n          sustain: 0.1,\r\n          release: 1.2\r\n        }\r\n      });\r\n\r\n      // –≠—Ñ—Ñ–µ–∫—Ç—ã (reduced for performance)\r\n      if (!this.isLowPerformanceMode) {\r\n        this.effects.reverb = new Tone.Reverb({\r\n          decay: 4,\r\n          wet: effectsWet\r\n        });\r\n\r\n        this.effects.delay = new Tone.PingPongDelay({\r\n          delayTime: '8n',\r\n          feedback: 0.3,\r\n          wet: 0.3\r\n        });\r\n\r\n        this.effects.chorus = new Tone.Chorus({\r\n          frequency: 0.5,\r\n          delayTime: 8,\r\n          depth: 0.4,\r\n          wet: 0.3\r\n        });\r\n\r\n        this.effects.distortion = new Tone.Distortion({\r\n          distortion: 0.1,\r\n          wet: 0.2\r\n        });\r\n\r\n        // –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —ç—Ñ—Ñ–µ–∫—Ç–æ–≤\r\n        this.instruments.lead.connect(this.effects.reverb);\r\n        this.effects.reverb.connect(this.effects.delay);\r\n        this.effects.delay.connect(this.masterVolume);\r\n\r\n        this.instruments.bass.connect(this.effects.distortion);\r\n        this.effects.distortion.connect(this.masterVolume);\r\n\r\n        this.instruments.pad.connect(this.effects.chorus);\r\n        this.effects.chorus.connect(this.effects.reverb);\r\n      } else {\r\n        // Low performance mode - direct connections\r\n        this.instruments.lead.connect(this.masterVolume);\r\n        this.instruments.bass.connect(this.masterVolume);\r\n        this.instruments.pad.connect(this.masterVolume);\r\n      }\r\n\r\n      this.instruments.drums.connect(this.masterVolume);\r\n    } catch (error) {\r\n      console.error('Failed to initialize instruments:', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –≥–æ—Ç–∏—á–µ—Å–∫–æ–π –º–µ–ª–æ–¥–∏–∏ (optimized)\r\n  generateGothicMelody(scale = 'darkMinor', length = 16) {\r\n    // Reduce length for low performance devices\r\n    const actualLength = this.isLowPerformanceMode ? Math.min(length, 8) : length;\r\n    const scaleNotes = this.gothicScales[scale];\r\n    const melody = [];\r\n    \r\n    // –ì–æ—Ç–∏—á–µ—Å–∫–∏–µ –∏–Ω—Ç–µ—Ä–≤–∞–ª—ã (–ø—Ä–µ–¥–ø–æ—á–∏—Ç–∞–µ–º –º–∏–Ω–æ—Ä–Ω—ã–µ —Ç–µ—Ä—Ü–∏–∏, –∫–≤–∞—Ä—Ç—ã, –∫–≤–∏–Ω—Ç—ã)\r\n    const gothicIntervals = [-7, -5, -3, -2, 0, 2, 3, 5, 7];\r\n    \r\n    let currentNoteIndex = 0;\r\n    \r\n    for (let i = 0; i < actualLength; i++) {\r\n      // Higher chance of pauses in low performance mode\r\n      const noteChance = this.isLowPerformanceMode ? 0.6 : 0.8;\r\n      \r\n      if (Math.random() < noteChance) {\r\n        const interval = gothicIntervals[Math.floor(Math.random() * gothicIntervals.length)];\r\n        currentNoteIndex = Math.max(0, Math.min(scaleNotes.length - 1, currentNoteIndex + interval));\r\n        \r\n        melody.push({\r\n          note: scaleNotes[currentNoteIndex],\r\n          duration: this.getGothicNoteDuration(),\r\n          velocity: Math.random() * 0.3 + 0.4 // 0.4 - 0.7\r\n        });\r\n      } else {\r\n        melody.push({ note: null, duration: '8n' }); // –ü–∞—É–∑–∞\r\n      }\r\n    }\r\n    \r\n    return melody;\r\n  }\r\n\r\n  getGothicNoteDuration() {\r\n    const durations = ['4n', '4n', '8n', '8n', '2n', '8n.'];\r\n    return durations[Math.floor(Math.random() * durations.length)];\r\n  }\r\n\r\n  // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –±–∞—Å–æ–≤–æ–π –ª–∏–Ω–∏–∏\r\n  generateBassLine(scale = 'darkMinor', length = 8) {\r\n    const scaleNotes = this.gothicScales[scale].map(note => \r\n      note.replace(/\\d/, (num) => String(parseInt(num) - 1))\r\n    );\r\n    \r\n    const bassLine = [];\r\n    const bassPattern = [0, 0, 4, 4, 2, 2, 6, 0]; // –ì–æ—Ç–∏—á–µ—Å–∫–∏–π –±–∞—Å–æ–≤—ã–π –ø–∞—Ç—Ç–µ—Ä–Ω\r\n    \r\n    for (let i = 0; i < length; i++) {\r\n      const noteIndex = bassPattern[i % bassPattern.length];\r\n      bassLine.push({\r\n        note: scaleNotes[noteIndex],\r\n        duration: '4n',\r\n        velocity: 0.8\r\n      });\r\n    }\r\n    \r\n    return bassLine;\r\n  }\r\n\r\n  // –°–æ–∑–¥–∞–Ω–∏–µ –∞—Ç–º–æ—Å—Ñ–µ—Ä–Ω—ã—Ö –ø–∞–¥–æ–≤\r\n  generateAtmosphericPads(scale = 'darkMinor') {\r\n    const scaleNotes = this.gothicScales[scale];\r\n    const chords = [\r\n      [scaleNotes[0], scaleNotes[2], scaleNotes[4]], // i\r\n      [scaleNotes[1], scaleNotes[3], scaleNotes[5]], // ii¬∞\r\n      [scaleNotes[2], scaleNotes[4], scaleNotes[6]], // III\r\n      [scaleNotes[3], scaleNotes[5], scaleNotes[0]], // iv\r\n      [scaleNotes[4], scaleNotes[6], scaleNotes[1]], // v\r\n      [scaleNotes[5], scaleNotes[0], scaleNotes[2]], // VI\r\n      [scaleNotes[6], scaleNotes[1], scaleNotes[3]]  // VII\r\n    ];\r\n    \r\n    return chords;\r\n  }\r\n\r\n  // –ì–æ—Ç–∏—á–µ—Å–∫–∏–π —Ä–∏—Ç–º-–ø–∞—Ç—Ç–µ—Ä–Ω\r\n  generateDrumPattern() {\r\n    return [\r\n      { time: '0:0:0', note: 'C2', velocity: 0.9 },\r\n      { time: '0:1:0', note: 'C2', velocity: 0.3 },\r\n      { time: '0:2:0', note: 'C2', velocity: 0.7 },\r\n      { time: '0:3:2', note: 'C2', velocity: 0.4 },\r\n    ];\r\n  }\r\n\r\n  async startComposition(type = 'ambient') {\r\n    if (this.isPlaying) return;\r\n    \r\n    // Check if system is properly initialized\r\n    if (!this.isInitialized || this.initError) {\r\n      console.error('Cannot start composition: system not initialized', this.initError);\r\n      return false;\r\n    }\r\n    \r\n    try {\r\n      await Tone.start();\r\n      this.isPlaying = true;\r\n      this.activePatterns = [];\r\n      this.currentStyle = type;\r\n      \r\n      if (type === 'ambient') {\r\n        this.playAmbientGothic();\r\n      } else if (type === 'rhythmic') {\r\n        this.playRhythmicGothic();\r\n      } else if (type === 'dark') {\r\n        this.playDarkAtmosphere();\r\n      } else if (type === 'cathedral') {\r\n        this.playCathedralOrgan();\r\n      } else if (type === 'ritual') {\r\n        this.playRitualPercussion();\r\n      }\r\n      \r\n      return true;\r\n    } catch (error) {\r\n      console.error('Failed to start composition:', error);\r\n      this.isPlaying = false;\r\n      return false;\r\n    }\r\n  }\r\n\r\n  playAmbientGothic() {\r\n    const scale = 'harmonic';\r\n    const melodyLength = this.isLowPerformanceMode ? 16 : 32;\r\n    const melody = this.generateGothicMelody(scale, melodyLength);\r\n    const chords = this.generateAtmosphericPads(scale);\r\n    \r\n    // Store active patterns for transitions\r\n    this.activePatterns = [];\r\n    \r\n    // –ò–≥—Ä–∞–µ–º –º–µ–ª–æ–¥–∏—é\r\n    let melodyTime = 0;\r\n    melody.forEach((note, index) => {\r\n      if (note.note) {\r\n        Tone.Transport.schedule((time) => {\r\n          this.instruments.lead.triggerAttackRelease(\r\n            note.note, \r\n            note.duration, \r\n            time, \r\n            note.velocity\r\n          );\r\n        }, melodyTime);\r\n      }\r\n      melodyTime += Tone.Time(note.duration).toSeconds();\r\n    });\r\n\r\n    // –ò–≥—Ä–∞–µ–º –∞—Ç–º–æ—Å—Ñ–µ—Ä–Ω—ã–µ –∞–∫–∫–æ—Ä–¥—ã (less frequent on low-end devices)\r\n    const chordInterval = this.isLowPerformanceMode ? 8 : 4;\r\n    chords.forEach((chord, index) => {\r\n      const time = index * chordInterval;\r\n      Tone.Transport.schedule((scheduleTime) => {\r\n        this.instruments.pad.triggerAttackRelease(\r\n          chord, \r\n          '1m', \r\n          scheduleTime, \r\n          0.3\r\n        );\r\n      }, time);\r\n    });\r\n\r\n    // Add background ambience (only on high-performance devices)\r\n    if (!this.isLowPerformanceMode) {\r\n      const ambienceLoop = new Tone.Loop((time) => {\r\n        if (Math.random() < 0.3) {\r\n          const note = this.gothicScales[scale][Math.floor(Math.random() * this.gothicScales[scale].length)];\r\n          this.instruments.pad.triggerAttackRelease(\r\n            Tone.Frequency(note).transpose(12), \r\n            '4n', \r\n            time, \r\n            0.1\r\n          );\r\n        }\r\n      }, '2m').start(0);\r\n      \r\n      this.activePatterns.push(ambienceLoop);\r\n    }\r\n\r\n    if (Tone.Transport.state !== 'started') {\r\n      Tone.Transport.start();\r\n    }\r\n  }\r\n\r\n  playRhythmicGothic() {\r\n    const scale = 'dorian';\r\n    const melody = this.generateGothicMelody(scale, 16);\r\n    const bassLine = this.generateBassLine(scale, 16);\r\n    const drumPattern = this.generateDrumPattern();\r\n    \r\n    // Store active patterns for transitions\r\n    this.activePatterns = [];\r\n    \r\n    // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ª—É–ø–æ–≤\r\n    const melodyLoop = new Tone.Sequence((time, note) => {\r\n      if (note && note.note) {\r\n        this.instruments.lead.triggerAttackRelease(\r\n          note.note, \r\n          note.duration, \r\n          time, \r\n          note.velocity\r\n        );\r\n      }\r\n    }, melody, '8n').start(0);\r\n\r\n    const bassLoop = new Tone.Sequence((time, note) => {\r\n      this.instruments.bass.triggerAttackRelease(\r\n        note.note, \r\n        note.duration, \r\n        time, \r\n        note.velocity\r\n      );\r\n    }, bassLine, '4n').start(0);\r\n\r\n    const drumLoop = new Tone.Sequence((time, drum) => {\r\n      this.instruments.drums.triggerAttackRelease(\r\n        drum.note, \r\n        '8n', \r\n        time, \r\n        drum.velocity\r\n      );\r\n    }, drumPattern, '4n').start(0);\r\n    \r\n    this.activePatterns.push(melodyLoop, bassLoop, drumLoop);\r\n\r\n    if (Tone.Transport.state !== 'started') {\r\n      Tone.Transport.start();\r\n    }\r\n  }\r\n\r\n  playDarkAtmosphere() {\r\n    const scale = 'phrygian';\r\n    const lowNotes = this.gothicScales[scale].map(note => \r\n      note.replace(/\\d/, '1')\r\n    );\r\n    \r\n    // Store active patterns for transitions\r\n    this.activePatterns = [];\r\n    \r\n    // –û—á–µ–Ω—å –º–µ–¥–ª–µ–Ω–Ω–∞—è, –∂—É—Ç–∫–∞—è –∞—Ç–º–æ—Å—Ñ–µ—Ä–∞\r\n    lowNotes.forEach((note, index) => {\r\n      Tone.Transport.schedule((time) => {\r\n        this.instruments.pad.triggerAttackRelease(\r\n          [note, Tone.Frequency(note).transpose(3), Tone.Frequency(note).transpose(7)], \r\n          '2m', \r\n          time, \r\n          0.2\r\n        );\r\n        \r\n        // –î–æ–±–∞–≤–ª—è–µ–º —Å–ª—É—á–∞–π–Ω—ã–µ –≤—ã—Å–æ–∫–∏–µ –Ω–æ—Ç—ã –¥–ª—è –∂—É—Ç–∫–æ—Å—Ç–∏\r\n        if (Math.random() < 0.3) {\r\n          this.instruments.lead.triggerAttackRelease(\r\n            Tone.Frequency(note).transpose(24), \r\n            '1n', \r\n            time + Math.random() * 4, \r\n            0.1\r\n          );\r\n        }\r\n      }, index * 8);\r\n    });\r\n    \r\n    // Add creepy background noises\r\n    const creepyLoop = new Tone.Loop((time) => {\r\n      if (Math.random() < 0.15) {\r\n        const noteIndex = Math.floor(Math.random() * lowNotes.length);\r\n        const note = lowNotes[noteIndex];\r\n        const transpose = Math.random() < 0.5 ? 36 : 24;\r\n        \r\n        this.instruments.lead.triggerAttackRelease(\r\n          Tone.Frequency(note).transpose(transpose), \r\n          '16n', \r\n          time, \r\n          0.05\r\n        );\r\n      }\r\n    }, '4m').start(0);\r\n    \r\n    this.activePatterns.push(creepyLoop);\r\n\r\n    if (Tone.Transport.state !== 'started') {\r\n      Tone.Transport.start();\r\n    }\r\n  }\r\n\r\n  playCathedralOrgan() {\r\n    const scale = 'harmonic';\r\n    const chords = this.generateAtmosphericPads(scale);\r\n    \r\n    // Store active patterns for transitions\r\n    this.activePatterns = [];\r\n    \r\n    // Create a cathedral organ pattern\r\n    const organLoop = new Tone.Loop((time) => {\r\n      // Choose a random chord\r\n      const chord = chords[Math.floor(Math.random() * chords.length)];\r\n      \r\n      // Play deep organ sound\r\n      this.instruments.pad.set({\r\n        oscillator: { type: 'sine' },\r\n        envelope: { attack: 0.1, release: 4.0 }\r\n      });\r\n      \r\n      // Play a cathedral-style progression\r\n      this.instruments.pad.triggerAttackRelease(chord, '2n', time, 0.2);\r\n      \r\n      // Add high register for pipe organ effect\r\n      const highNote = chord[Math.floor(Math.random() * chord.length)];\r\n      setTimeout(() => {\r\n        this.instruments.lead.triggerAttackRelease(\r\n          Tone.Frequency(highNote).transpose(12),\r\n          '2n',\r\n          time + 0.1,\r\n          0.1\r\n        );\r\n      }, 50);\r\n      \r\n      // Add bass note\r\n      const bassNote = chord[0].replace(/\\d/, (num) => String(parseInt(num) - 1));\r\n      this.instruments.bass.triggerAttackRelease(\r\n        bassNote,\r\n        '1n',\r\n        time,\r\n        0.3\r\n      );\r\n      \r\n    }, '2m').start(0);\r\n    \r\n    // Add cathedral bell sounds occasionally\r\n    const bellLoop = new Tone.Loop((time) => {\r\n      if (Math.random() < 0.3) {\r\n        const scaleNotes = this.gothicScales[scale];\r\n        const note = scaleNotes[Math.floor(Math.random() * scaleNotes.length)];\r\n        \r\n        // Create bell sound\r\n        this.instruments.lead.set({\r\n          oscillator: { type: 'sine' },\r\n          envelope: { attack: 0.01, decay: 3.0, sustain: 0, release: 5.0 }\r\n        });\r\n        \r\n        // Play bell\r\n        this.instruments.lead.triggerAttackRelease(\r\n          Tone.Frequency(note).transpose(24),\r\n          '8n',\r\n          time,\r\n          0.2\r\n        );\r\n      }\r\n    }, '4m').start(0);\r\n    \r\n    this.activePatterns.push(organLoop, bellLoop);\r\n    \r\n    if (Tone.Transport.state !== 'started') {\r\n      Tone.Transport.start();\r\n    }\r\n  }\r\n  \r\n  playRitualPercussion() {\r\n    const scale = 'phrygian';\r\n    \r\n    // Store active patterns for transitions\r\n    this.activePatterns = [];\r\n    \r\n    // Create ritual drum pattern\r\n    const drumPattern = [\r\n      { time: '0:0:0', note: 'C2', velocity: 0.9 },\r\n      { time: '0:0:3', note: 'C2', velocity: 0.5 },\r\n      { time: '0:1:0', note: 'G1', velocity: 0.7 },\r\n      { time: '0:2:0', note: 'C2', velocity: 0.9 },\r\n      { time: '0:3:0', note: 'G1', velocity: 0.7 },\r\n      { time: '0:3:3', note: 'C2', velocity: 0.5 },\r\n    ];\r\n    \r\n    // Create ritual chant pattern\r\n    const chantNotes = this.gothicScales[scale].slice(0, 3); // Use first 3 notes\r\n    \r\n    // Slow tribal drums\r\n    const drumLoop = new Tone.Sequence((time, drum) => {\r\n      this.instruments.drums.triggerAttackRelease(\r\n        drum.note,\r\n        '8n',\r\n        time,\r\n        drum.velocity\r\n      );\r\n    }, drumPattern, '4n').start(0);\r\n    \r\n    // Ritual chanting\r\n    const chantLoop = new Tone.Loop((time) => {\r\n      // Set pad to vocal-like sound\r\n      this.instruments.pad.set({\r\n        oscillator: { type: 'triangle' },\r\n        envelope: { attack: 0.3, release: 2.0 }\r\n      });\r\n      \r\n      // Play chant chord\r\n      const chordNotes = [\r\n        chantNotes[Math.floor(Math.random() * chantNotes.length)],\r\n        chantNotes[Math.floor(Math.random() * chantNotes.length)]\r\n      ];\r\n      \r\n      this.instruments.pad.triggerAttackRelease(\r\n        chordNotes,\r\n        '2n',\r\n        time,\r\n        0.15\r\n      );\r\n    }, '2m').start(0);\r\n    \r\n    // Occasional ritual sounds\r\n    const ritualLoop = new Tone.Loop((time) => {\r\n      if (Math.random() < 0.2) {\r\n        // Create shaker/rattle sound\r\n        const note = 'A5';\r\n        this.instruments.lead.triggerAttackRelease(\r\n          note,\r\n          '16n',\r\n          time,\r\n          0.1\r\n        );\r\n      }\r\n    }, '8n').start(0);\r\n    \r\n    this.activePatterns.push(drumLoop, chantLoop, ritualLoop);\r\n    \r\n    if (Tone.Transport.state !== 'started') {\r\n      Tone.Transport.start();\r\n    }\r\n  }\r\n\r\n  stop() {\r\n    this.isPlaying = false;\r\n    \r\n    // Stop all active patterns\r\n    if (this.activePatterns && this.activePatterns.length > 0) {\r\n      this.activePatterns.forEach(pattern => {\r\n        if (pattern && typeof pattern.stop === 'function') {\r\n          pattern.stop();\r\n        }\r\n      });\r\n      this.activePatterns = [];\r\n    }\r\n    \r\n    // Release all notes that might be playing\r\n    Object.values(this.instruments).forEach(instrument => {\r\n      if (instrument && typeof instrument.releaseAll === 'function') {\r\n        instrument.releaseAll();\r\n      }\r\n    });\r\n    \r\n    // Stop and cancel all scheduled events\r\n    Tone.Transport.stop();\r\n    Tone.Transport.cancel();\r\n    \r\n    // Clear Tone.js internal state\r\n    Tone.context.rawContext.resume();\r\n  }\r\n\r\n  setVolume(volume) {\r\n    this.masterVolume.volume.value = Tone.gainToDb(volume);\r\n  }\r\n\r\n  async transitionToStyle(newStyle) {\r\n    // If not currently playing, just update the style\r\n    if (!this.isPlaying) return;\r\n    \r\n    // If already playing this style, do nothing\r\n    if (this.currentStyle === newStyle) return;\r\n    \r\n    // Prepare crossfade\r\n    const currentVolume = Tone.gainToDb(this.masterVolume.volume.value);\r\n    \r\n    // Gradually lower the volume\r\n    await Tone.Destination.volume.rampTo(currentVolume - 20, 0.5);\r\n    \r\n    // Stop the current patterns but don't reset Transport\r\n    if (this.activePatterns) {\r\n      this.activePatterns.forEach(pattern => pattern.stop());\r\n    }\r\n    \r\n    // Clear scheduled events without stopping transport\r\n    Tone.Transport.cancel();\r\n    \r\n    // Update current style\r\n    this.currentStyle = newStyle;\r\n    \r\n    // Start the new style\r\n    if (newStyle === 'ambient') {\r\n      this.playAmbientGothic();\r\n    } else if (newStyle === 'rhythmic') {\r\n      this.playRhythmicGothic();\r\n    } else if (newStyle === 'dark') {\r\n      this.playDarkAtmosphere();\r\n    } else if (newStyle === 'cathedral') {\r\n      this.playCathedralOrgan();\r\n    } else if (newStyle === 'ritual') {\r\n      this.playRitualPercussion();\r\n    }\r\n    \r\n    // Gradually restore volume\r\n    await Tone.Destination.volume.rampTo(currentVolume, 0.8);\r\n  }\r\n  \r\n  dispose() {\r\n    this.stop();\r\n    Object.values(this.instruments).forEach(instrument => instrument.dispose());\r\n    Object.values(this.effects).forEach(effect => effect.dispose());\r\n    this.masterVolume.dispose();\r\n  }\r\n}\r\n\r\nconst GothicMusicGenerator = React.memo(({ isPlaying, volume = 0.3, style = 'ambient', seed = null }) => {\r\n  const musicSystemRef = useRef(null);\r\n  const [currentStyle, setCurrentStyle] = useState(style);\r\n  const [isLoading, setIsLoading] = useState(false);\r\n  const [hasError, setHasError] = useState(false);\r\n  const [isLagging, setIsLagging] = useState(false);\r\n  \r\n  // Detect performance issues\r\n  const performanceTier = PerformanceUtils.getDevicePerformanceTier();\r\n  const prefersReducedMotion = PerformanceUtils.prefersReducedMotion();\r\n  \r\n  // Simple FPS monitoring for this component\r\n  const frameCountRef = useRef(0);\r\n  const lastTimeRef = useRef(performance.now());\r\n  \r\n  useEffect(() => {\r\n    const checkPerformance = () => {\r\n      const currentTime = performance.now();\r\n      const delta = currentTime - lastTimeRef.current;\r\n      \r\n      if (delta >= 2000) { // Check every 2 seconds\r\n        const fps = (frameCountRef.current * 1000) / delta;\r\n        setIsLagging(fps < 20); // Consider lagging if below 20 FPS\r\n        \r\n        frameCountRef.current = 0;\r\n        lastTimeRef.current = currentTime;\r\n      }\r\n      \r\n      frameCountRef.current++;\r\n    };\r\n    \r\n    const interval = setInterval(checkPerformance, 100);\r\n    return () => clearInterval(interval);\r\n  }, []);\r\n\r\n  // Initialize the music system with better cleanup\r\n  useEffect(() => {\r\n    let isMounted = true;\r\n    \r\n    // Optimized initialization\r\n    const initSystem = async () => {\r\n      try {\r\n        if (!musicSystemRef.current && isMounted) {\r\n          // Check if audio context is available\r\n          if (typeof AudioContext === 'undefined' && typeof webkitAudioContext === 'undefined') {\r\n            console.warn('Web Audio API not supported');\r\n            setHasError(true);\r\n            return;\r\n          }\r\n          \r\n          // Wait for audio context to fully initialize\r\n          await Tone.start();\r\n          \r\n          if (isMounted) {\r\n            musicSystemRef.current = new GothicMusicSystem();\r\n            \r\n            // Check if initialization was successful\r\n            if (!musicSystemRef.current.isInitialized) {\r\n              throw new Error('Failed to initialize music system');\r\n            }\r\n            \r\n            setHasError(false);\r\n          }\r\n        }\r\n      } catch (error) {\r\n        console.error('Error initializing audio system:', error);\r\n        setHasError(true);\r\n        if (musicSystemRef.current) {\r\n          try {\r\n            musicSystemRef.current.dispose();\r\n          } catch (e) {\r\n            console.error('Error disposing failed music system:', e);\r\n          }\r\n          musicSystemRef.current = null;\r\n        }\r\n      }\r\n    };\r\n    \r\n    initSystem();\r\n    \r\n    // Thorough cleanup\r\n    return () => {\r\n      isMounted = false;\r\n      if (musicSystemRef.current) {\r\n        try {\r\n          // Make sure all audio is properly stopped\r\n          musicSystemRef.current.dispose();\r\n          musicSystemRef.current = null;\r\n        } catch (err) {\r\n          console.error('Cleanup error:', err);\r\n        }\r\n      }\r\n    };\r\n  }, []);\r\n\r\n  // Volume control with debouncing (increased debounce time for performance)\r\n  useEffect(() => {\r\n    if (musicSystemRef.current && musicSystemRef.current.isInitialized) {\r\n      const volumeTimeout = setTimeout(() => {\r\n        try {\r\n          musicSystemRef.current.setVolume(volume);\r\n        } catch (error) {\r\n          console.error('Error setting volume:', error);\r\n        }\r\n      }, 100); // Increased debounce time\r\n      \r\n      return () => clearTimeout(volumeTimeout);\r\n    }\r\n  }, [volume]);\r\n\r\n  useEffect(() => {\r\n    // Optimized playback handler with error handling\r\n    const handlePlayback = async () => {\r\n      if (!musicSystemRef.current || hasError) return;\r\n      \r\n      try {\r\n        if (isPlaying) {\r\n          setIsLoading(true);\r\n          \r\n          // Check if system is properly initialized\r\n          if (!musicSystemRef.current.isInitialized) {\r\n            console.warn('Music system not initialized, skipping playback');\r\n            setIsLoading(false);\r\n            return;\r\n          }\r\n          \r\n          // Throttle resource-intensive operations\r\n          await new Promise(resolve => setTimeout(resolve, 10));\r\n          \r\n          if (musicSystemRef.current.isPlaying && \r\n              currentStyle !== musicSystemRef.current.currentStyle) {\r\n            // Transition between styles when already playing\r\n            await musicSystemRef.current.transitionToStyle(currentStyle);\r\n          } else if (!musicSystemRef.current.isPlaying) {\r\n            // Start from scratch\r\n            // Apply seed by nudging Math.random via a simple PRNG if provided\r\n            if (seed !== null && typeof seed === 'number') {\r\n              let s = seed >>> 0;\r\n              const rand = () => (s = (s * 1664525 + 1013904223) >>> 0) / 4294967296;\r\n              const origRandom = Math.random;\r\n              Math.random = rand;\r\n              const success = await musicSystemRef.current.startComposition(currentStyle);\r\n              Math.random = origRandom;\r\n              if (!success) {\r\n                console.warn('Failed to start music composition');\r\n                setHasError(true);\r\n              }\r\n            } else {\r\n              const success = await musicSystemRef.current.startComposition(currentStyle);\r\n              if (!success) {\r\n                console.warn('Failed to start music composition');\r\n                setHasError(true);\r\n              }\r\n            }\r\n          }\r\n        } else if (musicSystemRef.current && musicSystemRef.current.isPlaying) {\r\n          // Stop when toggled off\r\n          musicSystemRef.current.stop();\r\n        }\r\n      } catch (error) {\r\n        console.error('Music playback error:', error);\r\n        setHasError(true);\r\n      } finally {\r\n        setIsLoading(false);\r\n      }\r\n    };\r\n\r\n    // Debounce to prevent excessive audio context changes (increased time for performance)\r\n    const timeoutId = setTimeout(handlePlayback, isLagging ? 200 : 100);\r\n    return () => clearTimeout(timeoutId);\r\n  }, [isPlaying, currentStyle, hasError, seed]);\r\n\r\n  // Memoized style change handler to prevent recreating on every render\r\n  const handleStyleChange = useCallback(async (newStyle) => {\r\n    if (musicSystemRef.current) {\r\n      // Instead of stopping completely, we'll transition to the new style\r\n      try {\r\n        await musicSystemRef.current.transitionToStyle(newStyle);\r\n        setCurrentStyle(newStyle);\r\n      } catch (error) {\r\n        console.error('Error transitioning to new style:', error);\r\n        // Fallback to old behavior if transition fails\r\n        musicSystemRef.current.stop();\r\n        setCurrentStyle(newStyle);\r\n        if (isPlaying) {\r\n          setTimeout(() => {\r\n            musicSystemRef.current.startComposition(newStyle);\r\n          }, 100);\r\n        }\r\n      }\r\n    } else {\r\n      setCurrentStyle(newStyle);\r\n    }\r\n  }, [isPlaying]);\r\n\r\n  return (\r\n    <AudioErrorBoundary>\r\n      <div className={`gothic-music-generator ${isPlaying ? 'playing' : ''}`}>\r\n        {hasError && (\r\n          <div className=\"music-error\" style={{ \r\n            padding: '10px', \r\n            color: '#E8D5B7', \r\n            background: 'rgba(139, 69, 19, 0.2)',\r\n            borderRadius: '8px',\r\n            marginBottom: '10px',\r\n            textAlign: 'center'\r\n          }}>\r\n            <p>üéµ –ú—É–∑—ã–∫–∞–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞</p>\r\n            <button \r\n              onClick={() => {\r\n                setHasError(false);\r\n                window.location.reload();\r\n              }}\r\n              style={{\r\n                background: 'none',\r\n                border: '1px solid #E8D5B7',\r\n                color: '#E8D5B7',\r\n                padding: '5px 10px',\r\n                borderRadius: '4px',\r\n                cursor: 'pointer',\r\n                fontSize: '12px'\r\n              }}\r\n            >\r\n              –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–Ω–æ–≤–∞\r\n            </button>\r\n          </div>\r\n        )}\r\n        \r\n        {isLoading && (\r\n          <div className=\"music-loading\">\r\n            <span>üéµ –°–æ–∑–¥–∞–Ω–∏–µ –≥–æ—Ç–∏—á–µ—Å–∫–æ–π –∫–æ–º–ø–æ–∑–∏—Ü–∏–∏...</span>\r\n          </div>\r\n        )}\r\n        \r\n        {!hasError && (\r\n          <div className=\"music-controls\">\r\n        <button \r\n          className={`style-btn ${currentStyle === 'ambient' ? 'active' : ''}`}\r\n          onClick={() => handleStyleChange('ambient')}\r\n        >\r\n          üåô Ambient\r\n        </button>\r\n        <button \r\n          className={`style-btn ${currentStyle === 'rhythmic' ? 'active' : ''}`}\r\n          onClick={() => handleStyleChange('rhythmic')}\r\n        >\r\n          ‚ö° Gothic\r\n        </button>\r\n        <button \r\n          className={`style-btn ${currentStyle === 'dark' ? 'active' : ''}`}\r\n          onClick={() => handleStyleChange('dark')}\r\n        >\r\n          üíÄ Dark\r\n        </button>\r\n        <button \r\n          className={`style-btn ${currentStyle === 'cathedral' ? 'active' : ''}`}\r\n          onClick={() => handleStyleChange('cathedral')}\r\n        >\r\n          üè∞ Cathedral\r\n        </button>\r\n        <button \r\n          className={`style-btn ${currentStyle === 'ritual' ? 'active' : ''}`}\r\n          onClick={() => handleStyleChange('ritual')}\r\n        >\r\n          üîÆ Ritual\r\n        </button>\r\n          </div>\r\n        )}\r\n      </div>\r\n    </AudioErrorBoundary>\r\n  );\r\n});\r\n\r\nexport default GothicMusicGenerator;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}