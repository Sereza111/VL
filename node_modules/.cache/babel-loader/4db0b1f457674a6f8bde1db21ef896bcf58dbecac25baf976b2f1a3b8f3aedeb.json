{"ast":null,"code":"import _objectSpread from \"/var/www/www-root/data/www/knigavl.ru/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";\nimport _objectWithoutProperties from \"/var/www/www-root/data/www/knigavl.ru/node_modules/@babel/runtime/helpers/esm/objectWithoutProperties.js\";\nconst _excluded = [\"offset\"];\nimport { interceptConnections } from '../helpers/intercept-connections';\nexport const createNativeConstantSourceNodeFakerFactory = (addSilentConnection, createNativeAudioBufferSourceNode, createNativeGainNode, monitorConnections) => {\n  return (nativeContext, _ref) => {\n    let {\n        offset\n      } = _ref,\n      audioNodeOptions = _objectWithoutProperties(_ref, _excluded);\n    const audioBuffer = nativeContext.createBuffer(1, 2, 44100);\n    const audioBufferSourceNode = createNativeAudioBufferSourceNode(nativeContext, {\n      buffer: null,\n      channelCount: 2,\n      channelCountMode: 'max',\n      channelInterpretation: 'speakers',\n      loop: false,\n      loopEnd: 0,\n      loopStart: 0,\n      playbackRate: 1\n    });\n    const gainNode = createNativeGainNode(nativeContext, _objectSpread(_objectSpread({}, audioNodeOptions), {}, {\n      gain: offset\n    }));\n    // Bug #5: Safari does not support copyFromChannel() and copyToChannel().\n    const channelData = audioBuffer.getChannelData(0);\n    // Bug #95: Safari does not play or loop one sample buffers.\n    channelData[0] = 1;\n    channelData[1] = 1;\n    audioBufferSourceNode.buffer = audioBuffer;\n    audioBufferSourceNode.loop = true;\n    const nativeConstantSourceNodeFaker = {\n      get bufferSize() {\n        return undefined;\n      },\n      get channelCount() {\n        return gainNode.channelCount;\n      },\n      set channelCount(value) {\n        gainNode.channelCount = value;\n      },\n      get channelCountMode() {\n        return gainNode.channelCountMode;\n      },\n      set channelCountMode(value) {\n        gainNode.channelCountMode = value;\n      },\n      get channelInterpretation() {\n        return gainNode.channelInterpretation;\n      },\n      set channelInterpretation(value) {\n        gainNode.channelInterpretation = value;\n      },\n      get context() {\n        return gainNode.context;\n      },\n      get inputs() {\n        return [];\n      },\n      get numberOfInputs() {\n        return audioBufferSourceNode.numberOfInputs;\n      },\n      get numberOfOutputs() {\n        return gainNode.numberOfOutputs;\n      },\n      get offset() {\n        return gainNode.gain;\n      },\n      get onended() {\n        return audioBufferSourceNode.onended;\n      },\n      set onended(value) {\n        audioBufferSourceNode.onended = value;\n      },\n      addEventListener() {\n        return audioBufferSourceNode.addEventListener(arguments.length <= 0 ? undefined : arguments[0], arguments.length <= 1 ? undefined : arguments[1], arguments.length <= 2 ? undefined : arguments[2]);\n      },\n      dispatchEvent() {\n        return audioBufferSourceNode.dispatchEvent(arguments.length <= 0 ? undefined : arguments[0]);\n      },\n      removeEventListener() {\n        return audioBufferSourceNode.removeEventListener(arguments.length <= 0 ? undefined : arguments[0], arguments.length <= 1 ? undefined : arguments[1], arguments.length <= 2 ? undefined : arguments[2]);\n      },\n      start() {\n        let when = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 0;\n        audioBufferSourceNode.start.call(audioBufferSourceNode, when);\n      },\n      stop() {\n        let when = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 0;\n        audioBufferSourceNode.stop.call(audioBufferSourceNode, when);\n      }\n    };\n    const whenConnected = () => audioBufferSourceNode.connect(gainNode);\n    const whenDisconnected = () => audioBufferSourceNode.disconnect(gainNode);\n    // Bug #175: Safari will not fire an ended event if the AudioBufferSourceNode is unconnected.\n    addSilentConnection(nativeContext, audioBufferSourceNode);\n    return monitorConnections(interceptConnections(nativeConstantSourceNodeFaker, gainNode), whenConnected, whenDisconnected);\n  };\n};","map":{"version":3,"names":["interceptConnections","createNativeConstantSourceNodeFakerFactory","addSilentConnection","createNativeAudioBufferSourceNode","createNativeGainNode","monitorConnections","nativeContext","_ref","offset","audioNodeOptions","_objectWithoutProperties","_excluded","audioBuffer","createBuffer","audioBufferSourceNode","buffer","channelCount","channelCountMode","channelInterpretation","loop","loopEnd","loopStart","playbackRate","gainNode","_objectSpread","gain","channelData","getChannelData","nativeConstantSourceNodeFaker","bufferSize","undefined","value","context","inputs","numberOfInputs","numberOfOutputs","onended","addEventListener","arguments","length","dispatchEvent","removeEventListener","start","when","call","stop","whenConnected","connect","whenDisconnected","disconnect"],"sources":["/var/www/www-root/data/www/knigavl.ru/node_modules/standardized-audio-context/src/factories/native-constant-source-node-faker-factory.ts"],"sourcesContent":["import { interceptConnections } from '../helpers/intercept-connections';\nimport {\n    TNativeAudioBufferSourceNode,\n    TNativeAudioNode,\n    TNativeConstantSourceNode,\n    TNativeConstantSourceNodeFakerFactoryFactory\n} from '../types';\n\nexport const createNativeConstantSourceNodeFakerFactory: TNativeConstantSourceNodeFakerFactoryFactory = (\n    addSilentConnection,\n    createNativeAudioBufferSourceNode,\n    createNativeGainNode,\n    monitorConnections\n) => {\n    return (nativeContext, { offset, ...audioNodeOptions }) => {\n        const audioBuffer = nativeContext.createBuffer(1, 2, 44100);\n        const audioBufferSourceNode = createNativeAudioBufferSourceNode(nativeContext, {\n            buffer: null,\n            channelCount: 2,\n            channelCountMode: 'max',\n            channelInterpretation: 'speakers',\n            loop: false,\n            loopEnd: 0,\n            loopStart: 0,\n            playbackRate: 1\n        });\n        const gainNode = createNativeGainNode(nativeContext, { ...audioNodeOptions, gain: offset });\n\n        // Bug #5: Safari does not support copyFromChannel() and copyToChannel().\n        const channelData = audioBuffer.getChannelData(0);\n\n        // Bug #95: Safari does not play or loop one sample buffers.\n        channelData[0] = 1;\n        channelData[1] = 1;\n\n        audioBufferSourceNode.buffer = audioBuffer;\n        audioBufferSourceNode.loop = true;\n\n        const nativeConstantSourceNodeFaker = {\n            get bufferSize(): undefined {\n                return undefined;\n            },\n            get channelCount(): number {\n                return gainNode.channelCount;\n            },\n            set channelCount(value) {\n                gainNode.channelCount = value;\n            },\n            get channelCountMode(): TNativeConstantSourceNode['channelCountMode'] {\n                return gainNode.channelCountMode;\n            },\n            set channelCountMode(value) {\n                gainNode.channelCountMode = value;\n            },\n            get channelInterpretation(): TNativeConstantSourceNode['channelInterpretation'] {\n                return gainNode.channelInterpretation;\n            },\n            set channelInterpretation(value) {\n                gainNode.channelInterpretation = value;\n            },\n            get context(): TNativeConstantSourceNode['context'] {\n                return gainNode.context;\n            },\n            get inputs(): TNativeAudioNode[] {\n                return [];\n            },\n            get numberOfInputs(): number {\n                return audioBufferSourceNode.numberOfInputs;\n            },\n            get numberOfOutputs(): number {\n                return gainNode.numberOfOutputs;\n            },\n            get offset(): TNativeConstantSourceNode['offset'] {\n                return gainNode.gain;\n            },\n            get onended(): TNativeConstantSourceNode['onended'] {\n                return audioBufferSourceNode.onended;\n            },\n            set onended(value) {\n                audioBufferSourceNode.onended = <TNativeAudioBufferSourceNode['onended']>value;\n            },\n            addEventListener(...args: any[]): void {\n                return audioBufferSourceNode.addEventListener(args[0], args[1], args[2]);\n            },\n            dispatchEvent(...args: any[]): boolean {\n                return audioBufferSourceNode.dispatchEvent(args[0]);\n            },\n            removeEventListener(...args: any[]): void {\n                return audioBufferSourceNode.removeEventListener(args[0], args[1], args[2]);\n            },\n            start(when = 0): void {\n                audioBufferSourceNode.start.call(audioBufferSourceNode, when);\n            },\n            stop(when = 0): void {\n                audioBufferSourceNode.stop.call(audioBufferSourceNode, when);\n            }\n        };\n\n        const whenConnected = () => audioBufferSourceNode.connect(gainNode);\n        const whenDisconnected = () => audioBufferSourceNode.disconnect(gainNode);\n\n        // Bug #175: Safari will not fire an ended event if the AudioBufferSourceNode is unconnected.\n        addSilentConnection(nativeContext, audioBufferSourceNode);\n\n        return monitorConnections(interceptConnections(nativeConstantSourceNodeFaker, gainNode), whenConnected, whenDisconnected);\n    };\n};\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}