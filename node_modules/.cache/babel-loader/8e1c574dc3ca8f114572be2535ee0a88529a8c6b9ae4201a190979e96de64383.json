{"ast":null,"code":"import calc from './calc.js';\nconst literal = {\n  even: n => !(n % 2),\n  odd: n => !!(n % 2)\n};\n\n/**\n * TODO: optimization\n */\nfunction nth(input, curr, max) {\n  for (let i = 0; i <= max; ++i) {\n    if (calc(input, {\n      n: i\n    }) == curr) {\n      return true;\n    }\n  }\n}\nfunction get_selector(offset) {\n  let selector = '';\n  if (offset == 0) {\n    selector = '$:hover';\n  } else if (offset > 0) {\n    selector = \"$:hover \".concat('+*'.repeat(offset));\n  } else {\n    selector = \":has(+ \".concat('*+'.repeat(Math.abs(offset + 1)), \" $:hover)\");\n  }\n  return selector;\n}\nexport default {\n  at(_ref) {\n    let {\n      x,\n      y\n    } = _ref;\n    return (x1, y1) => x == x1 && y == y1;\n  },\n  nth(_ref2) {\n    let {\n      count,\n      grid\n    } = _ref2;\n    return function () {\n      for (var _len = arguments.length, exprs = new Array(_len), _key = 0; _key < _len; _key++) {\n        exprs[_key] = arguments[_key];\n      }\n      return exprs.some(expr => literal[expr] ? literal[expr](count) : nth(expr, count, grid.count));\n    };\n  },\n  row(_ref3) {\n    let {\n      y,\n      grid\n    } = _ref3;\n    return function () {\n      for (var _len2 = arguments.length, exprs = new Array(_len2), _key2 = 0; _key2 < _len2; _key2++) {\n        exprs[_key2] = arguments[_key2];\n      }\n      return exprs.some(expr => literal[expr] ? literal[expr](y) : nth(expr, y, grid.y));\n    };\n  },\n  col(_ref4) {\n    let {\n      x,\n      grid\n    } = _ref4;\n    return function () {\n      for (var _len3 = arguments.length, exprs = new Array(_len3), _key3 = 0; _key3 < _len3; _key3++) {\n        exprs[_key3] = arguments[_key3];\n      }\n      return exprs.some(expr => literal[expr] ? literal[expr](x) : nth(expr, x, grid.x));\n    };\n  },\n  even(_ref5) {\n    let {\n      count,\n      grid,\n      x,\n      y\n    } = _ref5;\n    return arg => literal.odd(x + y);\n  },\n  odd(_ref6) {\n    let {\n      count,\n      grid,\n      x,\n      y\n    } = _ref6;\n    return arg => literal.even(x + y);\n  },\n  random(_ref7) {\n    let {\n      random,\n      count,\n      x,\n      y,\n      grid\n    } = _ref7;\n    return function () {\n      let ratio = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : .5;\n      if (/\\D/.test(ratio)) {\n        return random() < calc('(' + ratio + ')', {\n          x,\n          X: grid.x,\n          y,\n          Y: grid.y,\n          i: count,\n          I: grid.count,\n          random\n        });\n      }\n      return random() < ratio;\n    };\n  },\n  match(_ref8) {\n    let {\n      count,\n      grid,\n      x,\n      y,\n      random\n    } = _ref8;\n    return expr => {\n      return !!calc('(' + expr + ')', {\n        x,\n        X: grid.x,\n        y,\n        Y: grid.y,\n        i: count,\n        I: grid.count,\n        random\n      });\n    };\n  },\n  hover(_ref9) {\n    let {\n      count,\n      x,\n      y,\n      grid,\n      random\n    } = _ref9;\n    return function () {\n      let selectors = [];\n      for (var _len4 = arguments.length, args = new Array(_len4), _key4 = 0; _key4 < _len4; _key4++) {\n        args[_key4] = arguments[_key4];\n      }\n      if (!args.length) {\n        selectors.push(get_selector(0));\n      }\n      for (let arg of args) {\n        let [dx, dy] = String(arg).split(/\\s+/);\n        dx = Number(dx);\n        dy = Number(dy);\n        // @hover(1, 2, 3)\n        if (Number.isNaN(dy) && !Number.isNaN(dx)) {\n          selectors.push(get_selector(dx));\n        }\n        // @hover(1 -1, 0 1)\n        if (!Number.isNaN(dx) && !Number.isNaN(dy)) {\n          let rx = dx + x;\n          let ry = dy + y;\n          if (rx >= 1 && rx <= grid.x && ry >= 1 && ry <= grid.y) {\n            let offset = dy * grid.y + dx;\n            selectors.push(get_selector(offset));\n          }\n        }\n      }\n      if (!selectors.length) {\n        return false;\n      }\n      return {\n        selector: selectors.join(',')\n      };\n    };\n  }\n};","map":{"version":3,"names":["calc","literal","even","n","odd","nth","input","curr","max","i","get_selector","offset","selector","concat","repeat","Math","abs","at","_ref","x","y","x1","y1","_ref2","count","grid","_len","arguments","length","exprs","Array","_key","some","expr","row","_ref3","_len2","_key2","col","_ref4","_len3","_key3","_ref5","arg","_ref6","random","_ref7","ratio","undefined","test","X","Y","I","match","_ref8","hover","_ref9","selectors","_len4","args","_key4","push","dx","dy","String","split","Number","isNaN","rx","ry","join"],"sources":["/var/www/www-root/data/www/knigavl.ru/node_modules/css-doodle/src/selector.js"],"sourcesContent":["import calc from './calc.js';\n\nconst literal = {\n  even: n => !(n % 2),\n  odd:  n => !!(n % 2),\n};\n\n/**\n * TODO: optimization\n */\nfunction nth(input, curr, max) {\n  for (let i = 0; i <= max; ++i) {\n    if (calc(input, { n: i }) == curr) {\n      return true;\n    }\n  }\n}\n\nfunction get_selector(offset) {\n  let selector = '';\n  if (offset == 0) {\n    selector = '$:hover';\n  }\n  else if (offset > 0) {\n    selector = `$:hover ${'+*'.repeat(offset)}`;\n  }\n  else {\n    selector = `:has(+ ${'*+'.repeat(Math.abs(offset + 1))} $:hover)`;\n  }\n  return selector;\n}\n\nexport default {\n\n  at({ x, y }) {\n    return (x1, y1) => (x == x1 && y == y1);\n  },\n\n  nth({ count, grid }) {\n    return (...exprs) => exprs.some(expr =>\n      literal[expr]\n        ? literal[expr](count)\n        : nth(expr, count, grid.count)\n    );\n  },\n\n  row({ y, grid }) {\n    return (...exprs) => exprs.some(expr =>\n      literal[expr]\n        ? literal[expr](y)\n        : nth(expr, y, grid.y)\n    );\n  },\n\n  col({ x, grid }) {\n    return (...exprs) => exprs.some(expr =>\n      literal[expr]\n        ? literal[expr](x)\n        : nth(expr, x, grid.x)\n    );\n  },\n\n  even({ count, grid, x, y }) {\n    return arg => literal.odd(x + y);\n  },\n\n  odd({ count, grid, x, y}) {\n    return arg => literal.even(x + y);\n  },\n\n  random({ random, count, x, y, grid }) {\n    return (ratio = .5) => {\n      if (/\\D/.test(ratio)) {\n        return random() < calc('(' + ratio + ')', {\n          x, X: grid.x,\n          y, Y: grid.y,\n          i: count, I: grid.count,\n          random,\n        });\n      }\n      return random() < ratio;\n    }\n  },\n\n  match({ count, grid, x, y, random }) {\n    return expr => {\n      return !!calc('(' + expr + ')', {\n        x, X: grid.x,\n        y, Y: grid.y,\n        i: count, I: grid.count,\n        random,\n      });\n    }\n  },\n\n  hover({ count, x, y, grid, random }) {\n    return (...args) => {\n      let selectors = [];\n      if (!args.length) {\n        selectors.push(get_selector(0));\n      }\n      for (let arg of args) {\n        let [dx, dy] = String(arg).split(/\\s+/);\n        dx = Number(dx);\n        dy = Number(dy);\n        // @hover(1, 2, 3)\n        if (Number.isNaN(dy) && !Number.isNaN(dx)) {\n          selectors.push(get_selector(dx));\n        }\n        // @hover(1 -1, 0 1)\n        if (!Number.isNaN(dx) && !Number.isNaN(dy)) {\n          let rx = dx + x;\n          let ry = dy + y;\n          if (rx >= 1 && rx <= grid.x && ry >= 1 && ry <= grid.y) {\n            let offset = (dy * grid.y) + dx;\n            selectors.push(get_selector(offset));\n          }\n        }\n      }\n      if (!selectors.length) {\n        return false;\n      }\n      return {\n        selector: selectors.join(',')\n      }\n    }\n  },\n\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}