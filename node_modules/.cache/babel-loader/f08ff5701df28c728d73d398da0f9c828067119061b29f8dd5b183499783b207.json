{"ast":null,"code":"import React,{useEffect,useRef,useState}from'react';import anime from'animejs/lib/anime.js';import GenerativeIcon from'../../components/GenerativeIcon';import'./mini.css';// Tap-timing crystal mining: hit the pulse at the sweet spot to get shards\nimport{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const CrystalMine=_ref=>{let{onClose,onMine,baseReward=0.03,maxAttempts=5}=_ref;const barRef=useRef(null);const markerRef=useRef(null);const[direction,setDirection]=useState(1);const[pos,setPos]=useState(0.1);const[score,setScore]=useState(0);const[attempts,setAttempts]=useState(0);const rafRef=useRef(0);useEffect(()=>{const tick=()=>{setPos(prev=>{let np=prev+0.009*direction;if(np>=0.98){np=0.98;setDirection(-1);}if(np<=0.02){np=0.02;setDirection(1);}return np;});rafRef.current=requestAnimationFrame(tick);};rafRef.current=requestAnimationFrame(tick);return()=>cancelAnimationFrame(rafRef.current);},[direction]);const handleHit=()=>{if(attempts>=maxAttempts)return;// Ideal zone is center 0.45 - 0.55\nconst dist=Math.abs(pos-0.5);let mult=0;if(dist<0.02)mult=3;else if(dist<0.06)mult=2;else if(dist<0.12)mult=1;setScore(s=>s+mult);setAttempts(a=>a+1);if(markerRef.current){anime({targets:markerRef.current,scale:[1,1.2,1],duration:260,easing:'easeOutQuad'});}// Impact flash\nconst bar=barRef.current;if(bar){anime({targets:bar,background:['rgba(60,47,79,0.6)','rgba(168,199,250,0.35)','rgba(60,47,79,0.6)'],duration:300,easing:'easeOutSine'});}};const handleClaim=()=>{const reward=baseReward*(1+score*0.2);if(onMine)onMine(reward);};return/*#__PURE__*/_jsx(\"div\",{className:\"mini-overlay\",onClick:onClose,children:/*#__PURE__*/_jsxs(\"div\",{className:\"mini-panel\",onClick:e=>e.stopPropagation(),children:[/*#__PURE__*/_jsxs(\"div\",{className:\"mini-header\",children:[/*#__PURE__*/_jsx(GenerativeIcon,{name:\"crystal\",size:20}),/*#__PURE__*/_jsx(\"span\",{children:\"\\u041A\\u0440\\u0438\\u0441\\u0442\\u0430\\u043B\\u044C\\u043D\\u0430\\u044F \\u0436\\u0438\\u043B\\u0430\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"mini-body\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"mine\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"bar\",ref:barRef,children:[/*#__PURE__*/_jsx(\"div\",{className:\"sweet sweet-1\"}),/*#__PURE__*/_jsx(\"div\",{className:\"sweet sweet-2\"}),/*#__PURE__*/_jsx(\"div\",{className:\"marker\",ref:markerRef,style:{left:\"\".concat(pos*100,\"%\")}})]}),/*#__PURE__*/_jsx(\"button\",{className:\"btn primary\",onClick:handleHit,disabled:attempts>=maxAttempts,children:attempts>=maxAttempts?'Попытки закончились':\"\\u0423\\u0434\\u0430\\u0440\\u0438\\u0442\\u044C (\".concat(attempts,\"/\").concat(maxAttempts,\")\")})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"mini-actions\",children:[/*#__PURE__*/_jsx(\"button\",{className:\"btn\",onClick:onClose,children:\"\\u0417\\u0430\\u043A\\u0440\\u044B\\u0442\\u044C\"}),/*#__PURE__*/_jsxs(\"button\",{className:\"btn primary\",onClick:handleClaim,children:[\"\\u0417\\u0430\\u0431\\u0440\\u0430\\u0442\\u044C \\u043A\\u0440\\u0438\\u0441\\u0442\\u0430\\u043B\\u043B\\u044B (\\u0441\\u0447\\u0451\\u0442: \",score,\")\"]})]})]})]})});};export default/*#__PURE__*/React.memo(CrystalMine);","map":{"version":3,"names":["React","useEffect","useRef","useState","anime","GenerativeIcon","jsx","_jsx","jsxs","_jsxs","CrystalMine","_ref","onClose","onMine","baseReward","maxAttempts","barRef","markerRef","direction","setDirection","pos","setPos","score","setScore","attempts","setAttempts","rafRef","tick","prev","np","current","requestAnimationFrame","cancelAnimationFrame","handleHit","dist","Math","abs","mult","s","a","targets","scale","duration","easing","bar","background","handleClaim","reward","className","onClick","children","e","stopPropagation","name","size","ref","style","left","concat","disabled","memo"],"sources":["/var/www/www-root/data/www/knigavl.ru/src/screens/mini/CrystalMine.js"],"sourcesContent":["import React, { useEffect, useRef, useState } from 'react';\r\nimport anime from 'animejs/lib/anime.js';\r\nimport GenerativeIcon from '../../components/GenerativeIcon';\r\nimport './mini.css';\r\n\r\n// Tap-timing crystal mining: hit the pulse at the sweet spot to get shards\r\nconst CrystalMine = ({ onClose, onMine, baseReward = 0.03, maxAttempts = 5 }) => {\r\n  const barRef = useRef(null);\r\n  const markerRef = useRef(null);\r\n  const [direction, setDirection] = useState(1);\r\n  const [pos, setPos] = useState(0.1);\r\n  const [score, setScore] = useState(0);\r\n  const [attempts, setAttempts] = useState(0);\r\n  const rafRef = useRef(0);\r\n\r\n  useEffect(() => {\r\n    const tick = () => {\r\n      setPos(prev => {\r\n        let np = prev + 0.009 * direction;\r\n        if (np >= 0.98) { np = 0.98; setDirection(-1); }\r\n        if (np <= 0.02) { np = 0.02; setDirection(1); }\r\n        return np;\r\n      });\r\n      rafRef.current = requestAnimationFrame(tick);\r\n    };\r\n    rafRef.current = requestAnimationFrame(tick);\r\n    return () => cancelAnimationFrame(rafRef.current);\r\n  }, [direction]);\r\n\r\n  const handleHit = () => {\r\n    if (attempts >= maxAttempts) return;\r\n    \r\n    // Ideal zone is center 0.45 - 0.55\r\n    const dist = Math.abs(pos - 0.5);\r\n    let mult = 0;\r\n    if (dist < 0.02) mult = 3;\r\n    else if (dist < 0.06) mult = 2;\r\n    else if (dist < 0.12) mult = 1;\r\n    setScore(s => s + mult);\r\n    setAttempts(a => a + 1);\r\n    \r\n    if (markerRef.current) {\r\n      anime({ targets: markerRef.current, scale: [1, 1.2, 1], duration: 260, easing: 'easeOutQuad' });\r\n    }\r\n    // Impact flash\r\n    const bar = barRef.current;\r\n    if (bar) {\r\n      anime({ targets: bar, background: ['rgba(60,47,79,0.6)','rgba(168,199,250,0.35)','rgba(60,47,79,0.6)'], duration: 300, easing: 'easeOutSine' });\r\n    }\r\n  };\r\n\r\n  const handleClaim = () => {\r\n    const reward = baseReward * (1 + score * 0.2);\r\n    if (onMine) onMine(reward);\r\n  };\r\n\r\n  return (\r\n    <div className=\"mini-overlay\" onClick={onClose}>\r\n      <div className=\"mini-panel\" onClick={(e) => e.stopPropagation()}>\r\n        <div className=\"mini-header\">\r\n          <GenerativeIcon name=\"crystal\" size={20} />\r\n          <span>Кристальная жила</span>\r\n        </div>\r\n        <div className=\"mini-body\">\r\n          <div className=\"mine\">\r\n            <div className=\"bar\" ref={barRef}>\r\n              <div className=\"sweet sweet-1\" />\r\n              <div className=\"sweet sweet-2\" />\r\n              <div className=\"marker\" ref={markerRef} style={{ left: `${pos*100}%` }} />\r\n            </div>\r\n            <button className=\"btn primary\" onClick={handleHit} disabled={attempts >= maxAttempts}>\r\n              {attempts >= maxAttempts ? 'Попытки закончились' : `Ударить (${attempts}/${maxAttempts})`}\r\n            </button>\r\n          </div>\r\n          <div className=\"mini-actions\">\r\n            <button className=\"btn\" onClick={onClose}>Закрыть</button>\r\n            <button className=\"btn primary\" onClick={handleClaim}>Забрать кристаллы (счёт: {score})</button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default React.memo(CrystalMine);\r\n\r\n\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}