{"ast":null,"code":"import { un_entity, next_id } from '../utils/index.js';\nimport Cache from '../utils/cache.js';\nconst nextId = next_id();\nfunction draw_canvas(code) {\n  let result = Cache.get(code);\n  if (result) {\n    return Promise.resolve(result);\n  }\n  let name = nextId('css-doodle-paint');\n  let wrapped = generate(name, code);\n  let blob = new Blob([wrapped], {\n    type: 'text/javascript'\n  });\n  try {\n    if (CSS.paintWorklet) {\n      CSS.paintWorklet.addModule(URL.createObjectURL(blob));\n    }\n  } catch (e) {}\n  return Promise.resolve(Cache.set(code, \"paint(\".concat(name, \")\")));\n}\nfunction generate(name, code) {\n  code = un_entity(code);\n  // make it so\n  if (!code.includes('paint(')) {\n    code = \"\\n      paint(ctx, {width, height}, props) {\\n        \".concat(code, \"\\n      }\\n    \");\n  }\n  return \"\\n    registerPaint('\".concat(name, \"', class {\\n      \").concat(code, \"\\n    })\\n  \");\n}\nexport { draw_canvas };","map":{"version":3,"names":["un_entity","next_id","Cache","nextId","draw_canvas","code","result","get","Promise","resolve","name","wrapped","generate","blob","Blob","type","CSS","paintWorklet","addModule","URL","createObjectURL","e","set","concat","includes"],"sources":["/var/www/www-root/data/www/knigavl.ru/node_modules/css-doodle/src/generator/canvas.js"],"sourcesContent":["import { un_entity, next_id } from '../utils/index.js';\nimport Cache from '../utils/cache.js';\n\nconst nextId = next_id();\n\nfunction draw_canvas(code) {\n  let result = Cache.get(code);\n  if (result) {\n    return Promise.resolve(result);\n  }\n  let name = nextId('css-doodle-paint');\n  let wrapped = generate(name, code);\n\n  let blob = new Blob([wrapped], { type: 'text/javascript' });\n  try {\n    if (CSS.paintWorklet) {\n      CSS.paintWorklet.addModule(URL.createObjectURL(blob));\n    }\n  } catch(e) {}\n\n  return Promise.resolve(Cache.set(code, `paint(${name})`));\n}\n\nfunction generate(name, code) {\n  code = un_entity(code);\n  // make it so\n  if (!code.includes('paint(')) {\n    code = `\n      paint(ctx, {width, height}, props) {\n        ${code}\n      }\n    `\n  }\n  return `\n    registerPaint('${name}', class {\n      ${ code }\n    })\n  `;\n}\n\nexport {\n  draw_canvas,\n}\n"],"mappings":"AAAA,SAASA,SAAS,EAAEC,OAAO,QAAQ,mBAAmB;AACtD,OAAOC,KAAK,MAAM,mBAAmB;AAErC,MAAMC,MAAM,GAAGF,OAAO,CAAC,CAAC;AAExB,SAASG,WAAWA,CAACC,IAAI,EAAE;EACzB,IAAIC,MAAM,GAAGJ,KAAK,CAACK,GAAG,CAACF,IAAI,CAAC;EAC5B,IAAIC,MAAM,EAAE;IACV,OAAOE,OAAO,CAACC,OAAO,CAACH,MAAM,CAAC;EAChC;EACA,IAAII,IAAI,GAAGP,MAAM,CAAC,kBAAkB,CAAC;EACrC,IAAIQ,OAAO,GAAGC,QAAQ,CAACF,IAAI,EAAEL,IAAI,CAAC;EAElC,IAAIQ,IAAI,GAAG,IAAIC,IAAI,CAAC,CAACH,OAAO,CAAC,EAAE;IAAEI,IAAI,EAAE;EAAkB,CAAC,CAAC;EAC3D,IAAI;IACF,IAAIC,GAAG,CAACC,YAAY,EAAE;MACpBD,GAAG,CAACC,YAAY,CAACC,SAAS,CAACC,GAAG,CAACC,eAAe,CAACP,IAAI,CAAC,CAAC;IACvD;EACF,CAAC,CAAC,OAAMQ,CAAC,EAAE,CAAC;EAEZ,OAAOb,OAAO,CAACC,OAAO,CAACP,KAAK,CAACoB,GAAG,CAACjB,IAAI,WAAAkB,MAAA,CAAWb,IAAI,MAAG,CAAC,CAAC;AAC3D;AAEA,SAASE,QAAQA,CAACF,IAAI,EAAEL,IAAI,EAAE;EAC5BA,IAAI,GAAGL,SAAS,CAACK,IAAI,CAAC;EACtB;EACA,IAAI,CAACA,IAAI,CAACmB,QAAQ,CAAC,QAAQ,CAAC,EAAE;IAC5BnB,IAAI,4DAAAkB,MAAA,CAEElB,IAAI,oBAET;EACH;EACA,+BAAAkB,MAAA,CACmBb,IAAI,wBAAAa,MAAA,CAChBlB,IAAI;AAGb;AAEA,SACED,WAAW","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}