{"ast":null,"code":"import _objectSpread from \"/var/www/www-root/data/www/knigavl.ru/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";\nimport _objectWithoutProperties from \"/var/www/www-root/data/www/knigavl.ru/node_modules/@babel/runtime/helpers/esm/objectWithoutProperties.js\";\nconst _excluded = [\"blendFunction\", \"worldFocusDistance\", \"worldFocusRange\", \"focusDistance\", \"focusRange\", \"focalLength\", \"bokehScale\", \"resolutionScale\", \"resolutionX\", \"resolutionY\", \"width\", \"height\", \"target\", \"depthTexture\"];\nimport { jsx } from \"react/jsx-runtime\";\nimport { DepthOfFieldEffect, MaskFunction } from \"postprocessing\";\nimport { forwardRef, useContext, useMemo, useEffect } from \"react\";\nimport { Vector3 } from \"three\";\nimport { EffectComposerContext } from \"../EffectComposer.js\";\nconst DepthOfField = forwardRef(function DepthOfField2(_ref, ref) {\n  let {\n      blendFunction,\n      worldFocusDistance,\n      worldFocusRange,\n      focusDistance,\n      focusRange,\n      focalLength,\n      bokehScale,\n      resolutionScale,\n      resolutionX,\n      resolutionY,\n      width,\n      height,\n      target,\n      depthTexture\n    } = _ref,\n    props = _objectWithoutProperties(_ref, _excluded);\n  const {\n    camera\n  } = useContext(EffectComposerContext);\n  const autoFocus = target != null;\n  const effect = useMemo(() => {\n    const effect2 = new DepthOfFieldEffect(camera, {\n      blendFunction,\n      worldFocusDistance,\n      worldFocusRange,\n      focusDistance,\n      focusRange,\n      focalLength,\n      bokehScale,\n      resolutionScale,\n      resolutionX,\n      resolutionY,\n      width,\n      height\n    });\n    if (autoFocus) effect2.target = new Vector3();\n    if (depthTexture) effect2.setDepthTexture(depthTexture.texture, depthTexture.packing);\n    const maskPass = effect2.maskPass;\n    maskPass.maskFunction = MaskFunction.MULTIPLY_RGB_SET_ALPHA;\n    return effect2;\n  }, [camera, blendFunction, worldFocusDistance, worldFocusRange, focusDistance, focusRange, focalLength, bokehScale, resolutionScale, resolutionX, resolutionY, width, height, autoFocus, depthTexture]);\n  useEffect(() => {\n    return () => {\n      effect.dispose();\n    };\n  }, [effect]);\n  return /* @__PURE__ */jsx(\"primitive\", _objectSpread(_objectSpread({}, props), {}, {\n    ref,\n    object: effect,\n    target\n  }));\n});\nexport { DepthOfField };","map":{"version":3,"names":["DepthOfField","forwardRef","DepthOfField2","_ref","ref","blendFunction","worldFocusDistance","worldFocusRange","focusDistance","focusRange","focalLength","bokehScale","resolutionScale","resolutionX","resolutionY","width","height","target","depthTexture","props","_objectWithoutProperties","_excluded","camera","useContext","EffectComposerContext","autoFocus","effect","useMemo","effect2","DepthOfFieldEffect","Vector3","setDepthTexture","texture","packing","maskPass","maskFunction","MaskFunction","MULTIPLY_RGB_SET_ALPHA","useEffect","dispose","jsx","_objectSpread","object"],"sources":["/var/www/www-root/data/www/knigavl.ru/node_modules/@react-three/postprocessing/src/effects/DepthOfField.tsx"],"sourcesContent":["import { DepthOfFieldEffect, MaskFunction } from 'postprocessing'\nimport { Ref, forwardRef, useMemo, useEffect, useContext } from 'react'\nimport { ReactThreeFiber } from '@react-three/fiber'\nimport { type DepthPackingStrategies, type Texture, Vector3 } from 'three'\nimport { EffectComposerContext } from '../EffectComposer'\n\ntype DOFProps = ConstructorParameters<typeof DepthOfFieldEffect>[1] &\n  Partial<{\n    target: ReactThreeFiber.Vector3\n    depthTexture: {\n      texture: Texture\n      // TODO: narrow to DepthPackingStrategies\n      packing: number\n    }\n    // TODO: not used\n    blur: number\n  }>\n\nexport const DepthOfField = forwardRef(function DepthOfField(\n  {\n    blendFunction,\n    worldFocusDistance,\n    worldFocusRange,\n    focusDistance,\n    focusRange,\n    focalLength,\n    bokehScale,\n    resolutionScale,\n    resolutionX,\n    resolutionY,\n    width,\n    height,\n    target,\n    depthTexture,\n    ...props\n  }: DOFProps,\n  ref: Ref<DepthOfFieldEffect>\n) {\n  const { camera } = useContext(EffectComposerContext)\n  const autoFocus = target != null\n  const effect = useMemo(() => {\n    const effect = new DepthOfFieldEffect(camera, {\n      blendFunction,\n      worldFocusDistance,\n      worldFocusRange,\n      focusDistance,\n      focusRange,\n      focalLength,\n      bokehScale,\n      resolutionScale,\n      resolutionX,\n      resolutionY,\n      width,\n      height,\n    })\n    // Creating a target enables autofocus, R3F will set via props\n    if (autoFocus) effect.target = new Vector3()\n    // Depth texture for depth picking with optional packing strategy\n    if (depthTexture) effect.setDepthTexture(depthTexture.texture, depthTexture.packing as DepthPackingStrategies)\n    // Temporary fix that restores DOF 6.21.3 behavior, everything since then lets shapes leak through the blur\n    const maskPass = (effect as any).maskPass\n    maskPass.maskFunction = MaskFunction.MULTIPLY_RGB_SET_ALPHA\n    return effect\n  }, [\n    camera,\n    blendFunction,\n    worldFocusDistance,\n    worldFocusRange,\n    focusDistance,\n    focusRange,\n    focalLength,\n    bokehScale,\n    resolutionScale,\n    resolutionX,\n    resolutionY,\n    width,\n    height,\n    autoFocus,\n    depthTexture,\n  ])\n\n  useEffect(() => {\n    return () => {\n      effect.dispose()\n    }\n  }, [effect])\n\n  return <primitive {...props} ref={ref} object={effect} target={target} />\n})\n"],"mappings":";;;;;;;;AAkBa,MAAAA,YAAA,GAAeC,UAAA,CAAW,SAASC,cAAAC,IAAA,EAkB9CC,GAAA,EACA;EAAA,IAlBA;MACEC,aAAA;MACAC,kBAAA;MACAC,eAAA;MACAC,aAAA;MACAC,UAAA;MACAC,WAAA;MACAC,UAAA;MACAC,eAAA;MACAC,WAAA;MACAC,WAAA;MACAC,KAAA;MACAC,MAAA;MACAC,MAAA;MACAC;IAEF,IAAAf,IAAA;IADKgB,KAAA,GAAAC,wBAAA,CAAAjB,IAAA,EAAAkB,SAAA;EAIL,MAAM;IAAEC;EAAA,IAAWC,UAAA,CAAWC,qBAAqB;EACnD,MAAMC,SAAA,GAAYR,MAAA,IAAU;EACtB,MAAAS,MAAA,GAASC,OAAA,CAAQ,MAAM;IACrB,MAAAC,OAAA,GAAS,IAAIC,kBAAA,CAAmBP,MAAA,EAAQ;MAC5CjB,aAAA;MACAC,kBAAA;MACAC,eAAA;MACAC,aAAA;MACAC,UAAA;MACAC,WAAA;MACAC,UAAA;MACAC,eAAA;MACAC,WAAA;MACAC,WAAA;MACAC,KAAA;MACAC;IAAA,CACD;IAEG,IAAAS,SAAA,EAAWG,OAAA,CAAOX,MAAA,GAAS,IAAIa,OAAA;IAE/B,IAAAZ,YAAA,EAAcU,OAAA,CAAOG,eAAA,CAAgBb,YAAA,CAAac,OAAA,EAASd,YAAA,CAAae,OAAiC;IAE7G,MAAMC,QAAA,GAAYN,OAAA,CAAeM,QAAA;IACjCA,QAAA,CAASC,YAAA,GAAeC,YAAA,CAAaC,sBAAA;IAC9B,OAAAT,OAAA;EAAA,GACN,CACDN,MAAA,EACAjB,aAAA,EACAC,kBAAA,EACAC,eAAA,EACAC,aAAA,EACAC,UAAA,EACAC,WAAA,EACAC,UAAA,EACAC,eAAA,EACAC,WAAA,EACAC,WAAA,EACAC,KAAA,EACAC,MAAA,EACAS,SAAA,EACAP,YAAA,CACD;EAEDoB,SAAA,CAAU,MAAM;IACd,OAAO,MAAM;MACXZ,MAAA,CAAOa,OAAA,CAAQ;IAAA;EACjB,GACC,CAACb,MAAM,CAAC;EAEX,sBAAAc,GAAA,CAAQ,aAAAC,aAAA,CAAAA,aAAA,KAActB,KAAA;IAAOf,GAAA;IAAUsC,MAAA,EAAQhB,MAAA;IAAQT;EAAA,EAAgB;AACzE,CAAC","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}